{"programModules":{"EXT130MI":{"program":"EXT130MI","triggers":{},"transactions":{"RevPrevRcl":{"sourceUuid":"30bae7c9-adfd-4ea6-b4d3-937d69bfe697","name":"RevPrevRcl","program":"EXT130MI","description":"Revert back from incorrectly re-classified balance(s)","active":true,"multi":false,"modified":1697877425859,"modifiedBy":"900107","outputFields":[{"name":"SBAN","description":"Sub Lot Number","length":20,"mandatory":false,"type":"A"}],"inputFields":[{"name":"BANO","description":"Lot Number","length":20,"mandatory":true,"type":"A"},{"name":"CAMU","description":"Container","length":20,"mandatory":true,"type":"A"},{"name":"CONO","description":"Company","length":3,"mandatory":false,"type":"N"},{"name":"E065","description":"Message Type","length":6,"mandatory":true,"type":"A"},{"name":"E0PA","description":"Partner","length":17,"mandatory":true,"type":"A"},{"name":"ITNO","description":"Item Number","length":15,"mandatory":true,"type":"A"},{"name":"WHLO","description":"Warehouse","length":3,"mandatory":true,"type":"A"},{"name":"WHSL","description":"Location","length":10,"mandatory":true,"type":"A"}],"utilities":["DateUtil"],"market":"ALL"}},"batches":{},"advancedPrograms":{}}},"utilities":{},"sources":{"30bae7c9-adfd-4ea6-b4d3-937d69bfe697":{"uuid":"30bae7c9-adfd-4ea6-b4d3-937d69bfe697","updated":1697563093483,"updatedBy":"900107","created":1697877400354,"createdBy":"900107","apiVersion":"UNKNOWN","beVersion":"16.0.0.20230822184312.7","language":"GROOVY","codeHash":"060E3DD7C0E7C89BF24F4A1CF945985AD4401700CFD63CC3C4930859A5747DE1","code":"aW1wb3J0IGphdmEudGltZS5Mb2NhbERhdGUNCmltcG9ydCBqYXZhLnRpbWUuZm9ybWF0LkRhdGVUaW1lRm9ybWF0dGVyDQoNCi8qKg0KICogUkVBRE1FDQogKiByZXZlcnRQcmV2UmVjbGFzcyAtIFJldmVydCBiYWNrIGZyb20gaW5jb3JyZWN0bHkgcmUtY2xhc3NpZmllZCBiYWxhbmNlKHMpDQogKg0KICogTmFtZTogRVhUMTMwTUkuUmV2UHJldlJjbA0KICogRGVzY3JpcHRpb246IFByaW50IFRhZyhzKQ0KICogRGF0ZQkgICAgICBDaGFuZ2VkIEJ5ICAgICAgRGVzY3JpcHRpb24NCiAqIDIwMjMwMTA3CSAgVklEVkVOICAgICAgICAgIHJldmVydFByZXZSZWNsYXNzIC0gUmV2ZXJ0IGJhY2sgZnJvbSBpbmNvcnJlY3RseSByZS1jbGFzc2lmaWVkIGJhbGFuY2UocykNCiAqIDIwMjMwNzAxICAgQWpheSAgICAgICAgICAgIFVwZGF0ZWQgdGhlIGxvZ2ljIHRvIGNvcHkgUUkgUmVxdWVzdCBCYXNpcyBhbmQgUmVjbGFzcyBsb2dpYw0KICogMjAyMzEwMTcgICBBamF5ICAgICAgICAgICAgQ29kZSBDbGVhbnVwDQogKiovDQoNCmNsYXNzIFJldlByZXZSY2wgZXh0ZW5kcyBFeHRlbmRNM1RyYW5zYWN0aW9uIHsNCiAgcHJpdmF0ZSBmaW5hbCBNSUFQSSBtaQ0KICBwcml2YXRlIGZpbmFsIERhdGFiYXNlQVBJIGRhdGFiYXNlDQogIHByaXZhdGUgZmluYWwgTG9nZ2VyQVBJIGxvZ2dlcg0KICBwcml2YXRlIGZpbmFsIFByb2dyYW1BUEkgcHJvZ3JhbQ0KICBwcml2YXRlIGZpbmFsIFV0aWxpdHlBUEkgdXRpbGl0eQ0KICBwcml2YXRlIGZpbmFsIElvbkFQSSBpb24NCiAgcHJpdmF0ZSBmaW5hbCBNSUNhbGxlckFQSSBtaUNhbGxlcg0KDQogIC8vSW5wdXQgZmllbGRzDQogIHByaXZhdGUgaW50IENPTk8NCiAgcHJpdmF0ZSBTdHJpbmcgaUJBTk8NCiAgcHJpdmF0ZSBTdHJpbmcgaUNBTVUNCiAgcHJpdmF0ZSBTdHJpbmcgaUUwNjUNCiAgcHJpdmF0ZSBTdHJpbmcgaUUwUEENCiAgcHJpdmF0ZSBTdHJpbmcgaVdITE8NCiAgcHJpdmF0ZSBTdHJpbmcgaVdIU0wNCiAgcHJpdmF0ZSBTdHJpbmcgaUlUTk8NCiAgcHJpdmF0ZSBTdHJpbmcgb3JpZ2luYWxXSExPDQogIHByaXZhdGUgU3RyaW5nIG9yaWdpbmFsQkFOTw0KICBwcml2YXRlIFN0cmluZyBvcmlnaW5hbENBTVUNCiAgcHJpdmF0ZSBTdHJpbmcgb3JpZ2luYWxXSFNMDQogIHByaXZhdGUgU3RyaW5nIGJhbGFuY2VCQU5PDQogIHByaXZhdGUgU3RyaW5nIHRvQkFOTw0KICBwcml2YXRlIFN0cmluZyBiYXNlQkFOTw0KICBwcml2YXRlIGRvdWJsZSB0b3RhbFF0eUluTG9jYXRpb24NCiAgcHJpdmF0ZSBTdHJpbmcgY3VyclNUQVMNCiAgcHJpdmF0ZSBTdHJpbmcgY3VyckxvY2F0aW9uDQogIHByaXZhdGUgU3RyaW5nIHJ2cnRCQU5PDQogIHByaXZhdGUgYm9vbGVhbiBva190b19SZXZlcnQNCiAgcHJpdmF0ZSBTdHJpbmcgTUlUTE9DX1dITE8NCiAgcHJpdmF0ZSBTdHJpbmcgTUlUTE9DX1dIU0wNCiAgcHJpdmF0ZSBTdHJpbmcgTUlUTE9DX0JBTk8NCiAgcHJpdmF0ZSBTdHJpbmcgTUlUTE9DX0NBTVUNCiAgcHJpdmF0ZSBTdHJpbmcgTUlUTE9DX0lUTk8NCiAgcHJpdmF0ZSBTdHJpbmcgTUlUTE9DX1NUUVQNCiAgcHJpdmF0ZSBTdHJpbmcgRVhUNDAxX1JTQ0QNCg0KICBEQkNvbnRhaW5lciBjb250YWluZXJFWFQ0MDEsIGNvbnRhaW5lck1JVExPQw0KDQogIFJldlByZXZSY2woSW9uQVBJIGlvbiwgTUlBUEkgbWksIERhdGFiYXNlQVBJIGRhdGFiYXNlLCBMb2dnZXJBUEkgbG9nZ2VyLCBQcm9ncmFtQVBJIHByb2dyYW0sIFV0aWxpdHlBUEkgdXRpbGl0eSwgTUlDYWxsZXJBUEkgbWlDYWxsZXIpIHsNCiAgICB0aGlzLm1pID0gbWkNCiAgICB0aGlzLmRhdGFiYXNlID0gZGF0YWJhc2UNCiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcg0KICAgIHRoaXMucHJvZ3JhbSA9IHByb2dyYW0NCiAgICB0aGlzLnV0aWxpdHkgPSB1dGlsaXR5DQogICAgdGhpcy5pb24gPSBpb24NCiAgICB0aGlzLm1pQ2FsbGVyID0gbWlDYWxsZXINCiAgfQ0KDQogIC8qKg0KICAgKiBNYWluIG1ldGhvZA0KICAgKiBAcGFyYW0NCiAgICogQHJldHVybg0KICAgKi8NCiAgdm9pZCBtYWluKCkgew0KDQogICAgaUJBTk8gPSBtaS5pbkRhdGEuZ2V0KCJCQU5PIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiQkFOTyIpLnRvU3RyaW5nKCkudHJpbSgpDQogICAgaUNBTVUgPSBtaS5pbkRhdGEuZ2V0KCJDQU1VIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiQ0FNVSIpLnRvU3RyaW5nKCkudHJpbSgpDQogICAgaUUwNjUgPSBtaS5pbkRhdGEuZ2V0KCJFMDY1IikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiRTA2NSIpLnRvU3RyaW5nKCkudHJpbSgpDQogICAgaUUwUEEgPSBtaS5pbkRhdGEuZ2V0KCJFMFBBIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiRTBQQSIpLnRvU3RyaW5nKCkudHJpbSgpDQogICAgaVdITE8gPSBtaS5pbkRhdGEuZ2V0KCJXSExPIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiV0hMTyIpLnRvU3RyaW5nKCkudHJpbSgpDQogICAgaVdIU0wgPSBtaS5pbkRhdGEuZ2V0KCJXSFNMIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiV0hTTCIpLnRvU3RyaW5nKCkudHJpbSgpDQogICAgaUlUTk8gPSBtaS5pbkRhdGEuZ2V0KCJJVE5PIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiSVROTyIpLnRvU3RyaW5nKCkudHJpbSgpDQoNCiAgICBDT05PID0gcHJvZ3JhbS5MREFaRC5DT05PLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkNCg0KICAgIHRvdGFsUXR5SW5Mb2NhdGlvbiA9IDANCiAgICBva190b19SZXZlcnQgPSBmYWxzZQ0KICAgIHJ2cnRCQU5PID0gIiINCiAgICBjdXJyTG9jYXRpb24gPSAiIg0KICAgIGN1cnJTVEFTID0gIiINCiAgICB0b0JBTk8gPSAiIg0KDQogICAgREJBY3Rpb24gYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIwMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgaVdITE8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgaVdIU0wpDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgaUNBTVUpDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgaUJBTk8pDQoNCiAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDEgPSB7DQogICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgIGNvbnRhaW5lckVYVDQwMSA9IHJlc3VsdENvbnRhaW5lcg0KICAgIH0NCg0KICAgIGlmICghYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KICAgICAgaWYgKGNvbnRhaW5lckVYVDQwMS5nZXQoIkVYU1RBUyIpLnRvU3RyaW5nKCkgPT0gIjMiKSB7DQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYUEJBTiIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYU0JBTiIpKQ0KDQogICAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMTAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgICAgd2hpbGUgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZEVYVDQwMSkpIHsNCiAgICAgICAgICBpZiAoY29udGFpbmVyRVhUNDAxLmdldCgiRVhTVEFTIikudG9TdHJpbmcoKSA9PSAiMyIpIHsNCiAgICAgICAgICAgIGlCQU5PID0gY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikNCiAgICAgICAgICB9DQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICAvL1VwZGF0ZSBhbGwgcG9zdCBsZXZlbHMgLSBaUkNMRlcgLSBFWFQ0MDENCg0KICAgIG9yaWdpbmFsV0hMTyA9IGlXSExPLnRyaW0oKQ0KICAgIG9yaWdpbmFsQkFOTyA9IGlCQU5PLnRyaW0oKQ0KICAgIG9yaWdpbmFsQ0FNVSA9IGlDQU1VLnRyaW0oKQ0KICAgIG9yaWdpbmFsV0hTTCA9IGlXSFNMLnRyaW0oKQ0KICAgIHRvQkFOTyA9IGlCQU5PLnRyaW0oKQ0KDQogICAgaWYgKGlCQU5PLnRyaW0oKS5jb250YWlucygifCIpKSB7DQogICAgICBpbnQgaW5kZXggPSBpQkFOTy5pbmRleE9mKCJ8IikNCiAgICAgIGJhc2VCQU5PID0gaUJBTk8uc3Vic3RyaW5nKDAsIGluZGV4KQ0KICAgIH0gZWxzZSB7DQogICAgICBtaS5lcnJvcigiU3ViLUxvdCBoYXMgdG8gYmUgdXNlZCEiKQ0KICAgICAgcmV0dXJuDQogICAgfQ0KICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb24gPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiTUlUTE9DIikNCiAgICBTdHJpbmcgdGVtcENBTVUgPSBvcmlnaW5hbENBTVUuc3BsaXQoIl8iKVswXQ0KICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmxpa2UoIk1MQ0FNVSIsIHRlbXBDQU1VICsgIiUiKQ0KDQogICAgREJBY3Rpb24gYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCI5OSIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxBTFFUIiwgIk1MU1RBUyIsICJNTFNUUVQiKS5idWlsZCgpDQogICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENPTk8iLCBDT05PKQ0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hMTyIsIG9yaWdpbmFsV0hMTykNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTElUTk8iLCBpSVROTykNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdIU0wiLCBvcmlnaW5hbFdIU0wpDQogICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDQU1VIiwgb3JpZ2luYWxDQU1VKQ0KDQogICAgbG9nZ2VyLmRlYnVnKCJDYWxsaW5nIE1JVExPQyB0byBnZXQgUXVhbnRpdHkiKQ0KICAgIHRvdGFsUXR5SW5Mb2NhdGlvbiA9IGdldFRvdGFsUXR5TG9jQ0FNVShhY3Rpb25NSVRMT0MsIGNvbnRhaW5lck1JVExPQywgYmFzZUJBTk8pDQogICAgbG9nZ2VyLmRlYnVnKCJ0b3RhbFF0eUluTG9jYXRpb246ICIgKyB0b3RhbFF0eUluTG9jYXRpb24pDQoNCiAgICBTdHJpbmcgdGVtcEJBTk8gPSAiIg0KDQogICAgaWYgKHRvdGFsUXR5SW5Mb2NhdGlvbiA+IDApIHsNCiAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgICBEQkNvbnRhaW5lciBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgQ09OTykNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdpbmFsV0hMTykNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgb3JpZ2luYWxXSFNMKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ2luYWxCQU5PKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ2luYWxDQU1VKQ0KICAgICAgLyoqDQogICAgICAgKiBDbG9zdXJlIHRvIHJlYWQgRVhUNDAxDQogICAgICAgKi8NCiAgICAgIENsb3N1cmUgPCA/ID4gQ2FsbEJhY2tfRVhUNDAxID0gew0KICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXJfRVhUNDAxIC0+DQogICAgICAgIGN1cnJTVEFTID0gcmVzdWx0Q29udGFpbmVyX0VYVDQwMS5nZXQoIkVYU1RBUyIpLnRvU3RyaW5nKCkNCiAgICAgICAgY3VyckxvY2F0aW9uID0gcmVzdWx0Q29udGFpbmVyX0VYVDQwMS5nZXQoIkVYTFdIUyIpLnRvU3RyaW5nKCkNCg0KICAgICAgICBsb2dnZXIuZGVidWcoImN1cnJTVEFTOiAiICsgY3VyclNUQVMgKyAiIHwgY3VyckxvY2F0aW9uOiAiICsgY3VyckxvY2F0aW9uKQ0KDQogICAgICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgICAgICAvLyAqKiogT25seSBhbGxvdyByZXZlcnQgZm9yIExldmVscyBhY3R1YWxseSByZXZlcnRlZCBmb3IgUmVqZWN0aW9ucyAqKioNCiAgICAgICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAgICAgaWYgKGN1cnJTVEFTLnRyaW0oKSA9PSAiMyIpIHsNCg0KICAgICAgICAgIHJ2cnRCQU5PID0gcmVzdWx0Q29udGFpbmVyX0VYVDQwMS5nZXQoIkVYQkFOTyIpLnRvU3RyaW5nKCkNCiAgICAgICAgICAvLyAqKiogRmluZCBTdWItTGV2ZWwgQmFsYW5jZSBpcyBjdXJyZW50bHkgYXQgKioqDQogICAgICAgICAgdGVtcEJBTk8gPSBmaW5kTGFzdFJlY2xhc3NlZCgiMyIpDQoNCiAgICAgICAgICBsb2dnZXIuZGVidWcoInRlbXBCQU5POiAiICsgdGVtcEJBTk8pDQoNCiAgICAgICAgICBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTEFMUVQiLCAiTUxTVEFTIiwgIk1MU1RRVCIpLmJ1aWxkKCkNCiAgICAgICAgICBjb250YWluZXJNSVRMT0MgPSBhY3Rpb25NSVRMT0MuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ09OTyIsIENPTk8pDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgb3JpZ2luYWxXSExPKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MSVROTyIsIGlJVE5PKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIG9yaWdpbmFsV0hTTCkNCiAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBydnJ0QkFOTykNCiAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENBTVUiLCBvcmlnaW5hbENBTVUpDQoNCiAgICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxNSVRMT0MgPSB7DQogICAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgICAgICAgIG9rX3RvX1JldmVydCA9IHRydWUNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBhY3Rpb25NSVRMT0MucmVhZEFsbChjb250YWluZXJNSVRMT0MsIDYsIDEsIHJlYWRBbGxNSVRMT0MpDQogICAgICAgIH0NCg0KICAgICAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgICAgICAvLyAqKiogQWxsb3cgcmV2ZXJ0IGZvciBBTlkgTGV2ZWwgZm9yIEFwcHJvdmVkIEJhbGFuY2VzICoqKg0KICAgICAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgICAgIGlmIChjdXJyU1RBUy50cmltKCkgPT0gIjIiKSB7DQogICAgICAgICAgcnZydEJBTk8gPSBmaW5kTGFzdFJlY2xhc3NlZCgiMiIpDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJydnJ0QkFOTzogIiArIHJ2cnRCQU5PKQ0KICAgICAgICAgIGlmIChydnJ0QkFOTy50cmltKCkgPT0gIjMiKSB7DQogICAgICAgICAgICBva190b19SZXZlcnQgPSBmYWxzZQ0KICAgICAgICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBDbG9zdXJlIHRvIHVwZGF0ZSBFWFQ0MDEqLw0KICAgICAgICAgICAgTGlzdCA8IExvY2tlZFJlc3VsdCA+IGxvY2tlZFJlc3VsdExpc3QgPSBuZXcgQXJyYXlMaXN0IDwgTG9ja2VkUmVzdWx0ID4gKCkNCiAgICAgICAgICAgIENsb3N1cmUgPCA/ID4gdXBkYXRlRVhUNDAxID0gew0KICAgICAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgICAgICAgIGxvY2tlZFJlc3VsdExpc3QuYWRkKGxvY2tlZFJlc3VsdCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCB1cGRhdGVFWFQ0MDEpKSB7DQogICAgICAgICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgPSBsb2NrZWRSZXN1bHRMaXN0WzBdDQoNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgIjMiDQogICAgICAgICAgICAgICAgYXMgY2hhcikNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMU1RRIiwgdG90YWxRdHlJbkxvY2F0aW9uKQ0KICAgICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KICAgICAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgb2tfdG9fUmV2ZXJ0ID0gdHJ1ZQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJDYWxsaW5nIEVYVDQwMSIpDQogICAgICBhY3Rpb25FWFQ0MDEucmVhZEFsbChjb250YWluZXJFWFQ0MDEsIDYsIDEsIENhbGxCYWNrX0VYVDQwMSkNCiAgICB9IGVsc2Ugew0KICAgICAgbWkuZXJyb3IoIkJhbGFuY2UgdG8gcmV2ZXJzZSBub3QgZm91bmQgaW4gbG9jYXRpb24gOiIgKyBvcmlnaW5hbFdIU0wgKyAiICEiKQ0KICAgICAgcmV0dXJuDQogICAgfQ0KICAgIGxvZ2dlci5kZWJ1Zygib2tfdG9fUmV2ZXJ0OiAiICsgb2tfdG9fUmV2ZXJ0KQ0KICAgIGlmIChva190b19SZXZlcnQpIHsNCiAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdpbmFsV0hMTykNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdpbmFsV0hTTCkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIG9yaWdpbmFsQkFOTykNCg0KICAgICAgTGlzdCA8IExvY2tlZFJlc3VsdCA+IGxvY2tlZFJlc3VsdExpc3QgPSBuZXcgQXJyYXlMaXN0IDwgTG9ja2VkUmVzdWx0ID4gKCkNCiAgICAgIENsb3N1cmUgPCA/ID4gdXBkYXRlRVhUNDAxID0gew0KICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgIGxvY2tlZFJlc3VsdExpc3QuYWRkKGxvY2tlZFJlc3VsdCkNCiAgICAgIH0NCiAgICAgIGlmIChhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCB1cGRhdGVFWFQ0MDEpKSB7DQogICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgPSBsb2NrZWRSZXN1bHRMaXN0WzBdDQoNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgIjEiDQogICAgICAgICAgYXMgY2hhcikNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMU1RRIiwgdG90YWxRdHlJbkxvY2F0aW9uKQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCiAgICAgIH0NCg0KICAgICAgbG9nZ2VyLmRlYnVnKCJ0ZW1wQkFOTzogIiArIHRlbXBCQU5PKQ0KDQogICAgICBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTEFMUVQiLCAiTUxTVEFTIiwgIk1MU1RRVCIpLmJ1aWxkKCkNCiAgICAgIGNvbnRhaW5lck1JVExPQyA9IGFjdGlvbk1JVExPQy5nZXRDb250YWluZXIoKQ0KDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENPTk8iLCBDT05PKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgb3JpZ2luYWxXSExPKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgaUlUTk8pDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdIU0wiLCBjdXJyTG9jYXRpb24pDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBydnJ0QkFOTykNCiAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIG9yaWdpbmFsQ0FNVSkNCg0KICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsTUlUTE9DID0gew0KICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgICAgY29udGFpbmVyTUlUTE9DID0gcmVzdWx0Q29udGFpbmVyDQogICAgICB9DQoNCiAgICAgIGJvb2xlYW4gSU45MSA9ICFhY3Rpb25NSVRMT0MucmVhZEFsbChjb250YWluZXJNSVRMT0MsIDYsIDEsIHJlYWRBbGxNSVRMT0MpDQogICAgICBpZiAoIUlOOTEgJiYgIWNvbnRhaW5lck1JVExPQy5nZXRTdHJpbmcoIk1MV0hTTCIpLmNvbnRhaW5zKCI9PiIpKSB7DQogICAgICAgIGlmIChjb250YWluZXJNSVRMT0MuZ2V0RG91YmxlKCJNTEFMUVQiKSA+IDApIHsNCiAgICAgICAgICAvL0lmIEJhbGFuY2UgY291bGQgbm90IGJlIHJldmVydGVkIGJhY2ssIHNldCB0aGUgU3RhdHVzIGZvciBjdXJyZW50IEJhbGFuY2UgdG8gImFzIGlzIg0KICAgICAgICAgIGFjdGlvbk1JVExPQyA9IGRhdGFiYXNlLnRhYmxlKCJNSVRMT0MiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIk1MQ09OTyIsICJNTFdITE8iLCAiTUxXSFNMIiwgIk1MSVROTyIsICJNTEJBTk8iLCAiTUxDQU1VIiwgIk1MQUxRVCIsICJNTFNUQVMiLCAiTUxTVFFUIikuYnVpbGQoKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQyA9IGFjdGlvbk1JVExPQy5nZXRDb250YWluZXIoKQ0KDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDT05PIiwgQ09OTykNCiAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdITE8iLCBvcmlnaW5hbFdITE8pDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgaUlUTk8pDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSFNMIiwgY3VyckxvY2F0aW9uKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIG9yaWdpbmFsQkFOTykNCiAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENBTVUiLCBvcmlnaW5hbENBTVUpDQoNCiAgICAgICAgICBpZiAoIWFjdGlvbk1JVExPQy5yZWFkQWxsKGNvbnRhaW5lck1JVExPQywgNiwgMSwgcmVhZEFsbE1JVExPQykpIHsNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdpbmFsV0hMTykNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdpbmFsV0hTTCkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIG9yaWdpbmFsQkFOTykNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBsb2NrZWRSZXN1bHRMaXN0ID0gbmV3IEFycmF5TGlzdCA8IExvY2tlZFJlc3VsdCA+ICgpDQogICAgICAgICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZUVYVDQwMSkpIHsNCiAgICAgICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgPSBsb2NrZWRSZXN1bHRMaXN0WzBdDQoNCiAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYU1RBUyIsIGN1cnJTVEFTIGFzIGNoYXIpDQogICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExTVFEiLCB0b3RhbFF0eUluTG9jYXRpb24pDQogICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENITk8iLCBsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpDQogICAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBtaS5lcnJvcigiQmFsYW5jZSBpcyBBbGxvY2F0ZWQgYW5kIENhbiBOb3QgYmUgcmV2ZXJzZWQhIikNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb250YWluZXJNSVRMT0MuZ2V0KCJNTFNUQVMiKSAhPSAiMSINCiAgICAgICAgICBhcyBjaGFyKSB7DQogICAgICAgICAgTWFwIDwgU3RyaW5nLCBTdHJpbmcgPiBpbkFkZFJjbExvdFN0cyA9IFsiUFJGTCI6ICIqRVhFIiwNCiAgICAgICAgICAgICJFMFBBIjogaUUwUEEsDQogICAgICAgICAgICAiRTA2NSI6IGlFMDY1LA0KICAgICAgICAgICAgIldITE8iOiBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFdITE8iKS50b1N0cmluZygpLnRyaW0oKSwNCiAgICAgICAgICAgICJXSFNMIjogY29udGFpbmVyTUlUTE9DLmdldCgiTUxXSFNMIikudG9TdHJpbmcoKS50cmltKCksDQogICAgICAgICAgICAiSVROTyI6IGNvbnRhaW5lck1JVExPQy5nZXQoIk1MSVROTyIpLnRvU3RyaW5nKCkudHJpbSgpLA0KICAgICAgICAgICAgIkJBTk8iOiBjb250YWluZXJNSVRMT0MuZ2V0KCJNTEJBTk8iKS50b1N0cmluZygpLnRyaW0oKSwNCiAgICAgICAgICAgICJDQU1VIjogY29udGFpbmVyTUlUTE9DLmdldCgiTUxDQU1VIikudG9TdHJpbmcoKS50cmltKCksDQogICAgICAgICAgICAiUlNDRCI6ICIiLA0KICAgICAgICAgICAgIkFMT0MiOiAiMSIsDQogICAgICAgICAgICAiU1RBUyI6ICIxIg0KICAgICAgICAgIF0NCg0KICAgICAgICAgIENsb3N1cmUgPCA/ID4gQWRkUmNsTG90U3RzQ2FsbGJhY2sgPSB7DQogICAgICAgICAgICBNYXAgPCBTdHJpbmcsDQogICAgICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7fQ0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJBZGRSY2xMb3RTdHM6ICIgKyByZXNwb25zZS50b1N0cmluZygpKQ0KICAgICAgICAgIH0NCiAgICAgICAgICBsb2dnZXIuZGVidWcoImluQWRkUmNsTG90U3RzOiAiICsgaW5BZGRSY2xMb3RTdHMudG9TdHJpbmcoKSkNCiAgICAgICAgICBtaUNhbGxlci5jYWxsKCJNTVM4NTBNSSIsICJBZGRSY2xMb3RTdHMiLCBpbkFkZFJjbExvdFN0cywgQWRkUmNsTG90U3RzQ2FsbGJhY2spDQoNCiAgICAgICAgICBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTEFMUVQiLCAiTUxTVEFTIiwgIk1MU1RRVCIpLmJ1aWxkKCkNCiAgICAgICAgICBjb250YWluZXJNSVRMT0MgPSBhY3Rpb25NSVRMT0MuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ09OTyIsIENPTk8pDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgb3JpZ2luYWxXSExPKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MSVROTyIsIGlJVE5PKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIGN1cnJMb2NhdGlvbikNCiAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBydnJ0QkFOTykNCiAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENBTVUiLCBvcmlnaW5hbENBTVUpDQoNCiAgICAgICAgICBpZiAoYWN0aW9uTUlUTE9DLnJlYWRBbGwoY29udGFpbmVyTUlUTE9DLCA2LCAxLCByZWFkQWxsTUlUTE9DKSkgew0KICAgICAgICAgICAgaWYgKGNvbnRhaW5lck1JVExPQy5nZXQoIk1MU1RBUyIpICE9ICIxIg0KICAgICAgICAgICAgICBhcyBjaGFyKSB7DQogICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdpbmFsV0hMTykNCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgb3JpZ2luYWxXSFNMKQ0KICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnaW5hbEJBTk8pDQoNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0TGlzdCA9IG5ldyBBcnJheUxpc3QgPCBMb2NrZWRSZXN1bHQgPiAoKQ0KICAgICAgICAgICAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGxMb2NrKGNvbnRhaW5lckVYVDQwMSwgNiwgdXBkYXRlRVhUNDAxKSkgew0KICAgICAgICAgICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgPSBsb2NrZWRSZXN1bHRMaXN0WzBdDQoNCiAgICAgICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWFNUQVMiLCBjdXJyU1RBUyBhcyBjaGFyKQ0KICAgICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTFNUUSIsIHRvdGFsUXR5SW5Mb2NhdGlvbikNCiAgICAgICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hJRCIsIHByb2dyYW0uZ2V0VXNlcigpKQ0KICAgICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hOTyIsIGxvY2tlZFJlc3VsdC5nZXRJbnQoIkVYQ0hOTyIpICsgMSkNCiAgICAgICAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIG1pLmVycm9yKCJTdGF0dXMgb24gYmFsYW5jZSBjb3VsZCBub3QgYmUgY2hhbmdlZCEiKQ0KICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KDQogICAgICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gYWRkUmVjbGFzc0lucHV0cyA9IFsiUFJGTCI6ICIqRVhFIiwNCiAgICAgICAgICAiRTBQQSI6IGlFMFBBLA0KICAgICAgICAgICJFMDY1IjogaUUwNjUsDQogICAgICAgICAgIldITE8iOiBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFdITE8iKS50b1N0cmluZygpLA0KICAgICAgICAgICJXSFNMIjogY29udGFpbmVyTUlUTE9DLmdldCgiTUxXSFNMIikudG9TdHJpbmcoKSwNCiAgICAgICAgICAiSVROTyI6IGNvbnRhaW5lck1JVExPQy5nZXQoIk1MSVROTyIpLnRvU3RyaW5nKCksDQogICAgICAgICAgIkJBTk8iOiBjb250YWluZXJNSVRMT0MuZ2V0KCJNTEJBTk8iKS50b1N0cmluZygpLA0KICAgICAgICAgICJDQU1VIjogY29udGFpbmVyTUlUTE9DLmdldCgiTUxDQU1VIikudG9TdHJpbmcoKSwNCiAgICAgICAgICAiTklUTiI6IGNvbnRhaW5lck1JVExPQy5nZXQoIk1MSVROTyIpLnRvU3RyaW5nKCksDQogICAgICAgICAgIk5CQU4iOiB0b0JBTk8udHJpbSgpLA0KICAgICAgICAgICJSU0NEIjogY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhSU0NEIiksDQogICAgICAgICAgIlNUQVMiOiAiMSIsDQogICAgICAgICAgIkFMT0MiOiAiMSIsDQogICAgICAgICAgIlFMUVQiOiBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFNUUVQiKS50b1N0cmluZygpLA0KICAgICAgICAgICJRUkJTIjogIjMiDQogICAgICAgIF0NCiAgICAgICAgQ2xvc3VyZSA8ID8gPiBhZGRSZWNsYXNzQ2FsbGJhY2sgPSB7DQogICAgICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgICAgIFN0cmluZyA+IHJlc3BvbnNlIC0+DQogICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBtaS5vdXREYXRhLnB1dCgiU0JBTiIsIHRvQkFOTykNCiAgICAgICAgICBtaS53cml0ZSgpDQogICAgICAgIH0NCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJhZGRSZWNsYXNzSW5wdXRzOiAiICsgYWRkUmVjbGFzc0lucHV0cy50b1N0cmluZygpKQ0KICAgICAgICBtaUNhbGxlci5jYWxsKCJNTVM4NTBNSSIsICJBZGRSZWNsYXNzIiwgYWRkUmVjbGFzc0lucHV0cywgYWRkUmVjbGFzc0NhbGxiYWNrKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgQ2xvc3VyZSA8ID8gPiBhZGRSZWNvcmRIYW5kbGVyID0gew0KICAgICAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiRVhUMTMwTUkuQWRkUmVjb3JkIHJlc3BvbnNlOiAiICsgcmVzcG9uc2UudG9TdHJpbmcoKSkNCiAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsNCiAgICAgICAgICAgIG1pLmVycm9yKHJlc3BvbnNlLmVycm9yTWVzc2FnZS50b1N0cmluZygpKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgfSBlbHNlIHt9DQogICAgICAgIH0NCg0KICAgICAgICBkZWYgYWRkUmVjb3JkSW5wdXRzID0gWw0KICAgICAgICAgICJXSExPIjogY29udGFpbmVyTUlUTE9DLmdldCgiTUxXSExPIikudG9TdHJpbmcoKSwNCiAgICAgICAgICAiSVROTyI6IGlJVE5PLA0KICAgICAgICAgICJXSFNMIjogY29udGFpbmVyTUlUTE9DLmdldCgiTUxXSFNMIikudG9TdHJpbmcoKSwNCiAgICAgICAgICAiQkFOTyI6IGNvbnRhaW5lck1JVExPQy5nZXQoIk1MQkFOTyIpLnRvU3RyaW5nKCksDQogICAgICAgICAgIkNBTVUiOiBjb250YWluZXJNSVRMT0MuZ2V0KCJNTENBTVUiKS50b1N0cmluZygpLA0KICAgICAgICAgICJOU1RTIjogIjMiLA0KICAgICAgICAgICJTVEFUIjogIjkwIiwNCiAgICAgICAgXQ0KICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICBtaUNhbGxlci5jYWxsKCJFWFQxMDdNSSIsICJBZGRSZWNvcmQiLCBhZGRSZWNvcmRJbnB1dHMsIGFkZFJlY29yZEhhbmRsZXIpDQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIG1pLmVycm9yKCJTdWItTG90IHJlLWNsYXNzIGNhbiBub3QgYmUgcmV2ZXJzZWQhIikNCiAgICAgIHJldHVybg0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBnZXRUb3RhbFF0eUxvY0NBTVUgLSBHZXQgVG90YWwgUXVhbnRpdHkgZm9yIEl0ZW0vQ29udGFpbmVyIGluIHRoaXMgTG9jYXRpb24NCiAgICoqLw0KICBwcml2YXRlIGRvdWJsZSBnZXRUb3RhbFF0eUxvY0NBTVUoREJBY3Rpb24gZGJBY3Rpb24sIERCQ29udGFpbmVyIGRiQ29udGFpbmVyLCBTdHJpbmcgYmFzZUJBTk8pIHsNCiAgICBkb3VibGUgdG90UXR5ID0gMA0KDQogICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkcyA9IHsNCiAgICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciAtPg0KICAgICAgaWYgKGNvbnRhaW5lci5nZXRTdHJpbmcoIk1MQkFOTyIpLnRyaW0oKSA9PSBiYXNlQkFOTy50cmltKCkgfHwgY29udGFpbmVyLmdldFN0cmluZygiTUxCQU5PIikudHJpbSgpLnN0YXJ0c1dpdGgoYmFzZUJBTk8udHJpbSgpICsgInwiKSkgew0KICAgICAgICB0b3RRdHkgKz0gY29udGFpbmVyLmdldERvdWJsZSgiTUxTVFFUIikNCiAgICAgICAgYmFsYW5jZUJBTk8gPSBjb250YWluZXIuZ2V0U3RyaW5nKCJNTEJBTk8iKQ0KICAgICAgICBsb2dnZXIuZGVidWcoImJhbGFuY2VCQU5POiAiICsgYmFsYW5jZUJBTk8pDQogICAgICB9IGVsc2Ugew0KICAgICAgICAvLw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChkYkFjdGlvbi5yZWFkQWxsKGRiQ29udGFpbmVyLCA1LCByZWFkQWxsUmVjb3JkcykpIHsNCiAgICAgIC8vDQogICAgfQ0KDQogICAgcmV0dXJuIHRvdFF0eQ0KDQogIH0NCiAgLyoqDQogICAqICAgIGZpbmRMYXN0UmVjbGFzc2VkIC0gRmluZCBMYXN0IFJlY2xhc3NpZmllZCBUcmFuc2FjdGlvbiBmb3IgU3ViLUxvdCBCYWxhbmNlDQogICAqKi8NCiAgcHJpdmF0ZSBTdHJpbmcgZmluZExhc3RSZWNsYXNzZWQoU3RyaW5nIHJldlN0YXR1cykgew0KICAgIFN0cmluZyBydnJ0QkFOTyA9ICIiDQoNCiAgICBsb2dnZXIuZGVidWcoIkRvd253YXJkcyIpDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKioqIEZpbmQgYWxsIFByZS1MZXZlbHMgKERvd253YXJkcyBpbiB0aGUgSGllcmFyY2h5ISkgKioqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgREJBY3Rpb24gYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ2luYWxXSExPKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdpbmFsV0hTTCkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnaW5hbEJBTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ2luYWxDQU1VKQ0KDQogICAgLyoqDQogICAgICogQ2xvc3VyZSB0byByZWFkIEVYVDQwMQ0KICAgICAqICovDQogICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsRVhUNDAxID0gew0KICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICBjb250YWluZXJFWFQ0MDEgPSByZXN1bHRDb250YWluZXINCiAgICB9DQogICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbEVYVDQwMSkpIHsNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhQQkFOIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCg0KICAgICAgYm9vbGVhbiBJTjkxID0gdHJ1ZQ0KICAgICAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVFWFQ0MDEgPSB7DQogICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCiAgICAgICAgbG9ja2VkUmVzdWx0LmFsbENvbHVtbnMuZWFjaCB7DQogICAgICAgICAgU3RyaW5nIGNvbHVtbiAtPg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldChjb2x1bW4sIGxvY2tlZFJlc3VsdC5nZXQoY29sdW1uKSkNCiAgICAgICAgfQ0KICAgICAgICBpZiAocmV2U3RhdHVzID09ICIzIikgew0KICAgICAgICAgIGlmIChsb2NrZWRSZXN1bHQuZ2V0KCJFWFNUQVMiKS50b1N0cmluZygpID09IHJldlN0YXR1cykgew0KICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgIjEiDQogICAgICAgICAgICAgIGFzIGNoYXIpDQogICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQoNCiAgICAgICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KDQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmIChyZXZTdGF0dXMgPT0gIjIiICYmIGNvbnRhaW5lckVYVDQwMS5nZXQoIkVYU1RBUyIpLnRvU3RyaW5nKCkgPT0gIjMiKSB7DQogICAgICAgICAgICBydnJ0QkFOTyA9ICIzIg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgIiIpDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoImZpbmRMYXN0UmVjbGFzc2VkIFJldHVybmluZzogIiArIHJ2cnRCQU5PKQ0KICAgICAgICAgICAgcmV0dXJuIHJ2cnRCQU5PDQogICAgICAgICAgfQ0KDQogICAgICAgICAgREJBY3Rpb24gYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxBTFFUIiwgIk1MU1RBUyIsICJNTFNUUVQiKS5idWlsZCgpDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENPTk8iLCBDT05PKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hMTyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MSVROTyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYSVROTyIpKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYU0JBTiIpKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KDQogICAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsTUlUTE9DID0gew0KICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgICAgICBjb250YWluZXJNSVRMT0MgPSByZXN1bHRDb250YWluZXINCiAgICAgICAgICB9DQoNCiAgICAgICAgICBJTjkxID0gIWFjdGlvbk1JVExPQy5yZWFkQWxsKGNvbnRhaW5lck1JVExPQywgNiwgMSwgcmVhZEFsbE1JVExPQykNCiAgICAgICAgICBpZiAoIUlOOTEpIHsNCiAgICAgICAgICAgIHJ2cnRCQU5PID0gY29udGFpbmVyTUlUTE9DLmdldFN0cmluZygiTUxCQU5PIikNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhQQkFOIikpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KDQogICAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgICB9DQoNCiAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgIHdoaWxlIChhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCB1cGRhdGVFWFQ0MDEpKSB7DQogICAgICAgIC8vDQogICAgICB9DQoNCiAgICAgIGlmIChjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWElUTk8iKS50cmltKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PKQ0KICAgICAgICBsb2dnZXIuZGVidWcoImZpbmRMYXN0UmVjbGFzc2VkIFJldHVybmluZzogIiArIHJ2cnRCQU5PKQ0KICAgICAgICByZXR1cm4gcnZydEJBTk8NCiAgICAgIH0NCg0KICAgIH0NCg0KICAgIGxvZ2dlci5kZWJ1ZygiVXB3YXJkcyIpDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICoqKiBGaW5kIGFsbCBTdWItTGV2ZWxzIChVcHdhcmRzIGluIHRoZSBIaWVyYXJjaHkhKSAqKioNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ2luYWxXSExPKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdpbmFsV0hTTCkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnaW5hbEJBTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ2luYWxDQU1VKQ0KDQogICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbEVYVDQwMSkpIHsNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCg0KICAgICAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVFWFQ0MDEgPSB7DQogICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCiAgICAgICAgbG9ja2VkUmVzdWx0LmFsbENvbHVtbnMuZWFjaCB7DQogICAgICAgICAgU3RyaW5nIGNvbHVtbiAtPg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldChjb2x1bW4sIGxvY2tlZFJlc3VsdC5nZXQoY29sdW1uKSkNCiAgICAgICAgfQ0KICAgICAgICBpZiAocmV2U3RhdHVzID09ICIzIikgew0KICAgICAgICAgIGlmIChsb2NrZWRSZXN1bHQuZ2V0KCJFWFNUQVMiKS50b1N0cmluZygpID09IHJldlN0YXR1cykgew0KICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgIjEiDQogICAgICAgICAgICAgIGFzIGNoYXIpDQogICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQoNCiAgICAgICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KDQogICAgICAgICAgICB0b0JBTk8gPSBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWFNCQU4iKSAvL0Fsd2F5cyByZS1jbGFzcyBwcmV2aW91c2x5IFJlamVjdGVkIHRvIEhJR0hFU1QgTGV2ZWwhDQoNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKHJldlN0YXR1cyA9PSAiMiIgJiYgY29udGFpbmVyRVhUNDAxLmdldCgiRVhTVEFTIikudG9TdHJpbmcoKSA9PSAiMyIpIHsNCiAgICAgICAgICAgIHJ2cnRCQU5PID0gIjMiDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCAiIikNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiZmluZExhc3RSZWNsYXNzZWQgUmV0dXJuaW5nOiAiICsgcnZydEJBTk8pDQogICAgICAgICAgICByZXR1cm4gcnZydEJBTk8NCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KDQogICAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMTAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgICB9DQogICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjEwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICB3aGlsZSAoYWN0aW9uRVhUNDAxLnJlYWRBbGxMb2NrKGNvbnRhaW5lckVYVDQwMSwgNiwgdXBkYXRlRVhUNDAxKSkgew0KICAgICAgICAvLw0KICAgICAgfQ0KICAgICAgaWYgKGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYSVROTyIpLnRyaW0oKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk8pDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiZmluZExhc3RSZWNsYXNzZWQgUmV0dXJuaW5nOiAiICsgcnZydEJBTk8pDQogICAgICAgIHJldHVybiBydnJ0QkFOTw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGxvZ2dlci5kZWJ1ZygiQkFTRSBMZXZlbCIpDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqKiogRmluZCBCQVNFIExldmVsICoqKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqDQogICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ2luYWxXSExPKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdpbmFsV0hTTCkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnaW5hbEJBTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ2luYWxDQU1VKQ0KDQogICAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVFWFQ0MDEgPSB7DQogICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICBsb2NrZWRSZXN1bHQuYWxsQ29sdW1ucy5lYWNoIHsNCiAgICAgICAgU3RyaW5nIGNvbHVtbiAtPg0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoY29sdW1uLCBsb2NrZWRSZXN1bHQuZ2V0KGNvbHVtbikpDQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZUVYVDQwMSkpIHsNCg0KICAgICAgREJBY3Rpb24gYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxBTFFUIiwgIk1MU1RBUyIsICJNTFNUUVQiKS5idWlsZCgpDQogICAgICBjb250YWluZXJNSVRMT0MgPSBhY3Rpb25NSVRMT0MuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDT05PIiwgQ09OTykNCiAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hMTyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhJVE5PIikpDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdIU0wiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCiAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYU0JBTiIpKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDQU1VIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhDQU1VIikpDQoNCiAgICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbE1JVExPQyA9IHsNCiAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgIGNvbnRhaW5lck1JVExPQyA9IHJlc3VsdENvbnRhaW5lcg0KICAgICAgfQ0KDQogICAgICBib29sZWFuIElOOTEgPSAhYWN0aW9uTUlUTE9DLnJlYWRBbGwoY29udGFpbmVyTUlUTE9DLCA2LCByZWFkQWxsTUlUTE9DKQ0KICAgICAgaWYgKCFJTjkxKSB7DQogICAgICAgIHJ2cnRCQU5PID0gY29udGFpbmVyTUlUTE9DLmdldFN0cmluZygiTUxCQU5PIikNCiAgICAgIH0NCiAgICB9DQogICAgaWYgKHJ2cnRCQU5PLnRyaW0oKS5pc0VtcHR5KCkpIHsNCiAgICAgIGxvZ2dlci5kZWJ1ZygicnZydEJBTk8gRW1wdHkgZmluZExhc3RSZWNsYXNzZWQgUmV0dXJuaW5nOiAiICsgYmFsYW5jZUJBTk8pDQogICAgICByZXR1cm4gYmFsYW5jZUJBTk8NCiAgICB9DQogICAgbG9nZ2VyLmRlYnVnKCJmaW5kTGFzdFJlY2xhc3NlZCBSZXR1cm5pbmc6ICIgKyBydnJ0QkFOTykNCiAgICByZXR1cm4gcnZydEJBTk8NCiAgfQ0KfQ=="}}}