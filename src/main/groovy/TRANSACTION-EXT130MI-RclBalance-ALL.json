{"programModules":{"EXT130MI":{"program":"EXT130MI","triggers":{},"transactions":{"RclBalance":{"sourceUuid":"6ffaeba9-bc12-4a0f-bc51-924d02e4c7be","name":"RclBalance","program":"EXT130MI","description":"Reclass Balance","active":true,"multi":false,"modified":1697877410064,"modifiedBy":"900107","outputFields":[{"name":"CONO","description":"Company","length":3,"mandatory":false,"type":"N"},{"name":"MSNR","description":"Message number","length":15,"mandatory":false,"type":"A"},{"name":"MSLN","description":"Message line number","length":5,"mandatory":false,"type":"N"},{"name":"MSGS","description":"Sequence number","length":3,"mandatory":false,"type":"N"}],"inputFields":[{"name":"CONO","description":"Company","length":3,"mandatory":false,"type":"N"},{"name":"E0PA","description":"Partner","length":17,"mandatory":true,"type":"A"},{"name":"E065","description":"Message Type","length":6,"mandatory":true,"type":"A"},{"name":"WHLO","description":"Warehouse","length":3,"mandatory":true,"type":"A"},{"name":"WHSL","description":"Location","length":10,"mandatory":true,"type":"A"},{"name":"ITNO","description":"Item number","length":15,"mandatory":true,"type":"A"},{"name":"BANO","description":"Lot number","length":20,"mandatory":true,"type":"A"},{"name":"CAMU","description":"Container","length":20,"mandatory":true,"type":"A"},{"name":"NBAN","description":"New Lot number","length":20,"mandatory":false,"type":"A"},{"name":"RSCD","description":"Reason code","length":3,"mandatory":false,"type":"A"},{"name":"STAS","description":"New Lot status","length":1,"mandatory":true,"type":"A"}],"utilities":["DateUtil"],"market":"ALL"}},"batches":{},"advancedPrograms":{}}},"utilities":{},"sources":{"6ffaeba9-bc12-4a0f-bc51-924d02e4c7be":{"uuid":"6ffaeba9-bc12-4a0f-bc51-924d02e4c7be","updated":1697563115707,"updatedBy":"900107","created":1697877400354,"createdBy":"900107","apiVersion":"UNKNOWN","beVersion":"16.0.0.20230822184312.7","language":"GROOVY","codeHash":"261DCEA33A61C4450B2781446B10A3ACBACFA35FE52B4D70C58A4157C6D5BD84","code":"aW1wb3J0IGphdmEudGltZS5Mb2NhbERhdGUNCmltcG9ydCBqYXZhLnRpbWUuTG9jYWxUaW1lDQppbXBvcnQgamF2YS50aW1lLmZvcm1hdC5EYXRlVGltZUZvcm1hdHRlcg0KaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmxvY2tzLkxvY2sNCg0KLyoqDQogKiBSRUFETUUNCiAqIFJlY2xhc3NpZnkgQmFsYW5jZQ0KICoNCiAqIE5hbWU6IEVYVDEzME1JLlJjbEJhbGFuY2UNCiAqIERlc2NyaXB0aW9uOiBSZWNsYXNzaWZ5IEJhbGFuY2UNCiAqIERhdGUJICAgICAgQ2hhbmdlZCBCeSAgICAgICAgICAgIERlc2NyaXB0aW9uDQogKiAyMDIyMTIwMQkgIEFKQVlZICAgICAgICAJUmVjbGFzc2lmeSBCYWxhbmNlDQogKiAyMDIzMDcwMSAgIEFqYXkgICAgICAgICAgVXBkYXRlZCB0aGUgbG9naWMgdG8gY29weSBRSSBSZXF1ZXN0IEJhc2lzDQogKiAyMDIzMTAxNyAgIEFqYXkgICAgICAgICAgICBDb2RlIENsZWFudXANCiAqLw0KDQpjbGFzcyBSY2xCYWxhbmNlIGV4dGVuZHMgRXh0ZW5kTTNUcmFuc2FjdGlvbiB7DQogIHByaXZhdGUgZmluYWwgTUlBUEkgbWkNCiAgcHJpdmF0ZSBmaW5hbCBNSUNhbGxlckFQSSBtaUNhbGxlcg0KICBwcml2YXRlIGZpbmFsIERhdGFiYXNlQVBJIGRhdGFiYXNlDQogIHByaXZhdGUgZmluYWwgTG9nZ2VyQVBJIGxvZ2dlcg0KICBwcml2YXRlIGZpbmFsIFByb2dyYW1BUEkgcHJvZ3JhbQ0KICBwcml2YXRlIGZpbmFsIFV0aWxpdHlBUEkgdXRpbGl0eQ0KDQogIC8vSW5wdXQgZmllbGRzDQogIHByaXZhdGUgU3RyaW5nIGlDT05PLCBpQkFOTywgaU5CQU4sIGlJVE5PLCBpU1RBUywgaVdITE8sIGlDQU1VLCBpV0hTTCwgaVJTQ0QsIGlFMFBBLCBpRTA2NQ0KDQogIHByaXZhdGUgU3RyaW5nIG15THZsX0JBTk8sIEZBQ0kNCg0KICBwcml2YXRlIFN0cmluZyB6TmV3U1RBUw0KDQogIHByaXZhdGUgYm9vbGVhbiB4eENoZ1N0cw0KDQogIHByaXZhdGUgREJDb250YWluZXIgY29udGFpbmVyRVhUNDAxLCBjb250YWluZXJNSVRMT0MsIGNvbnRhaW5lclFNU1JRSA0KICBwcml2YXRlIERCQWN0aW9uIGFjdGlvbkVYVDQwMQ0KDQogIHByaXZhdGUgaW50IFFJQURGcm9tTUlMT01BDQoNCiAgcHJpdmF0ZSBTdHJpbmcgb3JpZ1dITE8NCiAgcHJpdmF0ZSBTdHJpbmcgb3JpZ0JBTk8NCiAgcHJpdmF0ZSBTdHJpbmcgb3JpZ0NBTVUNCiAgcHJpdmF0ZSBTdHJpbmcgb3JpZ1dIU0wNCg0KICBSY2xCYWxhbmNlKE1JQVBJIG1pLCBNSUNhbGxlckFQSSBtaUNhbGxlciwgRGF0YWJhc2VBUEkgZGF0YWJhc2UsIExvZ2dlckFQSSBsb2dnZXIsIFByb2dyYW1BUEkgcHJvZ3JhbSwgVXRpbGl0eUFQSSB1dGlsaXR5KSB7DQogICAgdGhpcy5taSA9IG1pDQogICAgdGhpcy5taUNhbGxlciA9IG1pQ2FsbGVyDQogICAgdGhpcy5kYXRhYmFzZSA9IGRhdGFiYXNlDQogICAgdGhpcy5sb2dnZXIgPSBsb2dnZXINCiAgICB0aGlzLnByb2dyYW0gPSBwcm9ncmFtDQogICAgdGhpcy51dGlsaXR5ID0gdXRpbGl0eQ0KICB9DQoNCiAgLyoqDQogICAqIE1haW4gbWV0aG9kDQogICAqIEBwYXJhbQ0KICAgKiBAcmV0dXJuDQogICAqLw0KICB2b2lkIG1haW4oKSB7DQogICAgaUNPTk8gPSBtaS5pbkRhdGEuZ2V0KCJDT05PIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiQ09OTyIpLnRyaW0oKQ0KICAgIGlFMFBBID0gbWkuaW5EYXRhLmdldCgiRTBQQSIpID09IG51bGwgPyAiIiA6IG1pLmluRGF0YS5nZXQoIkUwUEEiKS50cmltKCkNCiAgICBpRTA2NSA9IG1pLmluRGF0YS5nZXQoIkUwNjUiKSA9PSBudWxsID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJFMDY1IikudHJpbSgpDQogICAgaUJBTk8gPSBtaS5pbkRhdGEuZ2V0KCJCQU5PIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiQkFOTyIpLnRyaW0oKQ0KICAgIGlOQkFOID0gbWkuaW5EYXRhLmdldCgiTkJBTiIpID09IG51bGwgPyAiIiA6IG1pLmluRGF0YS5nZXQoIk5CQU4iKS50cmltKCkNCiAgICBpSVROTyA9IG1pLmluRGF0YS5nZXQoIklUTk8iKSA9PSBudWxsID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJJVE5PIikudHJpbSgpDQogICAgaVNUQVMgPSBtaS5pbkRhdGEuZ2V0KCJTVEFTIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiU1RBUyIpLnRyaW0oKQ0KICAgIGlXSExPID0gbWkuaW5EYXRhLmdldCgiV0hMTyIpID09IG51bGwgPyAiIiA6IG1pLmluRGF0YS5nZXQoIldITE8iKS50cmltKCkNCiAgICBpQ0FNVSA9IG1pLmluRGF0YS5nZXQoIkNBTVUiKSA9PSBudWxsID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJDQU1VIikudHJpbSgpDQogICAgaVdIU0wgPSBtaS5pbkRhdGEuZ2V0KCJXSFNMIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiV0hTTCIpLnRyaW0oKQ0KICAgIGlSU0NEID0gbWkuaW5EYXRhLmdldCgiUlNDRCIpID09IG51bGwgPyAiIiA6IG1pLmluRGF0YS5nZXQoIlJTQ0QiKS50cmltKCkNCg0KICAgIGlDT05PID0gaUNPTk8uaXNFbXB0eSgpID8gcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpIDogaUNPTk8NCiAgICBteUx2bF9CQU5PID0gaUJBTk8NCiAgICBjcnRSZWNsYXNzQmFsYW5jZV9FeGVjKGlDT05PLCBpRTBQQSwgaUUwNjUsIGlCQU5PLCBpTkJBTiwgaUlUTk8sIGlTVEFTLCBpV0hMTywgaUNBTVUsIGlXSFNMLCBpUlNDRCkNCg0KICB9DQoNCiAgcHJpdmF0ZSB2b2lkIGNydFJlY2xhc3NCYWxhbmNlX0V4ZWMoU3RyaW5nIGlDT05PX1JjbEJhbCwgU3RyaW5nIGlFMFBBX1JjbEJhbCwgU3RyaW5nIGlFMDY1X1JjbEJhbCwgU3RyaW5nIGlCQU5PX1JjbEJhbCwgU3RyaW5nIGlOQkFOX1JjbEJhbCwgU3RyaW5nIGlJVE5PX1JjbEJhbCwgU3RyaW5nIGlTVEFTX1JjbEJhbCwgU3RyaW5nIGlXSExPX1JjbEJhbCwgU3RyaW5nIGlDQU1VX1JjbEJhbCwgU3RyaW5nIGlXSFNMX1JjbEJhbCwgU3RyaW5nIGlSU0NEX1JjbEJhbCkgew0KICAgIHpOZXdTVEFTID0gaVNUQVNfUmNsQmFsDQoNCiAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjAwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KICAgIGNvbnRhaW5lckVYVDQwMSA9IGFjdGlvbkVYVDQwMS5nZXRDb250YWluZXIoKQ0KDQogICAgREJBY3Rpb24gYWN0aW9uTUlUV0hMID0gZGF0YWJhc2UudGFibGUoIk1JVFdITCIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTVdDT05PIiwgIk1XV0hMTyIsICJNV0ZBQ0kiKS5idWlsZCgpDQogICAgREJDb250YWluZXIgY29udGFpbmVyTUlUV0hMID0gYWN0aW9uTUlUV0hMLmdldENvbnRhaW5lcigpDQoNCiAgICBjb250YWluZXJNSVRXSEwuc2V0KCJNV0NPTk8iLCBpQ09OT19SY2xCYWwudG9JbnRlZ2VyKCkpDQogICAgY29udGFpbmVyTUlUV0hMLnNldCgiTVdXSExPIiwgaVdITE9fUmNsQmFsKQ0KDQogICAgYWN0aW9uTUlUV0hMLnJlYWQoY29udGFpbmVyTUlUV0hMKQ0KDQogICAgRkFDSSA9IGNvbnRhaW5lck1JVFdITC5nZXRTdHJpbmcoIk1XRkFDSSIpDQoNCiAgICBTdHJpbmcgYmFzZV9CQU5PLCBiYXNlX05CQU4NCiAgICBkb3VibGUgdG90YWxRdHlJbkxvY2F0aW9uID0gMA0KDQogICAgYmFzZV9CQU5PID0gaUJBTk9fUmNsQmFsDQogICAgaWYgKGlCQU5PX1JjbEJhbC5pbmRleE9mKCd8JykgPiAwKSB7DQogICAgICBiYXNlX0JBTk8gPSBpQkFOT19SY2xCYWwuc3BsaXQoIlxcfCIpWzBdDQogICAgfQ0KDQogICAgYmFzZV9OQkFOID0gaU5CQU5fUmNsQmFsDQogICAgaWYgKGlOQkFOX1JjbEJhbC5pbmRleE9mKCd8JykgPiAwKSB7DQogICAgICBiYXNlX05CQU4gPSBpTkJBTl9SY2xCYWwuc3BsaXQoIlxcfCIpWzBdDQogICAgfQ0KDQogICAgaWYgKGJhc2VfTkJBTiAhPSBiYXNlX0JBTk8gJiYgIWlOQkFOX1JjbEJhbC5pc0VtcHR5KCkpIHsNCiAgICAgIHJldHVybg0KICAgIH0NCg0KICAgIGJvb2xlYW4gZmlyc3RSZWNsYXNzU3VibG90ID0gdHJ1ZQ0KDQogICAgREJBY3Rpb24gYWN0aW9uUU1TUlFIID0gZGF0YWJhc2UudGFibGUoIlFNU1JRSCIpLmluZGV4KCIzMCIpLnNlbGVjdGlvbigiUkhDT05PIiwgIlJISVROTyIsICJSSEJBTk8iLCAiUkhRU1RBIiwgIlJIUVJSUCIsICJSSFFBUFIiKS5idWlsZCgpDQogICAgREJDb250YWluZXIgY29udGFpbmVyUU1TUlFIID0gYWN0aW9uUU1TUlFILmdldENvbnRhaW5lcigpDQoNCiAgICBjb250YWluZXJRTVNSUUguc2V0KCJSSENPTk8iLCBpQ09OT19SY2xCYWwudG9JbnRlZ2VyKCkpDQogICAgY29udGFpbmVyUU1TUlFILnNldCgiUkhJVE5PIiwgaUlUTk9fUmNsQmFsKQ0KICAgIGNvbnRhaW5lclFNU1JRSC5zZXQoIlJIQkFOTyIsIGlOQkFOX1JjbEJhbCkNCg0KICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZHNRTVNSUUggPSB7DQogICAgICBEQkNvbnRhaW5lciBjb250YWluZXIgLT4NCiAgICB9DQoNCiAgICBpZiAoYWN0aW9uUU1TUlFILnJlYWRBbGwoY29udGFpbmVyUU1TUlFILCAzLCByZWFkQWxsUmVjb3Jkc1FNU1JRSCkpIHsNCiAgICAgIGZpcnN0UmVjbGFzc1N1YmxvdCA9IGZhbHNlDQogICAgfQ0KDQogICAgYm9vbGVhbiB6VmFsaWRSZWMgPSB0cnVlDQogICAgaW50IGN1cnJMZXZlbCA9IDANCiAgICBpbnQgdXBkVHlwZSA9IDANCg0KICAgIGlmICghWyIxIiwgIjIiLCAiMyIsICI5Il0uY29udGFpbnMoaVNUQVNfUmNsQmFsKSkgew0KICAgICAgelZhbGlkUmVjID0gZmFsc2UNCiAgICB9DQoNCiAgICBvcmlnV0hMTyA9IGlXSExPX1JjbEJhbA0KICAgIG9yaWdCQU5PID0gaUJBTk9fUmNsQmFsDQogICAgb3JpZ0NBTVUgPSBpQ0FNVV9SY2xCYWwNCiAgICBvcmlnV0hTTCA9IGlXSFNMX1JjbEJhbA0KDQogICAgU3RyaW5nIGJhc2VCQU5PDQogICAgaWYgKG9yaWdCQU5PLmluZGV4T2YoJ3wnKSA+IDApIHsNCiAgICAgIGJhc2VCQU5PID0gb3JpZ0JBTk8uc3BsaXQoIlxcfCIpWzBdDQogICAgfSBlbHNlIHsNCiAgICAgIGJhc2VCQU5PID0gb3JpZ0JBTk8NCiAgICB9DQoNCiAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uID0gZGF0YWJhc2UuZ2V0RXhwcmVzc2lvbkZhY3RvcnkoIk1JVExPQyIpDQogICAgU3RyaW5nIHRlbXBDQU1VID0gb3JpZ0NBTVUuc3BsaXQoIl8iKVswXQ0KICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmxpa2UoIk1MQ0FNVSIsIHRlbXBDQU1VICsgIiUiKQ0KDQogICAgREJBY3Rpb24gYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCI5OSIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxTVEFTIiwgIk1MU1RRVCIsICJNTFFJQUQiLCAiTUxDSE5PIiwgIk1MTE1EVCIsICJNTENISUQiKS5idWlsZCgpDQogICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENPTk8iLCBpQ09OT19SY2xCYWwudG9JbnRlZ2VyKCkpDQogICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgb3JpZ1dITE8pDQogICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgaUlUTk9fUmNsQmFsKQ0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIG9yaWdXSFNMKQ0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIG9yaWdDQU1VKQ0KDQogICAgdG90YWxRdHlJbkxvY2F0aW9uID0gZ2V0VG90YWxRdHlMb2NDQU1VKGFjdGlvbk1JVExPQywgY29udGFpbmVyTUlUTE9DLCBiYXNlQkFOTykNCg0KICAgIGxvZ2dlci5kZWJ1ZygiQmVmb3JlIE5CQU4gY2hlY2siKQ0KICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgaWYgKGlOQkFOX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgPiAxKSB7DQogICAgICBsb2dnZXIuZGVidWcoIkluc2lkZSBOQkFOIGNoZWNrIHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYykNCg0KICAgICAgaWYgKGlCQU5PX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgPiBpTkJBTl9SY2xCYWwudHJpbSgpLmxlbmd0aCgpKSB7DQogICAgICAgIHpWYWxpZFJlYyA9IGZhbHNlDQogICAgICB9DQoNCiAgICAgIGlmIChpQkFOT19SY2xCYWwudHJpbSgpLmxlbmd0aCgpIDwgaU5CQU5fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSAmJiAoaU5CQU5fUmNsQmFsLnN1YnN0cmluZygwLCBpTkJBTl9SY2xCYWwudHJpbSgpLmxlbmd0aCgpIC0gNCkgIT0gaUJBTk9fUmNsQmFsKSB8fCBpTkJBTl9SY2xCYWwuc3Vic3RyaW5nKGlOQkFOX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgLSA0LCBpTkJBTl9SY2xCYWwudHJpbSgpLmxlbmd0aCgpIC0gMykgIT0gInwiKSB7DQogICAgICAgIHpWYWxpZFJlYyA9IGZhbHNlDQogICAgICB9DQoNCiAgICAgIGlmIChpQkFOT19SY2xCYWwudHJpbSgpLmxlbmd0aCgpID09IGlOQkFOX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgJiYgKGlOQkFOX1JjbEJhbC5zdWJzdHJpbmcoaU5CQU5fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSAtIDQsIGlOQkFOX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgLSAzKSAhPSAifCIgfCBpQkFOT19SY2xCYWwuc3Vic3RyaW5nKGlCQU5PX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgLSA0LCBpQkFOT19SY2xCYWwudHJpbSgpLmxlbmd0aCgpIC0gMykgIT0gInwiIHx8IGlOQkFOX1JjbEJhbC5zdWJzdHJpbmcoMCwgaU5CQU5fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSAtIDQpICE9IGlCQU5PX1JjbEJhbC5zdWJzdHJpbmcoMCwgaUJBTk9fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSAtIDQpKSkgew0KICAgICAgICB6VmFsaWRSZWMgPSBmYWxzZQ0KICAgICAgfQ0KDQogICAgICBsb2dnZXIuZGVidWcoInpWYWxpZFJlYzogIiArIHpWYWxpZFJlYykNCg0KICAgICAgdXBkVHlwZSA9IDENCg0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgaVdITE9fUmNsQmFsKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgaVdIU0xfUmNsQmFsKQ0KDQogICAgfSBlbHNlIHsNCiAgICAgIGlmIChpU1RBU19SY2xCYWwuaXNCbGFuaygpKSB7DQogICAgICAgIHpWYWxpZFJlYyA9IGZhbHNlDQogICAgICB9IGVsc2Ugew0KICAgICAgICBpTkJBTl9SY2xCYWwgPSBpQkFOT19SY2xCYWwNCg0KICAgICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBwcm9ncmFtLkxEQVpELmdldCgiQ09OTyIpLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdXSExPKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCBpSVROT19SY2xCYWwpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIG9yaWdCQU5PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgb3JpZ1dIU0wpDQoNCiAgICAgICAgTGlzdCA8IExvY2tlZFJlc3VsdCA+IGFycmF5T2ZDb250YWluZXJzID0gbmV3IEFycmF5TGlzdCA8IExvY2tlZFJlc3VsdCA+ICgpDQogICAgICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgICAgYXJyYXlPZkNvbnRhaW5lcnMuYWRkKGxvY2tlZFJlc3VsdCkNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZWNvcmQgZm91bmQgaW4gRVhUNDAxLiBVcGRhdGluZyBFWFNUQVMgZm9yIFNCQU46ICIgKyBvcmlnQkFOTykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCg0KICAgICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgPSBhcnJheU9mQ29udGFpbmVyc1swXQ0KDQogICAgICAgICAgaWYgKCFpUlNDRF9SY2xCYWwuaXNCbGFuaygpKSB7DQogICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWFJTQ0QiLCBpUlNDRF9SY2xCYWwpDQogICAgICAgICAgfQ0KDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgek5ld1NUQVMpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMU1RRIiwgdG90YWxRdHlJbkxvY2F0aW9uKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTE1EVCIsIExvY2FsRGF0ZS5ub3coKS5mb3JtYXQoRGF0ZVRpbWVGb3JtYXR0ZXIub2ZQYXR0ZXJuKCJZWVlZTU1kZCIpKS50b0ludGVnZXIoKSkNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENITk8iLCBsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQoNCiAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCg0KICAgICAgICAgIGlmICh6TmV3U1RBUyA9PSAnOScgfHwgek5ld1NUQVMgPT0gJzInKSB7DQogICAgICAgICAgICBpTkJBTl9SY2xCYWwgPSBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWFBCQU4iKQ0KICAgICAgICAgICAgaVNUQVNfUmNsQmFsID0gIjIiDQogICAgICAgICAgICB6TmV3U1RBUyA9ICIyIg0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmICh6TmV3U1RBUyA9PSAnMycpIHsNCiAgICAgICAgICAgIGlOQkFOX1JjbEJhbCA9IGxvY2tlZFJlc3VsdC5nZXRTdHJpbmcoIkVYQkFOTyIpDQogICAgICAgICAgfQ0KDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZWNvcmQgZm91bmQgaW4gRVhUNDAxLiBVcGRhdGVkIEVYU1RBUyBmb3IgU0JBTjogIiArIG9yaWdCQU5PKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHpOZXdTVEFTID09ICczJykgew0KICAgICAgICAgIGlOQkFOX1JjbEJhbCA9IGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQkFOTyIpDQogICAgICAgICAgYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxTVEFTIiwgIk1MU1RRVCIsICJNTFFJQUQiLCAiTUxDSE5PIiwgIk1MTE1EVCIsICJNTENISUQiKS5idWlsZCgpDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENPTk8iLCBwcm9ncmFtLkxEQVpELmdldCgiQ09OTyIpLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkpDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgb3JpZ1dITE8pDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgaUlUTk9fUmNsQmFsKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIG9yaWdXSFNMKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIG9yaWdCQU5PKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIG9yaWdDQU1VKQ0KDQogICAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkTUlUTE9DID0gew0KICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgICAgICBjb250YWluZXJNSVRMT0MgPSByZXN1bHRDb250YWluZXINCiAgICAgICAgICB9DQoNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIkluc2lkZSBSZWplY3Rpb24gbG9naWMiKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgYm9vbGVhbiBJTjkxID0gIWFjdGlvbk1JVExPQy5yZWFkQWxsKGNvbnRhaW5lck1JVExPQywgNiwgMSwgcmVhZEFsbFJlY29yZE1JVExPQykNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDFfMSA9IHsNCiAgICAgICAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxID0gcmVzdWx0Q29udGFpbmVyDQogICAgICAgICAgfQ0KDQogICAgICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIHByb2dyYW0uTERBWkQuZ2V0KCJDT05PIikgYXMgaW50KQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdXSExPKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PX1JjbEJhbCkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVhZGluZyBFWFQ0MDEgfCBCZWZvcmUgY29udGFpbmVyRVhUNDAxOiAiICsgY29udGFpbmVyRVhUNDAxLnRvU3RyaW5nKCkpDQogICAgICAgICAgYm9vbGVhbiBJTjkzID0gIWFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZEVYVDQwMV8xKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVhZGluZyBFWFQ0MDEgfCBBZnRlciBjb250YWluZXJFWFQ0MDE6ICIgKyBjb250YWluZXJFWFQ0MDEudG9TdHJpbmcoKSkNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIklOOTE6ICIgKyBJTjkxICsgIiB8IElOOTM6ICIgKyBJTjkzKQ0KICAgICAgICAgIHdoaWxlIChJTjkxICYmICFJTjkzKSB7DQogICAgICAgICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjEwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBwcm9ncmFtLkxEQVpELmdldCgiQ09OTyIpLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkpDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYSVROTyIpKQ0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWENBTVUiKSkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KDQogICAgICAgICAgICBMaXN0IDwgTG9ja2VkUmVzdWx0ID4gbG9ja2VkUmVzdWx0TGlzdCA9IG5ldyBBcnJheUxpc3QgPCBMb2NrZWRSZXN1bHQgPiAoKQ0KICAgICAgICAgICAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0TGlzdC5hZGQobG9ja2VkUmVzdWx0KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIkluc2lkZSB3aGlsZSBFWFQ0MDEgfCBCZWZvcmUgY29udGFpbmVyRVhUNDAxOiAiICsgY29udGFpbmVyRVhUNDAxLnRvU3RyaW5nKCkpDQogICAgICAgICAgICBJTjkzID0gIWFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZVJlY29yZEVYVDQwMSkNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiSW5zaWRlIHdoaWxlIEVYVDQwMSB8IEFmdGVyIGNvbnRhaW5lckVYVDQwMTogIiArIGNvbnRhaW5lckVYVDQwMS50b1N0cmluZygpKQ0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJJTjkzOiAiICsgSU45MykNCiAgICAgICAgICAgIGlmICghSU45Mykgew0KICAgICAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0ID0gbG9ja2VkUmVzdWx0TGlzdFswXQ0KDQogICAgICAgICAgICAgIGlmIChsb2NrZWRSZXN1bHQuZ2V0KCJFWFNUQVMiKSA9PSAiMSINCiAgICAgICAgICAgICAgICBhcyBjaGFyKSB7DQogICAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgek5ld1NUQVMgYXMgY2hhcikNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTFNUUSIsIHRvdGFsUXR5SW5Mb2NhdGlvbikNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMTURUIiwgdXRpbGl0eS5jYWxsKCJEYXRlVXRpbCIsICJjdXJyZW50RGF0ZVk4QXNJbnQiKSkNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hOTyIsIGxvY2tlZFJlc3VsdC5nZXRJbnQoIkVYQ0hOTyIpICsgMSkNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQoNCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgbG9ja2VkUmVzdWx0LmdldFN0cmluZygiRVhTQkFOIikpDQoNCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJVcGRhdGVkIExvY2tlZHJlc3VsdDogIiArIGxvY2tlZFJlc3VsdCkNCg0KICAgICAgICAgICAgICBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTFNUQVMiLCAiTUxTVFFUIiwgIk1MUUlBRCIsICJNTENITk8iLCAiTUxMTURUIiwgIk1MQ0hJRCIpLmJ1aWxkKCkNCiAgICAgICAgICAgICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgICAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdITE8iLCBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgbG9ja2VkUmVzdWx0LmdldFN0cmluZygiRVhJVE5PIikpDQogICAgICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIGxvY2tlZFJlc3VsdC5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KICAgICAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCiAgICAgICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDQU1VIiwgbG9ja2VkUmVzdWx0LmdldFN0cmluZygiRVhDQU1VIikpDQoNCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZWFkaW5nIE1JVExPQyB8IEJlZm9yZSBjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCiAgICAgICAgICAgICAgSU45MSA9ICFhY3Rpb25NSVRMT0MucmVhZEFsbChjb250YWluZXJNSVRMT0MsIDYsIDEsIHJlYWRBbGxSZWNvcmRNSVRMT0MpDQogICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVhZGluZyBNSVRMT0MgfCBCZWZvcmUgY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiSU45MTogIiArIElOOTEpDQogICAgICAgICAgICAgIGlmICghSU45MSkgew0KICAgICAgICAgICAgICAgIGlXSExPX1JjbEJhbCA9IGNvbnRhaW5lck1JVExPQy5nZXRTdHJpbmcoIk1MV0hMTyIpDQogICAgICAgICAgICAgICAgaUJBTk9fUmNsQmFsID0gY29udGFpbmVyTUlUTE9DLmdldFN0cmluZygiTUxCQU5PIikNCiAgICAgICAgICAgICAgICBpV0hTTF9SY2xCYWwgPSBjb250YWluZXJNSVRMT0MuZ2V0U3RyaW5nKCJNTFdIU0wiKQ0KDQogICAgICAgICAgICAgICAgb3JpZ1dITE8gPSBpV0hMT19SY2xCYWwNCiAgICAgICAgICAgICAgICBvcmlnQkFOTyA9IGlCQU5PX1JjbEJhbA0KICAgICAgICAgICAgICAgIG9yaWdXSFNMID0gaVdIU0xfUmNsQmFsDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnV0hMTzogIiArIG9yaWdXSExPICsgIiB8IG9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgb3JpZ1dIU0w6ICIgKyBvcmlnV0hTTCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB1cGRUeXBlID0gMg0KDQogICAgICB9DQogICAgfQ0KDQogICAgbG9nZ2VyLmRlYnVnKCJCZWZvcmUgelZhbGlkUmVjIGNoZWNrIikNCiAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCg0KICAgIGlmICh6VmFsaWRSZWMpIHsNCiAgICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gU2V0QmFsUmNsRHRJbnB1dCA9IFsNCiAgICAgICAgIldITE8iOiBjb250YWluZXJFWFQ0MDEuZ2V0KCJFWExXSEwiKS50b1N0cmluZygpLA0KICAgICAgICAiSVROTyI6IGlJVE5PX1JjbEJhbCwNCiAgICAgICAgIldIU0wiOiBjb250YWluZXJFWFQ0MDEuZ2V0KCJFWExXSFMiKS50b1N0cmluZygpLA0KICAgICAgICAiQkFOTyI6IGlCQU5PX1JjbEJhbA0KICAgICAgXQ0KDQogICAgICBib29sZWFuIGFwaVN1Y2Nlc3NmdWwgPSB0cnVlDQoNCiAgICAgIENsb3N1cmUgPCA/ID4gY2FsbEJhY2tBUElTZXRCYWxSY2xEdCA9IHsNCiAgICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsNCiAgICAgICAgICBhcGlTdWNjZXNzZnVsID0gZmFsc2UNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIk1JIEVycm9yIGNhbGxCYWNrQVBJU2V0QmFsUmNsRHQiKQ0KICAgICAgICAgIG1pLmVycm9yKHJlc3BvbnNlLmVycm9yTWVzc2FnZS50b1N0cmluZygpKQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgbG9nZ2VyLmRlYnVnKCJCZWZvcmUgc2V0QmFsYW5jZVJjbERhdGUiKQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCg0KICAgICAgc2V0QmFsYW5jZVJjbERhdGUoY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hMIiksIGlJVE5PX1JjbEJhbCwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hTIiksIGlCQU5PX1JjbEJhbCkNCg0KICAgICAgYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxTVEFTIiwgIk1MU1RRVCIsICJNTFFJQUQiLCAiTUxDSE5PIiwgIk1MTE1EVCIsICJNTENISUQiKS5idWlsZCgpDQogICAgICBjb250YWluZXJNSVRMT0MgPSBhY3Rpb25NSVRMT0MuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgb3JpZ1dITE8pDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTElUTk8iLCBpSVROT19SY2xCYWwpDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdIU0wiLCBvcmlnV0hTTCkNCiAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIG9yaWdCQU5PKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDQU1VIiwgb3JpZ0NBTVUpDQoNCiAgICAgIGlmICh1cGRUeXBlID09IDEpIHsNCiAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkTUlUTE9DID0gew0KICAgICAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQyA9IHJlc3VsdENvbnRhaW5lcg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVjb3JkIGZvdW5kIGluIE1JVExPQyAtIHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IFNUQVM6ICIgKyByZXN1bHRDb250YWluZXIuZ2V0KCJNTFNUQVMiKS50b1N0cmluZygpKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICAgIGlmICh1cGRUeXBlID09IDEpIHsNCiAgICAgICAgICAgIGlmIChyZXN1bHRDb250YWluZXIuZ2V0KCJNTFNUQVMiKS50b1N0cmluZygpICE9ICcxJykgew0KICAgICAgICAgICAgICBNYXAgPCBTdHJpbmcsIFN0cmluZyA+IGFkZFJjbExvdFN0c0lucHV0RGF0YSA9IFsNCiAgICAgICAgICAgICAgICAiUFJGTCI6ICIqRVhFIiwNCiAgICAgICAgICAgICAgICAiRTBQQSI6IGlFMFBBX1JjbEJhbCwNCiAgICAgICAgICAgICAgICAiRTA2NSI6IGlFMDY1X1JjbEJhbCwNCiAgICAgICAgICAgICAgICAiV0hMTyI6IGNvbnRhaW5lck1JVExPQy5nZXRTdHJpbmcoIk1MV0hMTyIpLA0KICAgICAgICAgICAgICAgICJXSFNMIjogY29udGFpbmVyTUlUTE9DLmdldFN0cmluZygiTUxXSFNMIiksDQogICAgICAgICAgICAgICAgIklUTk8iOiBpSVROT19SY2xCYWwsDQogICAgICAgICAgICAgICAgIkJBTk8iOiBpQkFOT19SY2xCYWwsDQogICAgICAgICAgICAgICAgIkNBTVUiOiBpQ0FNVV9SY2xCYWwsDQogICAgICAgICAgICAgICAgIlJTQ0QiOiBpUlNDRF9SY2xCYWwsDQogICAgICAgICAgICAgICAgIkFMT0MiOiAiMSIsDQogICAgICAgICAgICAgICAgIlNUQVMiOiAiMSIsDQogICAgICAgICAgICAgIF0NCg0KICAgICAgICAgICAgICBDbG9zdXJlIDwgPyA+IGNhbGxCYWNrQVBJQWRkUmNsTG90U3RzID0gew0KICAgICAgICAgICAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgICAgICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikgew0KICAgICAgICAgICAgICAgICAgYXBpU3VjY2Vzc2Z1bCA9IGZhbHNlDQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIk1JIEVycm9yIGNhbGxCYWNrQVBJQWRkUmNsTG90U3RzIikNCiAgICAgICAgICAgICAgICAgIG1pLmVycm9yKHJlc3BvbnNlLmVycm9yTWVzc2FnZS50b1N0cmluZygpKQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBhcGlTdWNjZXNzZnVsID0gdHJ1ZQ0KICAgICAgICAgICAgICAgICAgbWkub3V0RGF0YS5wdXQoIkNPTk8iLCByZXNwb25zZS5nZXQoIkNPTk8iKSkNCiAgICAgICAgICAgICAgICAgIG1pLm91dERhdGEucHV0KCJNU0dTIiwgcmVzcG9uc2UuZ2V0KCJNU0dTIikpDQogICAgICAgICAgICAgICAgICBtaS5vdXREYXRhLnB1dCgiTVNMTiIsIHJlc3BvbnNlLmdldCgiTVNMTiIpKQ0KICAgICAgICAgICAgICAgICAgbWkub3V0RGF0YS5wdXQoIk1TTlIiLCByZXNwb25zZS5nZXQoIk1TTlIiKSkNCiAgICAgICAgICAgICAgICAgIG1pLndyaXRlKCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIkJlZm9yZSBSY2xCYWxhbmNlIEFkZFJjbExvdFN0cyIpDQogICAgICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJBZGRSY2xMb3RTdHMgaW5wdXRzOiAiICsgYWRkUmNsTG90U3RzSW5wdXREYXRhLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICAgICAgbWlDYWxsZXIuY2FsbCgiTU1TODUwTUkiLCAiQWRkUmNsTG90U3RzIiwgYWRkUmNsTG90U3RzSW5wdXREYXRhLCBjYWxsQmFja0FQSUFkZFJjbExvdFN0cykNCg0KICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIkFmdGVyIFJjbEJhbGFuY2UgQWRkUmNsTG90U3RzOiAiICsgYXBpU3VjY2Vzc2Z1bCkNCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBNYXAgPCBTdHJpbmcsIFN0cmluZyA+IGFkZFJlQ2xhc3NJbnB1dERhdGEgPSBbDQogICAgICAgICAgICAgICJQUkZMIjogIipFWEUiLA0KICAgICAgICAgICAgICAiRTBQQSI6IGlFMFBBX1JjbEJhbCwNCiAgICAgICAgICAgICAgIkUwNjUiOiBpRTA2NV9SY2xCYWwsDQogICAgICAgICAgICAgICJXSExPIjogY29udGFpbmVyTUlUTE9DLmdldFN0cmluZygiTUxXSExPIiksDQogICAgICAgICAgICAgICJXSFNMIjogY29udGFpbmVyTUlUTE9DLmdldFN0cmluZygiTUxXSFNMIiksDQogICAgICAgICAgICAgICJJVE5PIjogaUlUTk9fUmNsQmFsLA0KICAgICAgICAgICAgICAiQkFOTyI6IGlCQU5PX1JjbEJhbCwNCiAgICAgICAgICAgICAgIkNBTVUiOiBpQ0FNVV9SY2xCYWwsDQogICAgICAgICAgICAgICJOSVROIjogaUlUTk9fUmNsQmFsLA0KICAgICAgICAgICAgICAiTkJBTiI6IGlOQkFOX1JjbEJhbCwNCiAgICAgICAgICAgICAgIlJTQ0QiOiBpUlNDRF9SY2xCYWwsDQogICAgICAgICAgICAgICJTVEFTIjogIjEiLA0KICAgICAgICAgICAgICAiQUxPQyI6ICIxIiwNCiAgICAgICAgICAgICAgIlFMUVQiOiBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFNUUVQiKS50b1N0cmluZygpLA0KICAgICAgICAgICAgICAiUVJCUyI6ICIzIg0KICAgICAgICAgICAgXQ0KDQogICAgICAgICAgICBDbG9zdXJlIDwgPyA+IGNhbGxCYWNrQVBJQWRkUmVjbGFzcyA9IHsNCiAgICAgICAgICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBhcGlTdWNjZXNzZnVsID0gZmFsc2UNCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIk1JIEVycm9yIGNhbGxCYWNrQVBJQWRkUmVjbGFzcyIpDQogICAgICAgICAgICAgICAgbWkuZXJyb3IocmVzcG9uc2UuZXJyb3JNZXNzYWdlLnRvU3RyaW5nKCkgKyAiLSIgKyBpRTBQQV9SY2xCYWwgKyAiLSIgKyBpRTA2NV9SY2xCYWwpDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYXBpU3VjY2Vzc2Z1bCA9IHRydWUNCiAgICAgICAgICAgICAgICBtaS5vdXREYXRhLnB1dCgiQ09OTyIsIHJlc3BvbnNlLmdldCgiQ09OTyIpKQ0KICAgICAgICAgICAgICAgIG1pLm91dERhdGEucHV0KCJNU0dTIiwgcmVzcG9uc2UuZ2V0KCJNU0dTIikpDQogICAgICAgICAgICAgICAgbWkub3V0RGF0YS5wdXQoIk1TTE4iLCByZXNwb25zZS5nZXQoIk1TTE4iKSkNCiAgICAgICAgICAgICAgICBtaS5vdXREYXRhLnB1dCgiTVNOUiIsIHJlc3BvbnNlLmdldCgiTVNOUiIpKQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQmVmb3JlIFJjbEJhbGFuY2UgQWRkUmVjbGFzcyIpDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJBZGRSZWNsYXNzIGlucHV0czogIiArIGFkZFJlQ2xhc3NJbnB1dERhdGEudG9TdHJpbmcoKSkNCg0KICAgICAgICAgICAgbWlDYWxsZXIuY2FsbCgiTU1TODUwTUkiLCAiQWRkUmVjbGFzcyIsIGFkZFJlQ2xhc3NJbnB1dERhdGEsIGNhbGxCYWNrQVBJQWRkUmVjbGFzcykNCg0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJBZnRlciBSY2xCYWxhbmNlIEFkZFJjbExvdFN0czogIiArIGFwaVN1Y2Nlc3NmdWwpDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgICBpZiAoYXBpU3VjY2Vzc2Z1bCkgew0KICAgICAgICAgICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIHByb2dyYW0uTERBWkQuZ2V0KCJDT05PIikudG9TdHJpbmcoKS50b0ludGVnZXIoKSkNCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ1dITE8pDQogICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PX1JjbEJhbCkNCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ0JBTk8pDQogICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIG9yaWdDQU1VKQ0KICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgICAgICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyRVhUNDAxIC0+DQogICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxID0gcmVzdWx0Q29udGFpbmVyRVhUNDAxDQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KDQogICAgICAgICAgICAgICAgY3VyckxldmVsID0gY29udGFpbmVyRVhUNDAxLmdldEludCgiRVhDTFZMIikgKyAxDQogICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldENoYXIoIkVYU1RBUyIsICIxIikNCg0KICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiSW5zaWRlIGN1cnJMZXZlbCBsb2dpYzogIiArIGNvbnRhaW5lckVYVDQwMS5nZXRJbnQoIkVYQ0xWTCIpLnRvU3RyaW5nKCkpDQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTFNUQVMiLCAiTUxTVFFUIiwgIk1MUUlBRCIsICJNTENITk8iLCAiTUxMTURUIiwgIk1MQ0hJRCIpLmJ1aWxkKCkNCg0KICAgICAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBpTkJBTl9SY2xCYWwpDQoNCiAgICAgICAgICAgICAgU3RyaW5nIHRlbXBXSExPLCB0ZW1wV0hTTCwgdGVtcFNUUVQgPSAiIg0KICAgICAgICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRNSVRMT0MgPSB7DQogICAgICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyTUlUTE9DXzEgLT4NCiAgICAgICAgICAgICAgICBjb250YWluZXJNSVRMT0MgPSByZXN1bHRDb250YWluZXJNSVRMT0NfMQ0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgaWYgKGFjdGlvbk1JVExPQy5yZWFkQWxsKGNvbnRhaW5lck1JVExPQywgNiwgcmVhZEFsbFJlY29yZE1JVExPQykpIHsNCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlJlY29yZCBmb3VuZCB3aXRoIE5CQU4iKQ0KICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgICAgICAgdGVtcFdITE8gPSBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFdITE8iKS50b1N0cmluZygpDQogICAgICAgICAgICAgICAgdGVtcFNUUVQgPSBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFNUUVQiKS50b1N0cmluZygpDQogICAgICAgICAgICAgICAgdGVtcFdIU0wgPSBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFdIU0wiKS50b1N0cmluZygpDQoNCiAgICAgICAgICAgICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdXSExPKQ0KICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PX1JjbEJhbCkNCiAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBpTkJBTl9SY2xCYWwpDQogICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ0NBTVUpDQogICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgb3JpZ1dIU0wpDQoNCiAgICAgICAgICAgICAgICBMaXN0IDwgTG9ja2VkUmVzdWx0ID4gYXJyYXlPZkxvY2tlZFJlc3VsdHMgPSBuZXcgQXJyYXlMaXN0IDwgTG9ja2VkUmVzdWx0ID4gKCkNCg0KICAgICAgICAgICAgICAgIENsb3N1cmUgPCA/ID4gdXBkYXRlRmlyc3RSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgICAgICAgICAgICBhcnJheU9mTG9ja2VkUmVzdWx0cy5hZGQobG9ja2VkUmVzdWx0KQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICghYWN0aW9uRVhUNDAxLnJlYWRBbGxMb2NrKGNvbnRhaW5lckVYVDQwMSwgNiwgdXBkYXRlRmlyc3RSZWNvcmRFWFQ0MDEpKSB7DQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlJlY29yZCBub3QgZm91bmQuIEluc2VydGluZyIpDQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFdITE8iLCBvcmlnV0hMTykNCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYUEJBTiIsIGlCQU5PX1JjbEJhbCkNCiAgICAgICAgICAgICAgICAgIGlmIChpQkFOT19SY2xCYWwuaW5kZXhPZignfCcpID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWEJBTk8iLCBpQkFOT19SY2xCYWwuc3Vic3RyaW5nKDAsIGlCQU5PX1JjbEJhbC5pbmRleE9mKCd8JykpKQ0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhCQU5PIiwgaUJBTk9fUmNsQmFsKQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhXSFNMIiwgaVdIU0xfUmNsQmFsKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDTFZMIiwgY3VyckxldmVsKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTVEFTIiwgJzEnKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhSU0NEIiwgaVJTQ0RfUmNsQmFsKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhSR0RUIiwgTG9jYWxEYXRlLm5vdygpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oIllZWVlNTWRkIikpLnRvSW50ZWdlcigpKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhSR1RNIiwgTG9jYWxUaW1lLm5vdygpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oIkhIbW1zcyIpKS50b0ludGVnZXIoKSkNCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTE1EVCIsIExvY2FsRGF0ZS5ub3coKS5mb3JtYXQoRGF0ZVRpbWVGb3JtYXR0ZXIub2ZQYXR0ZXJuKCJZWVlZTU1kZCIpKS50b0ludGVnZXIoKSkNCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0hJRCIsIHByb2dyYW0uZ2V0VXNlcigpKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDSE5PIiwgMCkNCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIHRlbXBXSExPKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgdGVtcFdIU0wpDQogICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENXSEwiLCB0ZW1wV0hMTykNCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ1dIUyIsIHRlbXBXSFNMKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMU1RRIiwgdGVtcFNUUVQudG9Eb3VibGUoKSkNCg0KICAgICAgICAgICAgICAgICAgYWN0aW9uRVhUNDAxLmluc2VydChjb250YWluZXJFWFQ0MDEpDQoNCiAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyRVhUNDAxOiAiICsgY29udGFpbmVyRVhUNDAxLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICAgICAgICAgIHVwZFF0eVN1YkxldmVscyh0ZW1wV0hMTywgdGVtcFdIU0wsIHRlbXBTVFFULCBvcmlnQkFOTykNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCA9IGFycmF5T2ZMb2NrZWRSZXN1bHRzWzBdDQoNCiAgICAgICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYU1RBUyIsICIxIikNCiAgICAgICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTFNUUSIsIHRlbXBTVFFULnRvRG91YmxlKCkpDQogICAgICAgICAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCg0KICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZWNvcmQgZm91bmQuIFVwZGF0aW5nIikNCiAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoImxvY2tlZFJlc3VsdDogIiArIGxvY2tlZFJlc3VsdC50b1N0cmluZygpKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChmaXJzdFJlY2xhc3NTdWJsb3QpIHsNCiAgICAgICAgICAgICAgICAgIGJvb2xlYW4gaXNBUElTdWNjZXNzZnVsID0gZmFsc2UNCiAgICAgICAgICAgICAgICAgIFN0cmluZyBRUklEID0gIiINCiAgICAgICAgICAgICAgICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gYWRkUUlSZXF1ZXN0UGFyYW1zID0gWw0KICAgICAgICAgICAgICAgICAgICAiRkFDSSI6IEZBQ0ksDQogICAgICAgICAgICAgICAgICAgICJJVE5PIjogaUlUTk9fUmNsQmFsLA0KICAgICAgICAgICAgICAgICAgICAiQkFOTyI6IGlOQkFOX1JjbEJhbCwNCiAgICAgICAgICAgICAgICAgICAgIlFSRFQiOiBMb2NhbERhdGUubm93KCkuZm9ybWF0KERhdGVUaW1lRm9ybWF0dGVyLm9mUGF0dGVybigiWVlZWU1NZGQiKSksDQogICAgICAgICAgICAgICAgICAgICJTUlRUIjogIjEiLA0KICAgICAgICAgICAgICAgICAgICAiVFBTMSI6ICIwIg0KICAgICAgICAgICAgICAgICAgXQ0KDQogICAgICAgICAgICAgICAgICBDbG9zdXJlIDwgPyA+IGFkZFFJUmVxdWVzdEhhbmRsZXIgPSB7DQogICAgICAgICAgICAgICAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJNSSBFcnJvciBhZGRRSVJlcXVlc3RIYW5kbGVyIikNCiAgICAgICAgICAgICAgICAgICAgICBtaS5lcnJvcihyZXNwb25zZS5lcnJvck1lc3NhZ2UudG9TdHJpbmcoKSkNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICBpc0FQSVN1Y2Nlc3NmdWwgPSB0cnVlDQogICAgICAgICAgICAgICAgICAgICAgUVJJRCA9IHJlc3BvbnNlLlFSSUQNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJDYWxsaW5nIFFNUzMwME1JIEFkZFFJUmVxdWVzdCIpDQoNCiAgICAgICAgICAgICAgICAgIGlmIChpc0FQSVN1Y2Nlc3NmdWwpIHsNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJRTVMzMDBNSSBTdWNjZXNzZnVsIikNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgICAgICAgICAgIHFtczMwME1JQWRkUUlSZXF1ZXN0U3VjY2Vzc2Z1bChRUklEKQ0KDQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgbWkud3JpdGUoKQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJNSSBFcnJvciBUZXN0IGVycm9yIikNCiAgICAgICAgICAgICAgbWkuZXJyb3IoIlRlc3QgZXJyb3IiKQ0KICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoYWN0aW9uTUlUTE9DLnJlYWRBbGwoY29udGFpbmVyTUlUTE9DLCA2LCAxLCByZWFkQWxsUmVjb3JkTUlUTE9DKSkgew0KICAgICAgICAgIC8vDQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIERCQWN0aW9uIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5DT05PLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdXSExPKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCBpSVROT19SY2xCYWwpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIG9yaWdCQU5PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgb3JpZ1dIU0wpDQoNCiAgICAgICAgTGlzdCA8IExvY2tlZFJlc3VsdCA+IGFycmF5T2ZMb2NrZWRSZXN1bHRzID0gbmV3IEFycmF5TGlzdCA8IExvY2tlZFJlc3VsdCA+ICgpDQoNCiAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkRVhUNDAxID0gew0KICAgICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCiAgICAgICAgICBhcnJheU9mTG9ja2VkUmVzdWx0cy5hZGQobG9ja2VkUmVzdWx0KQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiTUkgRXJyb3IgRVhUNDAxIG5vIHJlY29yZCBub3QgdXBkVHlwZTEiKQ0KICAgICAgICAgIG1pLmVycm9yKCJSZWNvcmQgZG9lcyBub3QgZXhpc3QiKQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgPSBhcnJheU9mTG9ja2VkUmVzdWx0c1swXQ0KDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgek5ld1NUQVMpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMU1RRIiwgdG90YWxRdHlJbkxvY2F0aW9uKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTE1EVCIsIExvY2FsRGF0ZS5ub3coKS5mb3JtYXQoRGF0ZVRpbWVGb3JtYXR0ZXIub2ZQYXR0ZXJuKCJZWVlZTU1kZCIpKS50b0ludGVnZXIoKSkNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENITk8iLCBsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpDQoNCiAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQmVmb3JlIGNhbGxpbmcgdXBkUXR5U3ViTGV2ZWxzIikNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCg0KICAgICAgICAgIHVwZFF0eVN1YkxldmVscyhvcmlnV0hMTywgb3JpZ1dIU0wsIHRvdGFsUXR5SW5Mb2NhdGlvbi50b1N0cmluZygpLCBvcmlnQkFOTykNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQWZ0ZXIgY2FsbGluZyB1cGRRdHlTdWJMZXZlbHMiKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgaWYgKGlTVEFTX1JjbEJhbCAhPSAiMSIpIHsNCiAgICAgICAgICAgIHh4Q2hnU3RzID0gZmFsc2UNCiAgICAgICAgICAgIGNydFJlY2xhc3NUb1ByZXZMb3Qob3JpZ0JBTk8sIG9yaWdXSExPLCBpQ0FNVV9SY2xCYWwsIG9yaWdXSFNMLCBpSVROT19SY2xCYWwsIGlFMFBBX1JjbEJhbCwgaUUwNjVfUmNsQmFsLCAiIiwgaVJTQ0RfUmNsQmFsKQ0KDQogICAgICAgICAgICBNYXAgPCBTdHJpbmcsIFN0cmluZyA+IGFkZFJjbExvdFN0c1BhcmFtcyA9IFsNCiAgICAgICAgICAgICAgIkJBTk8iOiBjb250YWluZXJNSVRMT0MuZ2V0U3RyaW5nKCJNTEJBTk8iKSwNCiAgICAgICAgICAgICAgIlBSRkwiOiAiKkVYRSIsDQogICAgICAgICAgICAgICJFMFBBIjogaUUwUEFfUmNsQmFsLA0KICAgICAgICAgICAgICAiRTA2NSI6IGlFMDY1X1JjbEJhbCwNCiAgICAgICAgICAgICAgIldITE8iOiBjb250YWluZXJNSVRMT0MuZ2V0U3RyaW5nKCJNTFdITE8iKSwNCiAgICAgICAgICAgICAgIldIU0wiOiBjb250YWluZXJNSVRMT0MuZ2V0U3RyaW5nKCJNTFdIU0wiKSwNCiAgICAgICAgICAgICAgIklUTk8iOiBpSVROT19SY2xCYWwsDQogICAgICAgICAgICAgICJDQU1VIjogaUNBTVVfUmNsQmFsLA0KICAgICAgICAgICAgICAiUlNDRCI6IGlSU0NEX1JjbEJhbCwNCiAgICAgICAgICAgICAgIkFMT0MiOiAiMSIsDQogICAgICAgICAgICAgICJTVEFTIjogY29udGFpbmVyTUlUTE9DLmdldFN0cmluZygiTUxCQU5PIikuaW5kZXhPZigifCIpID4gMCA/ICIxIiA6IHpOZXdTVEFTDQogICAgICAgICAgICBdDQoNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2FsbGluZyBBZGRSY2xMb3RTdHMiKQ0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiYWRkUmNsTG90U3RzUGFyYW1zIiArIGFkZFJjbExvdFN0c1BhcmFtcy50b1N0cmluZygpKQ0KDQogICAgICAgICAgICBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTFNUQVMiLCAiTUxTVFFUIiwgIk1MUUlBRCIsICJNTENITk8iLCAiTUxMTURUIiwgIk1MQ0hJRCIpLmJ1aWxkKCkNCg0KICAgICAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkTUlUTE9DID0gew0KICAgICAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgICAgICAgICAgY2FsbE1NUzg1ME1JX0FkZFJjbExvdFN0cyhhZGRSY2xMb3RTdHNQYXJhbXMpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICghYWN0aW9uTUlUTE9DLnJlYWRBbGwoY29udGFpbmVyTUlUTE9DLCA2LCAxLCByZWFkQWxsUmVjb3JkTUlUTE9DKSkgew0KDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICB9DQoNCiAgfQ0KDQogIHByaXZhdGUgdm9pZCBxbXMzMDBNSUFkZFFJUmVxdWVzdFN1Y2Nlc3NmdWwoU3RyaW5nIFFSSUQpIHsNCg0KICAgIGJvb2xlYW4gaXNVcGRRSVJlcXVlc3RTdWNjZXNzZnVsID0gZmFsc2UNCiAgICBNYXAgPCBTdHJpbmcsIFN0cmluZyA+IHVwZFFJUmVxdWVzdFBhcmFtcyA9IFsNCiAgICAgICJGQUNJIjogRkFDSSwNCiAgICAgICJRUklEIjogUVJJRCwNCiAgICAgICJJVE5PIjogaUlUTk8sDQogICAgICAiUVNUQSI6ICIxIg0KICAgIF0NCg0KICAgIENsb3N1cmUgPCA/ID4gdXBkUUlSZXF1ZXN0SGFuZGxlciA9IHsNCiAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgIFN0cmluZyA+IHJlc3BvbnNlIC0+DQogICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJNSSBFcnJvciB1cGRRSVJlcXVlc3RIYW5kbGVyIikNCiAgICAgICAgbWkuZXJyb3IocmVzcG9uc2UuZXJyb3JNZXNzYWdlLnRvU3RyaW5nKCkpDQogICAgICAgIHJldHVybg0KICAgICAgfSBlbHNlIHt9DQogICAgfQ0KICAgIGxvZ2dlci5kZWJ1ZygiQ2FsbGluZyBRTVMzMDBNSSBVcGRRSVJlcXVlc3QiKQ0KICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgbG9nZ2VyLmRlYnVnKCJ1cGRRSVJlcXVlc3RQYXJhbXM6ICIgKyB1cGRRSVJlcXVlc3RQYXJhbXMudG9TdHJpbmcoKSkNCg0KICAgIG1pQ2FsbGVyLmNhbGwoIlFNUzMwME1JIiwgIlVwZFFJUmVxdWVzdCIsIHVwZFFJUmVxdWVzdFBhcmFtcywgdXBkUUlSZXF1ZXN0SGFuZGxlcikNCg0KICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gdXBkVGVzdFJlc3VsdFBhcmFtcyA9IFsNCiAgICAgICJGQUNJIjogRkFDSSwNCiAgICAgICJRUklEIjogUVJJRCwNCiAgICAgICJJVE5PIjogaUlUTk8sDQogICAgICAiUVRTVCI6ICJEVU1NWSIsDQogICAgICAiVFNUWSI6ICIyIiwNCiAgICAgICJUU0VRIjogIjAwMDEiLA0KICAgICAgIlFMQ0QiOiAiQ09NUExFVEUiLA0KICAgICAgIlZMRU4iOiAiMSINCiAgICBdDQoNCiAgICBDbG9zdXJlIDwgPyA+IHVwZFRlc3RSZXN1bHRIYW5kbGVyID0gew0KICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgIGlmIChyZXNwb25zZS5lcnJvcikgew0KICAgICAgICBsb2dnZXIuZGVidWcoIk1JIEVycm9yIHVwZFRlc3RSZXN1bHRIYW5kbGVyIikNCiAgICAgICAgbWkuZXJyb3IocmVzcG9uc2UuZXJyb3JNZXNzYWdlLnRvU3RyaW5nKCkpDQogICAgICAgIHJldHVybg0KICAgICAgfSBlbHNlIHt9DQogICAgfQ0KDQogICAgbG9nZ2VyLmRlYnVnKCJDYWxsaW5nIFFNUzQwME1JIFVwZFRlc3RSZXN1bHQiKQ0KICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgIGxvZ2dlci5kZWJ1ZygidXBkVGVzdFJlc3VsdFBhcmFtczogIiArIHVwZFRlc3RSZXN1bHRQYXJhbXMudG9TdHJpbmcoKSkNCg0KICAgIG1pQ2FsbGVyLmNhbGwoIlFNUzQwME1JIiwgIlVwZFRlc3RSZXN1bHQiLCB1cGRUZXN0UmVzdWx0UGFyYW1zLCB1cGRUZXN0UmVzdWx0SGFuZGxlcikNCiAgfQ0KDQogIHByaXZhdGUgZG91YmxlIGdldFRvdGFsUXR5TG9jQ0FNVShEQkFjdGlvbiBkYkFjdGlvbiwgREJDb250YWluZXIgZGJDb250YWluZXIsIFN0cmluZyBiYXNlQkFOTykgew0KICAgIGRvdWJsZSB0b3RRdHkgPSAwDQoNCiAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRzID0gew0KICAgICAgREJDb250YWluZXIgY29udGFpbmVyIC0+DQogICAgICBpZiAoY29udGFpbmVyLmdldFN0cmluZygiTUxCQU5PIikudHJpbSgpID09IGJhc2VCQU5PLnRyaW0oKSB8fCBjb250YWluZXIuZ2V0U3RyaW5nKCJNTEJBTk8iKS50cmltKCkuc3RhcnRzV2l0aChiYXNlQkFOTy50cmltKCkgKyAifCIpKSB7DQogICAgICAgIHRvdFF0eSArPSBjb250YWluZXIuZ2V0RG91YmxlKCJNTFNUUVQiKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8NCiAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAoZGJBY3Rpb24ucmVhZEFsbChkYkNvbnRhaW5lciwgNSwgcmVhZEFsbFJlY29yZHMpKSB7DQogICAgICAvLw0KICAgIH0NCg0KICAgIHJldHVybiB0b3RRdHkNCg0KICB9DQoNCiAgcHJpdmF0ZSB2b2lkIHVwZFF0eVN1YkxldmVscyhTdHJpbmcgbmV3V0hMTywgU3RyaW5nIG5ld1dIU0wsIFN0cmluZyBuZXdTVFFULCBTdHJpbmcgb3JpZ0JBTk8pIHsNCiAgICBEQkFjdGlvbiBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG5ld1dITE8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ0JBTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgbmV3V0hTTCkNCg0KICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhMV0hMIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWFBCQU4iKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KICAgIH0NCg0KICAgIGlmIChhY3Rpb25FWFQ0MDEucmVhZEFsbChjb250YWluZXJFWFQ0MDEsIDYsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpKSB7DQoNCiAgICAgIENsb3N1cmUgPCA/ID4gdXBkYXRlQWxsUmVjb3JkRVhUNDAxID0gew0KICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQoNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMU1RRIiwgbmV3U1RRVC50b0RvdWJsZSgpKQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCBMb2NhbERhdGUubm93KCkuZm9ybWF0KERhdGVUaW1lRm9ybWF0dGVyLm9mUGF0dGVybigiWVlZWU1NZGQiKSkudG9JbnRlZ2VyKCkpDQogICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hJRCIsIHByb2dyYW0uZ2V0VXNlcigpKQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENITk8iLCBsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpDQoNCiAgICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQogICAgICB9DQoNCiAgICAgIGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZUFsbFJlY29yZEVYVDQwMSkNCg0KICAgIH0NCg0KICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICBEQkFjdGlvbiBhY3Rpb25FWFQ0MDFfVXBkYXRlID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIxMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJFWFQ0MDFfVXBkYXRlID0gYWN0aW9uRVhUNDAxLmdldENvbnRhaW5lcigpDQoNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBwcm9ncmFtLkxEQVpELmdldCgiQ09OTyIpLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkpDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgbmV3V0hMTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBuZXdXSFNMKQ0KDQogICAgY29udGFpbmVyRVhUNDAxX1VwZGF0ZS5zZXQoIkVYQ09OTyIsIHByb2dyYW0uTERBWkQuZ2V0KCJDT05PIikudG9TdHJpbmcoKS50b0ludGVnZXIoKSkNCg0KICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMV8xID0gew0KICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICBjb250YWluZXJFWFQ0MDFfVXBkYXRlLnNldCgiRVhMV0hMIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhMV0hMIikpDQogICAgICBjb250YWluZXJFWFQ0MDFfVXBkYXRlLnNldCgiRVhQQkFOIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICBjb250YWluZXJFWFQ0MDFfVXBkYXRlLnNldCgiRVhMV0hTIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhMV0hTIikpDQogICAgfQ0KDQogICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgcmVhZEFsbFJlY29yZEVYVDQwMV8xKSkgew0KDQogICAgICBDbG9zdXJlIDwgPyA+IHVwZGF0ZUFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KDQogICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTFNUUSIsIG5ld1NUUVQudG9Eb3VibGUoKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMTURUIiwgTG9jYWxEYXRlLm5vdygpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oIllZWVlNTWRkIikpLnRvSW50ZWdlcigpKQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KDQogICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KICAgICAgfQ0KDQogICAgICBhY3Rpb25FWFQ0MDFfVXBkYXRlLnJlYWRBbGxMb2NrKGNvbnRhaW5lckVYVDQwMV9VcGRhdGUsIDYsIHVwZGF0ZUFsbFJlY29yZEVYVDQwMSkNCg0KICAgIH0NCg0KICB9DQoNCiAgcHJpdmF0ZSB2b2lkIGNydFJlY2xhc3NUb1ByZXZMb3QoU3RyaW5nIGlCQU5PX1JjbFByZXZMb3QsIFN0cmluZyBpV0hMT19SY2xQcmV2TG90LCBTdHJpbmcgaUNBTVVfUmNsUHJldkxvdCwgU3RyaW5nIGlXSFNMX1JjbFByZXZMb3QsIFN0cmluZyBpSVROT19SY2xQcmV2TG90LCBTdHJpbmcgaUUwUEFfUmNsUHJldkxvdCwgU3RyaW5nIGlFMDY1X1JjbFByZXZMb3QsIFN0cmluZyBpUk1WQ19SY2xQcmV2TG90LCBTdHJpbmcgaVJTQ0RfUmNsUHJldkxvdCkgew0KICAgIFN0cmluZyBFWFQ0MDFfU0JBTiwgRVhUNDAxX0xXSEwsIEVYVDQwMV9JVE5PLCBFWFQ0MDFfUEJBTiwgRVhUNDAxX0NBTVUsIEVYVDQwMV9MV0hTLCBFWFQ0MDFfQkFOTw0KICAgIFN0cmluZyBNSVRMT0NfQkFOTywgTUlUTE9DX1dITE8sIE1JVExPQ19JVE5PLCBNSVRMT0NfQ0FNVSwgTUlUTE9DX1dIU0wNCiAgICBib29sZWFuIHNraXBUb0Jhc2UNCg0KICAgIFN0cmluZyB6Q3VyclN0YXMsIE1JVExPQ19TVEFTLCBFWFQ0MDFfU1RBUw0KDQogICAgYm9vbGVhbiBJTjkxID0gZmFsc2UNCiAgICBib29sZWFuIElOOTMgPSBmYWxzZQ0KICAgIGJvb2xlYW4gbG9vcENvbmRpdGlvbiA9IGZhbHNlDQoNCiAgICBpbnQgQ09OTyA9IHByb2dyYW0uTERBWkQuQ09OTy50b1N0cmluZygpLnRvSW50ZWdlcigpDQoNCiAgICBEQkFjdGlvbiBhY3Rpb25NSVRXSEwgPSBkYXRhYmFzZS50YWJsZSgiTUlUV0hMIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNV0NPTk8iLCAiTVdXSExPIiwgIk1XRkFDSSIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJNSVRXSEwgPSBhY3Rpb25NSVRXSEwuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lck1JVFdITC5zZXQoIk1XQ09OTyIsIENPTk8pDQogICAgY29udGFpbmVyTUlUV0hMLnNldCgiTVdXSExPIiwgaVdITE9fUmNsUHJldkxvdCkNCg0KICAgIGFjdGlvbk1JVFdITC5yZWFkKGNvbnRhaW5lck1JVFdITCkNCg0KICAgIFN0cmluZyBiYXNlQkFOTyA9IGlCQU5PX1JjbFByZXZMb3QNCg0KICAgIGlmIChvcmlnV0hMTy50cmltKCkuaXNFbXB0eSgpKSB7DQogICAgICBvcmlnV0hMTyA9IGlXSExPX1JjbFByZXZMb3QNCiAgICAgIG9yaWdCQU5PID0gaUJBTk9fUmNsUHJldkxvdA0KICAgICAgb3JpZ0NBTVUgPSBpQ0FNVV9SY2xQcmV2TG90DQogICAgICBvcmlnV0hTTCA9IGlXSFNMX1JjbFByZXZMb3QNCiAgICB9DQoNCiAgICBEQkFjdGlvbiBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTFNUQVMiLCAiTUxTVFFUIiwgIk1MUUlBRCIsICJNTENITk8iLCAiTUxMTURUIiwgIk1MQ0hJRCIpLmJ1aWxkKCkNCiAgICBjb250YWluZXJNSVRMT0MgPSBhY3Rpb25NSVRMT0MuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ09OTyIsIENPTk8pDQogICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgb3JpZ1dITE8pDQogICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgaUlUTk9fUmNsUHJldkxvdCkNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdIU0wiLCBvcmlnV0hTTCkNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBvcmlnQkFOTykNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENBTVUiLCBvcmlnQ0FNVSkNCg0KICAgIHpDdXJyU3RhcyA9ICcnDQoNCiAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRNSVRMT0MgPSB7DQogICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgIGNvbnRhaW5lck1JVExPQyA9IHJlc3VsdENvbnRhaW5lcg0KICAgICAgekN1cnJTdGFzID0gcmVzdWx0Q29udGFpbmVyLmdldCgiTUxTVEFTIikudG9TdHJpbmcoKQ0KICAgICAgTUlUTE9DX0JBTk8gPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJNTEJBTk8iKQ0KICAgICAgTUlUTE9DX0NBTVUgPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJNTENBTVUiKQ0KICAgICAgTUlUTE9DX0lUTk8gPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJNTElUTk8iKQ0KICAgICAgTUlUTE9DX1dITE8gPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJNTFdITE8iKQ0KICAgICAgTUlUTE9DX1dIU0wgPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJNTFdIU0wiKQ0KICAgICAgTUlUTE9DX1NUQVMgPSByZXN1bHRDb250YWluZXIuZ2V0KCJNTFNUQVMiKS50b1N0cmluZygpDQogICAgfQ0KDQogICAgbG9nZ2VyLmRlYnVnKCJSY2xQcmV2TG90IEJlZm9yZSByZWFkaW5nIE1JVExPQyIpDQogICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCg0KICAgIGlmIChhY3Rpb25NSVRMT0MucmVhZEFsbChjb250YWluZXJNSVRMT0MsIDYsIHJlYWRBbGxSZWNvcmRNSVRMT0MpKSB7DQogICAgICBNYXAgPCBTdHJpbmcsIFN0cmluZyA+IGFkZFJlY2xhc3NJbnB1dHMgPSBbDQogICAgICAgICJRTFFUIjogIiIsDQogICAgICAgICJQUkZMIjogIipFWEUiLA0KICAgICAgICAiRTBQQSI6IGlFMFBBX1JjbFByZXZMb3QsDQogICAgICAgICJFMDY1IjogaUUwNjVfUmNsUHJldkxvdCwNCiAgICAgICAgIldITE8iOiBvcmlnV0hMTywNCiAgICAgICAgIldIU0wiOiBvcmlnV0hTTCwNCiAgICAgICAgIklUTk8iOiBpSVROT19SY2xQcmV2TG90LA0KICAgICAgICAiQkFOTyI6IG9yaWdCQU5PLA0KICAgICAgICAiQ0FNVSI6IG9yaWdDQU1VLA0KICAgICAgICAiTklUTiI6IGlJVE5PX1JjbFByZXZMb3QsDQogICAgICAgICJOQkFOIjogTUlUTE9DX0JBTk8sDQogICAgICAgICJRUkJTIjogIjMiDQogICAgICBdDQoNCiAgICAgIGxvZ2dlci5kZWJ1ZygiUmNsUHJldkxvdCBCZWZvcmUgcmVhZGluZyBNSVRMT0MiKQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMgKyAiIHwgekN1cnJTdGFzOiAiICsgekN1cnJTdGFzKQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCiAgICAgIGxvZ2dlci5kZWJ1ZygiYWRkUmVjbGFzc0lucHV0czogIiArIGFkZFJlY2xhc3NJbnB1dHMudG9TdHJpbmcoKSkNCg0KICAgICAgaWYgKHpDdXJyU3RhcyA9PSAiMyIgfHwgek5ld1NUQVMgPT0gJzMnKSB7DQogICAgICAgIHpOZXdTVEFTID0gIjMiDQoNCiAgICAgICAgREJBY3Rpb24gYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBDT05PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBNSVRMT0NfV0hMTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgTUlUTE9DX0lUTk8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIE1JVExPQ19CQU5PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBNSVRMT0NfQ0FNVSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgTUlUTE9DX1dIU0wpDQoNCiAgICAgICAgTGlzdCA8IERCQ29udGFpbmVyID4gYXJyYXlPZkNvbnRhaW5lcnMgPSBuZXcgQXJyYXlMaXN0IDwgREJDb250YWluZXIgPiAoKQ0KICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgICAgYXJyYXlPZkNvbnRhaW5lcnMuYWRkKHJlc3VsdENvbnRhaW5lcikNCg0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgcmVhZEFsbFJlY29yZEVYVDQwMSkpIHsNCiAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgPSBhcnJheU9mQ29udGFpbmVyc1swXQ0KDQogICAgICAgICAgYWRkUmVjbGFzc0lucHV0cy5OQkFOID0gcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhCQU5PIikNCiAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLlJTQ0QgPSAiIg0KDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSY2xQcmV2TG90IEJlZm9yZSBjYWxsaW5nIHJlamVjdEFmZmVjdEFsbExldmVscyIpDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMgKyAiIHwgekN1cnJTdGFzOiAiICsgekN1cnJTdGFzKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICByZWplY3RBZmZlY3RBbGxMZXZlbHMoQ09OTywgb3JpZ1dITE8sIG9yaWdCQU5PLCBvcmlnQ0FNVSwgb3JpZ1dIU0wsIEVYVDQwMV9TQkFOLCBFWFQ0MDFfQkFOTykNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmNsUHJldkxvdCBBZnRlciBjYWxsaW5nIHJlamVjdEFmZmVjdEFsbExldmVscyIpDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMgKyAiIHwgekN1cnJTdGFzOiAiICsgekN1cnJTdGFzKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgICAgIH0NCg0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2tpcFRvQmFzZSA9IGZhbHNlDQoNCiAgICAgICAgREJBY3Rpb24gYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBDT05PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBvcmlnV0hMTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk9fUmNsUHJldkxvdCkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ0JBTk8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIG9yaWdDQU1VKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRzRVhUNDAxID0gew0KICAgICAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgICAgIGFkZFJlY2xhc3NJbnB1dHMuTkJBTiA9IHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYUEJBTiIpDQogICAgICAgICAgYmFzZUJBTk8gPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWEJBTk8iKQ0KDQogICAgICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhMV0hMIikpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhJVE5PIikpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhQQkFOIikpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhDQU1VIikpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhMV0hTIikpDQoNCiAgICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRzRVhUNDAxXzEgPSB7DQogICAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXJfMSAtPg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxID0gcmVzdWx0Q29udGFpbmVyXzENCiAgICAgICAgICAgIEVYVDQwMV9TVEFTID0gcmVzdWx0Q29udGFpbmVyXzEuZ2V0KCJFWFNUQVMiKS50b1N0cmluZygpDQogICAgICAgICAgICBFWFQ0MDFfU0JBTiA9IHJlc3VsdENvbnRhaW5lcl8xLmdldCgiRVhTQkFOIikudG9TdHJpbmcoKQ0KICAgICAgICAgICAgRVhUNDAxX0xXSEwgPSByZXN1bHRDb250YWluZXJfMS5nZXQoIkVYTFdITCIpLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIEVYVDQwMV9JVE5PID0gcmVzdWx0Q29udGFpbmVyXzEuZ2V0KCJFWElUTk8iKS50b1N0cmluZygpDQogICAgICAgICAgICBFWFQ0MDFfUEJBTiA9IHJlc3VsdENvbnRhaW5lcl8xLmdldCgiRVhQQkFOIikudG9TdHJpbmcoKQ0KICAgICAgICAgICAgRVhUNDAxX0NBTVUgPSByZXN1bHRDb250YWluZXJfMS5nZXQoIkVYQ0FNVSIpLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIEVYVDQwMV9MV0hTID0gcmVzdWx0Q29udGFpbmVyXzEuZ2V0KCJFWExXSFMiKS50b1N0cmluZygpDQogICAgICAgICAgICBFWFQ0MDFfQkFOTyA9IHJlc3VsdENvbnRhaW5lcl8xLmdldCgiRVhCQU5PIikudG9TdHJpbmcoKQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIElOOTMgPSAhYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3Jkc0VYVDQwMV8xKQ0KDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJDaGVjayBJTjkzOiAiICsgSU45MykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIkNoZWNrIHJlc3VsdENvbnRhaW5lcjogIiArIHJlc3VsdENvbnRhaW5lci50b1N0cmluZygpKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2hlY2sgRVhTVEFTOiAiICsgcmVzdWx0Q29udGFpbmVyLmdldCgiRVhTVEFTIikudG9TdHJpbmcoKSkNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIkVYU1RBUzogIiArIEVYVDQwMV9TVEFTKQ0KICAgICAgICAgIGlmIChJTjkzKSB7DQogICAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLk5CQU4gPSBiYXNlQkFOTw0KICAgICAgICAgICAgYWRkUmVjbGFzc0lucHV0cy5BTE9DID0gIjEiDQogICAgICAgICAgICBJTjkzID0gdHJ1ZQ0KICAgICAgICAgICAgek5ld1NUQVMgPSAiMiINCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmICghSU45MyAmJiBFWFQ0MDFfU1RBUyA9PSAiMSIpIHsNCiAgICAgICAgICAgIGFkZFJlY2xhc3NJbnB1dHMuTkJBTiA9IEVYVDQwMV9TQkFODQogICAgICAgICAgICB6Q3VyclN0YXMgPSBFWFQ0MDFfU1RBUw0KICAgICAgICAgICAgek5ld1NUQVMgPSAiMSINCiAgICAgICAgICAgIElOOTMgPSB0cnVlDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoIUlOOTMgJiYgRVhUNDAxX1NUQVMgIT0gIjEiKSB7DQogICAgICAgICAgICB6TmV3U1RBUyA9IEVYVDQwMV9TVEFTDQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJSY2xQcmV2TG90IE5vdCBSZWplY3QgTG9naWMgfCBza2lwdG9CYXNlID0gZmFsc2UiKQ0KICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUyArICIgfCB6Q3VyclN0YXM6ICIgKyB6Q3VyclN0YXMpDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyRVhUNDAxOiAiICsgY29udGFpbmVyRVhUNDAxLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgaWYgKCFhY3Rpb25FWFQ0MDEucmVhZEFsbChjb250YWluZXJFWFQ0MDEsIDYsIDEsIHJlYWRBbGxSZWNvcmRzRVhUNDAxKSkgew0KDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgSU45MSA9IGZhbHNlDQogICAgICAgIH0NCg0KICAgICAgICBsb2dnZXIuZGVidWcoIkVudGVyaW5nIHRoZSBJTjkxIHdoaWxlIGxvb3AgfCBJTjkxOiAiICsgSU45MSArICIgfCBJTjkzOiAiICsgSU45MykNCg0KICAgICAgICB3aGlsZSAoIUlOOTEgJiYgIUlOOTMpIHsNCg0KICAgICAgICAgIGJvb2xlYW4gdGVzdHNWZXJpZmllZCA9IGZhbHNlOw0KDQogICAgICAgICAgaWYgKCF0ZXN0c1ZlcmlmaWVkKSB7DQogICAgICAgICAgICBEQkFjdGlvbiBhY3Rpb25RTVNSUUggPSBkYXRhYmFzZS50YWJsZSgiUU1TUlFIIikuaW5kZXgoIjMwIikuc2VsZWN0aW9uKCJSSENPTk8iLCAiUkhJVE5PIiwgIlJIQkFOTyIsICJSSFFTVEEiLCAiUkhRUlJQIiwgIlJIUUFQUiIpLnJldmVyc2UoKS5idWlsZCgpDQogICAgICAgICAgICBjb250YWluZXJRTVNSUUggPSBhY3Rpb25RTVNSUUguZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgICAgICAgY29udGFpbmVyUU1TUlFILnNldCgiUkhDT05PIiwgQ09OTykNCiAgICAgICAgICAgIGNvbnRhaW5lclFNU1JRSC5zZXQoIlJISVROTyIsIGlJVE5PX1JjbFByZXZMb3QpDQogICAgICAgICAgICBjb250YWluZXJRTVNSUUguc2V0KCJSSEJBTk8iLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWEJBTk8iKSkNCg0KICAgICAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkUU1TUlFIID0gew0KICAgICAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgICAgICAgICAgY29udGFpbmVyUU1TUlFIID0gcmVzdWx0Q29udGFpbmVyDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChhY3Rpb25RTVNSUUgucmVhZEFsbChjb250YWluZXJRTVNSUUgsIDMsIDEsIHJlYWRBbGxSZWNvcmRRTVNSUUgpKSB7DQogICAgICAgICAgICAgIGlmIChjb250YWluZXJRTVNSUUguZ2V0SW50KCJSSFFTVEEiKSA8IDQgJiYgY29udGFpbmVyUU1TUlFILmdldFN0cmluZygiUkhRUlJQIikudHJpbSgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgIHRlc3RzVmVyaWZpZWQgPSBmYWxzZQ0KICAgICAgICAgICAgICAgIHNraXBUb0Jhc2UgPSBmYWxzZQ0KDQogICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lclFNU1JRSC5nZXRJbnQoIlJIUUFQUiIpID4gMCkgew0KICAgICAgICAgICAgICAgICAgdGVzdHNWZXJpZmllZCA9IHRydWUNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyUU1TUlFILmdldEludCgiUkhRQVBSIikgPT0gMiAmJiBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFNUQVMiKSA9PSAiMSINCiAgICAgICAgICAgICAgICAgIGFzIGNoYXIpIHsNCiAgICAgICAgICAgICAgICAgIHpDdXJyU3RhcyA9ICIzIg0KICAgICAgICAgICAgICAgICAgek5ld1NUQVMgPSAiMyINCiAgICAgICAgICAgICAgICAgIHNraXBUb0Jhc2UgPSB0cnVlDQogICAgICAgICAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLk5CQU4gPSBiYXNlQkFOTw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmICh6TmV3U1RBUyA9PSAnMScgfHwgekN1cnJTdGFzID09ICczJyB8fCBza2lwVG9CYXNlIHx8ICh6TmV3U1RBUyA9PSAnMScgJiYgdGVzdHNWZXJpZmllZCkpIHsNCiAgICAgICAgICAgIGlmIChjb250YWluZXJRTVNSUUguZ2V0KCJSSFFTVEEiKSA9PSAiMSINCiAgICAgICAgICAgICAgYXMgY2hhcikgew0KICAgICAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLk5CQU4gPSBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFNCQU4iKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgSU45MSA9IHRydWUNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgQ09OTykNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhJVE5PIikpDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFBCQU4iKSkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hTIikpDQoNCiAgICAgICAgICAgIHJlYWRBbGxSZWNvcmRzRVhUNDAxID0gew0KICAgICAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxID0gcmVzdWx0Q29udGFpbmVyDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIElOOTMgPSAhYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3Jkc0VYVDQwMSkNCiAgICAgICAgICAgIElOOTEgPSBJTjkzDQoNCiAgICAgICAgICAgIGlmIChJTjkzKSB7DQogICAgICAgICAgICAgIGFkZFJlY2xhc3NJbnB1dHMuTkJBTiA9IGJhc2VCQU5PDQogICAgICAgICAgICAgIGFkZFJlY2xhc3NJbnB1dHMuQUxPQyA9ICIxIg0KICAgICAgICAgICAgICBJTjkxID0gdHJ1ZQ0KICAgICAgICAgICAgICB6TmV3U1RBUyA9ICIyIg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFJTjkzICYmIGNvbnRhaW5lckVYVDQwMS5nZXQoIkVYU1RBUyIpID09ICIxIg0KICAgICAgICAgICAgICBhcyBjaGFyKSB7DQogICAgICAgICAgICAgIGFkZFJlY2xhc3NJbnB1dHMuTkJBTiA9IGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYU0JBTiIpDQogICAgICAgICAgICAgIHpDdXJyU3RhcyA9IGNvbnRhaW5lckVYVDQwMS5nZXQoIkVYU1RBUyIpLnRvU3RyaW5nKCkNCiAgICAgICAgICAgICAgek5ld1NUQVMgPSAiMSINCiAgICAgICAgICAgICAgSU45MSA9IHRydWUNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghSU45MyAmJiBjb250YWluZXJFWFQ0MDEuZ2V0KCJFWFNUQVMiKSA9PSAiMSINCiAgICAgICAgICAgICAgYXMgY2hhcikgew0KICAgICAgICAgICAgICB6TmV3U1RBUyA9IGNvbnRhaW5lckVYVDQwMS5nZXQoIkVYU1RBUyIpDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGlmICh6TmV3U1RBUyA9PSAiOSIpIHsNCiAgICAgICAgek5ld1NUQVMgPSAiMiINCiAgICAgIH0NCg0KICAgICAgbG9nZ2VyLmRlYnVnKCJJTjkzOiAiICsgSU45MyArICIgfCBhZGRSZWNsYXNzSW5wdXRzOiAiICsgYWRkUmVjbGFzc0lucHV0cy5OQkFOICsgIiB8IGJhc2VCQU5POiAiICsgYmFzZUJBTk8gKyAiIHwgenpDdXJyU3RhczogIiArIHpDdXJyU3RhcyArICIgfCB6TmV3U1RBUzogIiArIHpOZXdTVEFTKQ0KDQogICAgICBpZiAoKElOOTMgfHwgYWRkUmVjbGFzc0lucHV0cy5nZXQoIk5CQU4iKSA9PSBiYXNlQkFOTykgJiYgekN1cnJTdGFzICE9ICIzIiAmJiB6TmV3U1RBUyAhPSAiMyIpIHsNCiAgICAgICAgYWRkUmVjbGFzc0lucHV0cy5SU0NEID0gIiINCg0KICAgICAgICBEQkFjdGlvbiBhY3Rpb25RTVNSUUggPSBkYXRhYmFzZS50YWJsZSgiUU1TUlFIIikuaW5kZXgoIjMwIikuc2VsZWN0aW9uKCJSSENPTk8iLCAiUkhJVE5PIiwgIlJIQkFOTyIsICJSSFFTVEEiLCAiUkhRUlJQIiwgIlJIUUFQUiIpLmJ1aWxkKCkNCiAgICAgICAgREJDb250YWluZXIgY29udGFpbmVyUU1TUlFIID0gYWN0aW9uUU1TUlFILmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgY29udGFpbmVyUU1TUlFILnNldCgiUkhDT05PIiwgQ09OTykNCiAgICAgICAgY29udGFpbmVyUU1TUlFILnNldCgiUkhJVE5PIiwgaUlUTk9fUmNsUHJldkxvdCkNCiAgICAgICAgY29udGFpbmVyUU1TUlFILnNldCgiUkhCQU5PIiwgYWRkUmVjbGFzc0lucHV0cy5nZXRPckRlZmF1bHQoIk5CQU4iLCAiIikpDQoNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZWFkaW5nIFFNU1JRSCBJTjkzOiAiICsgY29udGFpbmVyUU1TUlFILnRvU3RyaW5nKCkpDQoNCiAgICAgICAgTGlzdCA8IERCQ29udGFpbmVyID4gYXJyYXlPZkNvbnRhaW5lcnMgPSBuZXcgQXJyYXlMaXN0IDwgPiAoKQ0KDQogICAgICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZFFNU1JRSCA9IHsNCiAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgICAgICBhcnJheU9mQ29udGFpbmVycy5hZGQocmVzdWx0Q29udGFpbmVyKQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGFjdGlvblFNU1JRSC5yZWFkQWxsKGNvbnRhaW5lclFNU1JRSCwgMywgcmVhZEFsbFJlY29yZFFNU1JRSCkpIHsNCiAgICAgICAgICBpbnQgYXJyYXlTaXplID0gYXJyYXlPZkNvbnRhaW5lcnMuc2l6ZSgpDQogICAgICAgICAgaWYgKGFycmF5U2l6ZSA+PSAxKSB7DQogICAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgPSBhcnJheU9mQ29udGFpbmVyc1thcnJheU9mQ29udGFpbmVycy5zaXplKCkgLSAxXQ0KDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIk1JVExPQ19TVEFTOiAiICsgTUlUTE9DX1NUQVMgKyAiIHwgUU1TUlFIIHJlY29yZCBmb3VuZDogIiArIHJlc3VsdENvbnRhaW5lci50b1N0cmluZygpKQ0KDQogICAgICAgICAgICBpZiAocmVzdWx0Q29udGFpbmVyLmdldEludCgiUkhRU1RBIikgPCA0ICYmIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIlJIUVJSUCIpLnRyaW0oKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgaWYgKHJlc3VsdENvbnRhaW5lci5nZXRJbnQoIlJIUUFQUiIpID09IDIgJiYgTUlUTE9DX1NUQVMgPT0gIjEiKSB7DQogICAgICAgICAgICAgICAgekN1cnJTdGFzID0gIjMiDQogICAgICAgICAgICAgICAgek5ld1NUQVMgPSAiMyINCiAgICAgICAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLk5CQU4gPSBiYXNlQkFOTw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoek5ld1NUQVMgPT0gIjIiICYmIHJlc3VsdENvbnRhaW5lci5nZXRJbnQoIlJIUUFQUiIpID09IDAgJiYgYWRkUmVjbGFzc0lucHV0cy5OQkFOID09IGJhc2VCQU5PKSB7DQogICAgICAgICAgICAgIHpOZXdTVEFTID0gIjEiDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIERCQWN0aW9uIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBvcmlnV0hMTykNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ0JBTk8pDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdXSFNMKQ0KDQogICAgICBMaXN0IDwgTG9ja2VkUmVzdWx0ID4gbG9ja2VkUmVzdWx0c0xpc3QgPSBuZXcgQXJyYXlMaXN0IDwgTG9ja2VkUmVzdWx0ID4gKCkNCg0KICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkRVhUNDAxID0gew0KICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgIGxvY2tlZFJlc3VsdHNMaXN0LmFkZChsb2NrZWRSZXN1bHQpDQogICAgICB9DQoNCiAgICAgIGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpDQoNCiAgICAgIGlmIChsb2NrZWRSZXN1bHRzTGlzdC5zaXplKCkgPiAwKSB7DQogICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgPSBsb2NrZWRSZXN1bHRzTGlzdFswXQ0KICAgICAgICBpZiAoaVJNVkNfUmNsUHJldkxvdC50cmltKCkgPT0gIjEiKSB7DQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgIjkiDQogICAgICAgICAgICBhcyBjaGFyKQ0KICAgICAgICB9DQogICAgICAgIGlmICghaVJTQ0RfUmNsUHJldkxvdC50cmltKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhSU0NEIiwgaVJTQ0RfUmNsUHJldkxvdCkNCiAgICAgICAgfQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExTVFEiLCBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFNUUVQiKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMTURUIiwgdXRpbGl0eS5jYWxsKCJEYXRlVXRpbCIsICJjdXJyZW50RGF0ZVk4QXNJbnQiKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hOTyIsIGxvY2tlZFJlc3VsdC5nZXRJbnQoIkVYQ0hOTyIpICsgMSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQogICAgICB9DQoNCiAgICAgIGxvZ2dlci5kZWJ1ZygiSU45MzogIiArIElOOTMgKyAiIHwgYWRkUmVjbGFzc0lucHV0czogIiArIGFkZFJlY2xhc3NJbnB1dHMuTkJBTiArICIgfCBiYXNlQkFOTzogIiArIGJhc2VCQU5PICsgIiB8IHp6Q3VyclN0YXM6ICIgKyB6Q3VyclN0YXMgKyAiIHwgek5ld1NUQVM6ICIgKyB6TmV3U1RBUykNCg0KICAgICAgaWYgKHh4Q2hnU3RzKSB7DQogICAgICAgIGFkZFJlY2xhc3NJbnB1dHMuU1RBUyA9IHpOZXdTVEFTDQogICAgICB9IGVsc2Ugew0KICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLlNUQVMgPSAiMSINCiAgICAgIH0NCg0KICAgICAgYWRkUmVjbGFzc0lucHV0cy5BTE9DID0gIjEiDQoNCiAgICAgIENsb3N1cmUgPCA/ID4gYWRkUmVjbGFzc0NhbGxiYWNrID0gew0KICAgICAgICBNYXAgPCBTdHJpbmcsDQogICAgICAgIFN0cmluZyA+IHJlc3BvbnNlIC0+DQogICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikgew0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiTUkgRXJyb3IgYWRkUmVjbGFzc0NhbGxiYWNrIikNCiAgICAgICAgICBtaS5lcnJvcihyZXNwb25zZS5lcnJvck1lc3NhZ2UudG9TdHJpbmcoKSkNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hMTyIsIGFkZFJlY2xhc3NJbnB1dHMuV0hMTykNCiAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgYWRkUmVjbGFzc0lucHV0cy5JVE5PKQ0KICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdIU0wiLCBhZGRSZWNsYXNzSW5wdXRzLldIU0wpDQogICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIGFkZFJlY2xhc3NJbnB1dHMuTkJBTikNCiAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDQU1VIiwgYWRkUmVjbGFzc0lucHV0cy5DQU1VKQ0KDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiUmNsUHJldkxvdCBGaW5hbCIpDQogICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTICsgIiB8IHpDdXJyU3RhczogIiArIHpDdXJyU3RhcyArICIgfCBza2lwVG9CYXNlOiAiICsgc2tpcFRvQmFzZSkNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCiAgICAgIH0NCg0KICAgICAgaWYgKCFhZGRSZWNsYXNzSW5wdXRzLldIU0wuY29udGFpbnMoJz0+JykpIHsNCiAgICAgICAgbWlDYWxsZXIuY2FsbCgiTU1TODUwTUkiLCAiQWRkUmVjbGFzcyIsIGFkZFJlY2xhc3NJbnB1dHMsIGFkZFJlY2xhc3NDYWxsYmFjaykNCiAgICAgIH0NCg0KICAgIH0gZWxzZSB7DQoNCiAgICAgIGlmIChpUk1WQ19SY2xQcmV2TG90ID09ICIxIikgew0KICAgICAgICBEQkFjdGlvbiBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjAwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBDT05PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCBpSVROT19SY2xQcmV2TG90KQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ0NBTVUpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdXSExPKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYU1RBUyIsICI5IikNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hJRCIsIHByb2dyYW0uZ2V0VXNlcigpKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hOTyIsIGxvY2tlZFJlc3VsdC5nZXRJbnQoIkVYQ0hOTyIpICsgMSkNCiAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiRWxzZSBjb25kaXRpb24uIFJlY29yZCB1cGRhdGVkIiArIGNvbnRhaW5lckVYVDQwMS50b1N0cmluZygpKQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiRWxzZSBjb25kaXRpb24uIFJlY29yZCBkb2VzIG5vdCBleGlzdCIgKyBjb250YWluZXJFWFQ0MDEudG9TdHJpbmcoKSkNCiAgICAgICAgICBtaS5lcnJvcigiUmVjb3JkIGRvZXMgbm90IGV4aXN0IikNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgfQ0KDQogIH0NCg0KICBwcml2YXRlIHZvaWQgcmVqZWN0QWZmZWN0QWxsTGV2ZWxzKGludCBDT05PLCBTdHJpbmcgb3JpZ1dITE8sIFN0cmluZyBvcmlnQkFOTywgU3RyaW5nIG9yaWdDQU1VLCBTdHJpbmcgb3JpZ1dIU0wsIFN0cmluZyBFWFQ0MDFfU0JBTiwgU3RyaW5nIEVYVDQwMV9CQU5PKSB7DQogICAgU3RyaW5nIHh4VFhWUiA9ICIgIiAqIDEwDQogICAgU3RyaW5nIHh4VFg2MCA9ICIgIiAqIDYwDQoNCiAgICBsb2dnZXIuZGVidWcoIlVwd2FyZHMgaW4gdGhlIEhpZXJhcmNoeSIpDQogICAgLy8gQ2hhbmdlIGFsbCBTdWItTGV2ZWxzIChVcHdhcmRzIGluIHRoZSBIaWVyYXJjaHkhKSAmIEFkZCBUZXh0IHRvIFN1Yi1Mb3QNCiAgICBEQkFjdGlvbiBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgQ09OTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBvcmlnV0hMTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgY29udGFpbmVyRVhUNDAxID0gcmVzdWx0Q29udGFpbmVyDQogICAgfQ0KDQogICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZEVYVDQwMSkpIHsNCg0KICAgICAgeHhUWFZSID0gIkRJU1AiDQogICAgICB4eFRYNjAgPSAiUmVqIFN1Yi1Mb3Q6ICIgKyBvcmlnQkFOTy5yZXBsYWNlQWxsKC8gKiQvLCAnJykgKyAiIEM6ICIgKyBvcmlnQ0FNVS5yZXBsYWNlQWxsKC8gKiQvLCAnJykNCiAgICAgIGFkZEZyZWVUZXh0KHh4VFhWUiwgeHhUWDYwLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCg0KICAgICAgeHhUWFZSID0gIkRJU1AiDQogICAgICB4eFRYNjAgPSAiUmVqIEZyb20gTDogIiArIG15THZsX0JBTk8ucmVwbGFjZUFsbCgvICokLywgJycpICsgIiBDOiAiICsgb3JpZ0NBTVUucmVwbGFjZUFsbCgvICokLywgJycpDQogICAgICBhZGRGcmVlVGV4dCh4eFRYVlIsIHh4VFg2MCwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQoNCiAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMTAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWElUTk8iKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWENBTVUiKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KDQogICAgICBDbG9zdXJlIDwgPyA+IHVwZGF0ZUVYVDQwMSA9IHsNCiAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KDQogICAgICAgIGxvY2tlZFJlc3VsdC5hbGxDb2x1bW5zLmVhY2ggew0KICAgICAgICAgIFN0cmluZyBjb2x1bW4gLT4NCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoY29sdW1uLCBsb2NrZWRSZXN1bHQuZ2V0KGNvbHVtbikpDQogICAgICAgIH0NCg0KICAgICAgICBpZiAobG9ja2VkUmVzdWx0LmdldCgiRVhTVEFTIikudG9TdHJpbmcoKSA9PSAiMSIpIHsNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWFNUQVMiLCAiMyIpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMTURUIiwgdXRpbGl0eS5jYWxsKCJEYXRlVXRpbCIsICJjdXJyZW50RGF0ZVk4QXNJbnQiKSkNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENITk8iLCBsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQogICAgICAgIH0NCg0KICAgICAgICB4eFRYVlIgPSAiRElTUCINCiAgICAgICAgeHhUWDYwID0gIlJlaiBTdWItTG90OiAiICsgb3JpZ0JBTk8ucmVwbGFjZUFsbCgvICokLywgJycpICsgIiBDOiAiICsgb3JpZ0NBTVUucmVwbGFjZUFsbCgvICokLywgJycpDQogICAgICAgIGFkZEZyZWVUZXh0KHh4VFhWUiwgeHhUWDYwLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCg0KICAgICAgICB4eFRYVlIgPSAiRElTUCINCiAgICAgICAgeHhUWDYwID0gIlJlaiBGcm9tIEw6ICIgKyBteUx2bF9CQU5PLnJlcGxhY2VBbGwoLyAqJC8sICcnKSArICIgQzogIiArIG9yaWdDQU1VLnJlcGxhY2VBbGwoLyAqJC8sICcnKQ0KICAgICAgICBhZGRGcmVlVGV4dCh4eFRYVlIsIHh4VFg2MCwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQoNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgQ09OTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hMIikpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYUEJBTiIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYU0JBTiIpKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWENBTVUiKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hTIikpDQogICAgICB9DQoNCiAgICAgIHdoaWxlIChhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCB1cGRhdGVFWFQ0MDEpKSB7DQogICAgICAgIC8vDQogICAgICB9DQoNCiAgICB9DQoNCiAgICBsb2dnZXIuZGVidWcoIkRvd253YXJkcyBpbiB0aGUgSGllcmFyY2h5IikNCiAgICAvLyBDaGFuZ2UgYWxsIFByZS1MZXZlbHMgKERvd253YXJkcyBpbiB0aGUgSGllcmFyY2h5ISkgJiBBZGQgVGV4dCB0byBTdWItTG90DQogICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ1dITE8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ0JBTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ0NBTVUpDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgb3JpZ1dIU0wpDQoNCiAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBDT05PKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hMIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFBCQU4iKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hTIikpDQoNCiAgICAgIENsb3N1cmUgPCA/ID4gdXBkYXRlRVhUNDAxID0gew0KICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQoNCiAgICAgICAgbG9ja2VkUmVzdWx0LmFsbENvbHVtbnMuZWFjaCB7DQogICAgICAgICAgU3RyaW5nIGNvbHVtbiAtPg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldChjb2x1bW4sIGxvY2tlZFJlc3VsdC5nZXQoY29sdW1uKSkNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChsb2NrZWRSZXN1bHQuZ2V0KCJFWFNUQVMiKS50b1N0cmluZygpID09ICIxIikgew0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYU1RBUyIsICIzIikNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hJRCIsIHByb2dyYW0uZ2V0VXNlcigpKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hOTyIsIGxvY2tlZFJlc3VsdC5nZXRJbnQoIkVYQ0hOTyIpICsgMSkNCiAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCiAgICAgICAgfQ0KDQogICAgICAgIHh4VFhWUiA9ICJESVNQIg0KICAgICAgICB4eFRYNjAgPSAiUmVqIFN1Yi1Mb3Q6ICIgKyBvcmlnQkFOTy5yZXBsYWNlQWxsKC8gKiQvLCAnJykgKyAiIEM6ICIgKyBvcmlnQ0FNVS5yZXBsYWNlQWxsKC8gKiQvLCAnJykNCiAgICAgICAgYWRkRnJlZVRleHQoeHhUWFZSLCB4eFRYNjAsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYU0JBTiIpKQ0KDQogICAgICAgIHh4VFhWUiA9ICJESVNQIg0KICAgICAgICB4eFRYNjAgPSAiUmVqIEZyb20gTDogIiArIG15THZsX0JBTk8ucmVwbGFjZUFsbCgvICokLywgJycpICsgIiBDOiAiICsgb3JpZ0NBTVUucmVwbGFjZUFsbCgvICokLywgJycpDQogICAgICAgIGFkZEZyZWVUZXh0KHh4VFhWUiwgeHhUWDYwLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBDT05PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhQQkFOIikpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCiAgICAgIH0NCg0KICAgICAgd2hpbGUgKGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZUVYVDQwMSkpIHsNCiAgICAgICAgLy8NCiAgICAgIH0NCg0KICAgIH0NCg0KICAgIGxvZ2dlci5kZWJ1ZygiQkFTRSBMb3QiKQ0KICAgIC8vIEFkZCBUZXh0IHRvIEJBU0UgTG90DQogICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ1dITE8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ0JBTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ0NBTVUpDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgb3JpZ1dIU0wpDQoNCiAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KICAgICAgeHhUWFZSID0gIkRJU1AiDQogICAgICB4eFRYNjAgPSAiUmVqIFN1Yi1Mb3Q6ICIgKyBvcmlnQkFOTy5yZXBsYWNlQWxsKC8gKiQvLCAnJykgKyAiIEM6ICIgKyBvcmlnQ0FNVS5yZXBsYWNlQWxsKC8gKiQvLCAnJykNCiAgICAgIGFkZEZyZWVUZXh0KHh4VFhWUiwgeHhUWDYwLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWEJBTk8iKSkNCg0KICAgICAgeHhUWFZSID0gIkRJU1AiDQogICAgICB4eFRYNjAgPSAiUmVqIEZyb20gTDogIiArIG15THZsX0JBTk8ucmVwbGFjZUFsbCgvICokLywgJycpICsgIiBDOiAiICsgb3JpZ0NBTVUucmVwbGFjZUFsbCgvICokLywgJycpDQogICAgICBhZGRGcmVlVGV4dCh4eFRYVlIsIHh4VFg2MCwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhCQU5PIikpDQogICAgfQ0KDQogIH0NCg0KICBwcml2YXRlIHZvaWQgYWRkRnJlZVRleHQoU3RyaW5nIFRYVlIsIFN0cmluZyBUWDYwLCBTdHJpbmcgTG90TnVtYmVyKSB7DQogICAgTWFwIDwgU3RyaW5nLCBTdHJpbmcgPiBhZGRGcmVlVGV4dElucHV0cyA9IFsNCiAgICAgICJJVE5PIjogaUlUTk8sDQogICAgICAiQkFOTyI6IExvdE51bWJlciwNCiAgICAgICJUWFZSIjogVFhWUiwNCiAgICAgICJUWDYwIjogVFg2MA0KICAgIF0NCg0KICAgIENsb3N1cmUgPCA/ID4gYWRkRnJlZVRleHRDYWxsYmFjayA9IHsNCiAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgIFN0cmluZyA+IHJlc3BvbnNlIC0+DQogICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJNSSBFcnJvciBhZGRGcmVlVGV4dENhbGxiYWNrIikNCiAgICAgICAgbWkuZXJyb3IocmVzcG9uc2UuZXJyb3JNZXNzYWdlLnRvU3RyaW5nKCkpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgIH0NCg0KICAgIG1pQ2FsbGVyLmNhbGwoIk1NUzIzNU1JIiwgIkFkZEZyZWVUZXh0IiwgYWRkRnJlZVRleHRJbnB1dHMsIGFkZEZyZWVUZXh0Q2FsbGJhY2spDQoNCiAgfQ0KDQogIHByaXZhdGUgdm9pZCBjYWxsTU1TODUwTUlfQWRkUmNsTG90U3RzKE1hcCA8IFN0cmluZywgU3RyaW5nID4gYWRkUmNsTG90U3RzUGFyYW1zKSB7DQoNCiAgICBDbG9zdXJlIDwgPyA+IGFkZFJjbExvdFN0c0hhbmRsZXIgPSB7DQogICAgICBNYXAgPCBTdHJpbmcsDQogICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgbG9nZ2VyLmRlYnVnKCJNTVM4NTBNSS5BZGRSY2xMb3RTdHMgcmVzcG9uc2U6ICIgKyByZXNwb25zZS50b1N0cmluZygpKQ0KICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7DQogICAgICAgIC8vDQogICAgICB9IGVsc2Ugew0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiQ09OTyIsIHJlc3BvbnNlLmdldCgiQ09OTyIpLnRvU3RyaW5nKCkpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJNU0dTIiwgcmVzcG9uc2UuZ2V0KCJNU0dTIikudG9TdHJpbmcoKSkNCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIk1TTE4iLCByZXNwb25zZS5nZXQoIk1TTE4iKS50b1N0cmluZygpKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiTVNOUiIsIHJlc3BvbnNlLmdldCgiTVNOUiIpLnRvU3RyaW5nKCkpDQogICAgICAgIG1pLndyaXRlKCkNCiAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAoIWFkZFJjbExvdFN0c1BhcmFtcy5XSFNMLmNvbnRhaW5zKCc9PicpKSB7DQogICAgICBtaUNhbGxlci5jYWxsKCJNTVM4NTBNSSIsICJBZGRSY2xMb3RTdHMiLCBhZGRSY2xMb3RTdHNQYXJhbXMsIGFkZFJjbExvdFN0c0hhbmRsZXIpDQogICAgfSBlbHNlIHsNCiAgICAgIENsb3N1cmUgPCA/ID4gYWRkUmVjb3JkSGFuZGxlciA9IHsNCiAgICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICBsb2dnZXIuZGVidWcoIkVYVDEzME1JLkFkZFJlY29yZCByZXNwb25zZTogIiArIHJlc3BvbnNlLnRvU3RyaW5nKCkpDQogICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikgew0KICAgICAgICAgIG1pLmVycm9yKHJlc3BvbnNlLmVycm9yTWVzc2FnZS50b1N0cmluZygpKQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9IGVsc2Uge30NCiAgICAgIH0NCg0KICAgICAgZGVmIGFkZFJlY29yZElucHV0cyA9IFsNCiAgICAgICAgIldITE8iOiBhZGRSY2xMb3RTdHNQYXJhbXMuV0hMTywNCiAgICAgICAgIklUTk8iOiBpSVROTywNCiAgICAgICAgIldIU0wiOiBhZGRSY2xMb3RTdHNQYXJhbXMuV0hTTCwNCiAgICAgICAgIkJBTk8iOiBhZGRSY2xMb3RTdHNQYXJhbXMuQkFOTywNCiAgICAgICAgIkNBTVUiOiBhZGRSY2xMb3RTdHNQYXJhbXMuQ0FNVSwNCiAgICAgICAgIk5TVFMiOiB6TmV3U1RBUywNCiAgICAgICAgIlNUQVQiOiAiMjAiLA0KICAgICAgXQ0KICAgICAgbWlDYWxsZXIuY2FsbCgiRVhUMTA3TUkiLCAiQWRkUmVjb3JkIiwgYWRkUmVjb3JkSW5wdXRzLCBhZGRSZWNvcmRIYW5kbGVyKQ0KICAgIH0NCg0KICB9DQoNCiAgcHJpdmF0ZSB2b2lkIHNldEJhbGFuY2VSY2xEYXRlKFN0cmluZyBpV0hMTywgU3RyaW5nIGlJVE5PLCBTdHJpbmcgaVdIU0wsIFN0cmluZyBpQkFOTykgew0KICAgIHVwZGF0ZU1JTE9NQVJlY29yZChpV0hMTywgaUlUTk8sIGlXSFNMLCBpQkFOTykNCiAgfQ0KDQogIHByaXZhdGUgdm9pZCB1cGRhdGVNSUxPTUFSZWNvcmQoU3RyaW5nIGlXSExPLCBTdHJpbmcgaUlUTk8sIFN0cmluZyBpV0hTTCwgU3RyaW5nIGlCQU5PKSB7DQogICAgREJBY3Rpb24gYWN0aW9uTUlMT01BID0gZGF0YWJhc2UudGFibGUoIk1JTE9NQSIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiUUlBRCIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJNSUxPTUEgPSBhY3Rpb25NSUxPTUEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lck1JTE9NQS5zZXQoIkxNQ09OTyIsIHByb2dyYW0uTERBWkQuQ09OTyBhcyBpbnQpDQogICAgY29udGFpbmVyTUlMT01BLnNldCgiTE1JVE5PIiwgaUlUTk8pDQogICAgY29udGFpbmVyTUlMT01BLnNldCgiTE1CQU5PIiwgaUJBTk8pDQoNCiAgICAvLyBVcGRhdGUgY2hhbmdlZCBpbmZvcm1hdGlvbg0KICAgIGFjdGlvbk1JTE9NQS5yZWFkTG9jayhjb250YWluZXJNSUxPTUEsIHVwZGF0ZU1JTE9NQSkNCg0KICB9DQoNCiAgLyoqDQogICAqIENsb3N1cmUgZm9yIE1JTE9NQSBVcGRhdGUNCiAgICovDQoNCiAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVNSUxPTUEgPSB7DQogICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KDQogICAgUUlBREZyb21NSUxPTUEgPSBsb2NrZWRSZXN1bHQuZ2V0SW50KCJMTVFJQUQiKQ0KDQogICAgaWYgKFFJQURGcm9tTUlMT01BID09IDApIHsNCiAgICAgIC8vIENvcHkgUkdEVCB0byBRSUFEDQogICAgICBsb2NrZWRSZXN1bHQuc2V0KCJMTVFJQUQiLCBsb2NrZWRSZXN1bHQuZ2V0KCJMTVJHRFQiKSkNCg0KICAgICAgLy8gVXBkYXRlIGNoYW5nZWQgaW5mb3JtYXRpb24NCiAgICAgIGludCBjaGFuZ2VOdW1iZXIgPSBsb2NrZWRSZXN1bHQuZ2V0SW50KCJMTUNITk8iKQ0KICAgICAgaW50IG5ld0NoYW5nZU51bWJlciA9IGNoYW5nZU51bWJlciArIDENCg0KICAgICAgbG9ja2VkUmVzdWx0LnNldCgiTE1MTURUIiwgdXRpbGl0eS5jYWxsKCJEYXRlVXRpbCIsICJjdXJyZW50RGF0ZVk4QXNJbnQiKSkNCiAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkxNQ0hOTyIsIG5ld0NoYW5nZU51bWJlcikNCiAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkxNQ0hJRCIsIHByb2dyYW0uZ2V0VXNlcigpKQ0KICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQoNCiAgICB9IGVsc2UgaWYgKFFJQURGcm9tTUlMT01BID4gMCkgew0KICAgICAgREJBY3Rpb24gYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCIxNSIpLnNlbGVjdGlvbigiUUlBRCIpLmJ1aWxkKCkNCiAgICAgIERCQ29udGFpbmVyIGNvbnRhaW5lck1JVExPQyA9IGFjdGlvbk1JVExPQy5nZXRDb250YWluZXIoKQ0KDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENPTk8iLCBwcm9ncmFtLkxEQVpELkNPTk8gYXMgaW50KQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgaUlUTk8pDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBpQkFOTykNCg0KICAgICAgaWYgKCFhY3Rpb25NSVRMT0MucmVhZEFsbExvY2soY29udGFpbmVyTUlUTE9DLCAzLCB1cGRhdGVNSVRMT0MpKSB7DQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQoNCiAgICAgIGxvZ2dlci5kZWJ1ZygiTUkgRXJyb3IgQ1BGOTg5OCIpDQogICAgICBtaS5lcnJvcigiIiwgIkNQRjk4OTgiLCAiTG90ICIgKyBpQkFOTyArICIgbm90IGluIExvdC1NYXN0ZXIgT1IgUUkgRGF0ZSBub3Qgc2V0ISIpDQogICAgICByZXR1cm4NCiAgICB9DQoNCiAgfQ0KDQogIENsb3N1cmUgPCA/ID4gdXBkYXRlTUlUTE9DID0gew0KICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCg0KICAgIGxvZ2dlci5kZWJ1ZygiUUlBRDogIiArIGxvY2tlZFJlc3VsdC5nZXQoIk1MUUlBRCIpKQ0KICAgIGlmIChsb2NrZWRSZXN1bHQuZ2V0KCJNTFFJQUQiKSA9PSAwKSB7DQogICAgICAvLyBDb3B5IFFJQUQgdG8gUUlBRCBmcm9tIE1JTE9NQQ0KICAgICAgbG9ja2VkUmVzdWx0LnNldCgiTUxRSUFEIiwgUUlBREZyb21NSUxPTUEpDQoNCiAgICAgIC8vIFVwZGF0ZSBjaGFuZ2VkIGluZm9ybWF0aW9uDQogICAgICBpbnQgY2hhbmdlTnVtYmVyID0gbG9ja2VkUmVzdWx0LmdldEludCgiTUxDSE5PIikNCiAgICAgIGludCBuZXdDaGFuZ2VOdW1iZXIgPSBjaGFuZ2VOdW1iZXIgKyAxDQoNCiAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIk1MTE1EVCIsIHV0aWxpdHkuY2FsbCgiRGF0ZVV0aWwiLCAiY3VycmVudERhdGVZOEFzSW50IikpDQogICAgICBsb2NrZWRSZXN1bHQuc2V0KCJNTENITk8iLCBuZXdDaGFuZ2VOdW1iZXIpDQogICAgICBsb2NrZWRSZXN1bHQuc2V0KCJNTENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCiAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KDQogICAgfQ0KICB9DQp9"}}}