{"programModules":{"EXT130MI":{"program":"EXT130MI","triggers":{},"transactions":{"UpdLastLoc":{"sourceUuid":"c3170a88-11de-4be8-9854-5972e67f9dc5","name":"UpdLastLoc","program":"EXT130MI","description":"Update Last Location used for Balance","active":true,"multi":false,"modified":1697877439868,"modifiedBy":"900107","outputFields":[{"name":"LWHL","description":"Warehouse","length":3,"mandatory":false,"type":"A"},{"name":"LWHS","description":"Location","length":10,"mandatory":false,"type":"A"},{"name":"STAS","description":"Status","length":1,"mandatory":false,"type":"A"}],"inputFields":[{"name":"CONO","description":"Company","length":3,"mandatory":true,"type":"N"},{"name":"ITNO","description":"Item Number","length":15,"mandatory":true,"type":"A"},{"name":"SBAN","description":"Sub Lot number","length":20,"mandatory":true,"type":"A"},{"name":"CAMU","description":"Container","length":20,"mandatory":true,"type":"A"},{"name":"LWHL","description":"Last(New) Warehouse","length":3,"mandatory":true,"type":"A"},{"name":"LWHS","description":"Last(New) Location","length":10,"mandatory":true,"type":"A"},{"name":"TTYP","description":"Transaction Type","length":2,"mandatory":false,"type":"N"},{"name":"LMTS","description":"Timestamp","length":18,"mandatory":false,"type":"A"},{"name":"WHLO","description":"warehouse","length":3,"mandatory":true,"type":"A"},{"name":"RGDT","description":"entry date","length":8,"mandatory":true,"type":"A"},{"name":"RGTM","description":"entry time","length":6,"mandatory":true,"type":"A"},{"name":"TMSX","description":"time suffix","length":3,"mandatory":true,"type":"A"}],"utilities":["DateUtil"],"market":"ALL"}},"batches":{},"advancedPrograms":{}}},"utilities":{},"sources":{"c3170a88-11de-4be8-9854-5972e67f9dc5":{"uuid":"c3170a88-11de-4be8-9854-5972e67f9dc5","updated":1697563277243,"updatedBy":"900107","created":1697877400354,"createdBy":"900107","apiVersion":"UNKNOWN","beVersion":"16.0.0.20230822184312.7","language":"GROOVY","codeHash":"E17BD2B1BCA5587FE8BA0EFE7D7927E5C99DDB55ED6EBA29D7585EC85CB68D14","code":"LyoqDQogKiBSRUFETUUNCiAqIFRoaXMgdHJhbnNhY3Rpb24gaXMgdXNlZCB0byB1cGRhdGUgdGhlIGN1c3RvbSBRTVMgcmVjb3JkcyB0byB0aGUgbGFzdCBsb2NhdGlvbiBvZiB0aGUgYmFsYW5jZSBpZC4NCiAqIE5hbWU6IEVYVDEzME1JLlVwZExhc3RMb2MNCiAqIERlc2NyaXB0aW9uOiB1cGRhdGUgbGFzdCBsb2NhdGlvbiBvZiB0aGUgYmFsYW5jZSBpZA0KICoNCiAqIERhdGUJICAgICAgQ2hhbmdlZCBCeSAgICAgIERlc2NyaXB0aW9uDQogKiAyMDIyMTIyMSAgIEFqYXkgICAgICAgICAgICBVcGRhdGUgbGFzdCBsb2NhdGlvbiBvZiB0aGUgYmFsYW5jZSBpZA0KICogMjAyMzA3MDEgICBBamF5ICAgICAgICAgICAgVXBkYXRlZCB0aGUgbG9naWMgdG8gcmVhZCBkYXRhIGZyb20gTUlUVFJBIGFuZCBzb21lIG90aGVyIGJ1c2luZXNzIGZ1bmN0aW9uYWxpdHkNCiAqIDIwMjMxMDE3ICAgQWpheSAgICAgICAgICAgIENvZGUgQ2xlYW51cA0KICovDQoNCmltcG9ydCBqYXZhLnRpbWUuSW5zdGFudA0KaW1wb3J0IGphdmEudGltZS5Mb2NhbERhdGUNCmltcG9ydCBqYXZhLnRpbWUuTG9jYWxEYXRlVGltZQ0KaW1wb3J0IGphdmEudGltZS5Mb2NhbFRpbWUNCmltcG9ydCBqYXZhLnRpbWUuWm9uZUlkDQppbXBvcnQgamF2YS50aW1lLmZvcm1hdC5EYXRlVGltZUZvcm1hdHRlcg0KDQpwdWJsaWMgY2xhc3MgVXBkTGFzdExvYyBleHRlbmRzIEV4dGVuZE0zVHJhbnNhY3Rpb24gew0KICBwcml2YXRlIGZpbmFsIE1JQVBJIG1pDQogIHByaXZhdGUgZmluYWwgRGF0YWJhc2VBUEkgZGF0YWJhc2UNCiAgcHJpdmF0ZSBmaW5hbCBMb2dnZXJBUEkgbG9nZ2VyDQogIHByaXZhdGUgZmluYWwgUHJvZ3JhbUFQSSBwcm9ncmFtDQogIHByaXZhdGUgZmluYWwgVXRpbGl0eUFQSSB1dGlsaXR5DQogIHByaXZhdGUgZmluYWwgTUlDYWxsZXJBUEkgbWlDYWxsZXINCg0KICAvL0lucHV0IGZpZWxkcw0KICBwcml2YXRlIGludCBpQ09OTywgaVRUWVANCiAgcHJpdmF0ZSBkb3VibGUgVFJRVCwgU1RRVCwgdG90TG9jYXRpb25RdHksIEVYVDYwMVNUQVQNCiAgcHJpdmF0ZSBTdHJpbmcgaVdITE8sIGlJVE5PLCBpUkdEVCwgaVJHVE0sIGlUTVNYLCBpU0JBTiwgaUNBTVUsIGlMV0hMLCBpTFdIUywgaUxNVFMsIFJGVFgsIGZyb21XSExPLCBmcm9tV0hTTCwgZnJvbUNBTVUsIHRvV0hMTywgdG9XSFNMLCB0b0NBTVUsIGJhc2VCQU5PLCBMV0hMLCBQQkFOLCBMV0hTLCBMYXN0TFdITCwgTGFzdExXSFMsIFRSTlIsIFBPTlINCiAgcHJpdmF0ZSBib29sZWFuIGlzVmFsaWRJbnB1dCwgaXNWYWxpZGF0ZUVYVDQwMSwgZnJvbUV4aXN0cywgdG9FeGlzdHMNCg0KICBwcml2YXRlIFN0cmluZyB6TmV3U1RBUywgRkFDSSwgbXlMdmxfQkFOTywgb3JpZ1dITE8sIG9yaWdCQU5PLCBvcmlnQ0FNVSwgb3JpZ1dIU0wsIG91dHB1dExXSEwNCiAgcHJpdmF0ZSBib29sZWFuIHh4Q2hnU3RzDQogIHByaXZhdGUgaW50IENPTk8sIFFJQURGcm9tTUlMT01BDQogIHByaXZhdGUgREJDb250YWluZXIgY29udGFpbmVyRVhUNDAxLCBjb250YWluZXJNSVRUUkEsIGNvbnRhaW5lck1JVExPQywgY29udGFpbmVyUU1TUlFIDQogIHByaXZhdGUgREJBY3Rpb24gYWN0aW9uRVhUNDAxDQoNCiAgcHVibGljIFVwZExhc3RMb2MoTUlBUEkgbWksIERhdGFiYXNlQVBJIGRhdGFiYXNlLCBMb2dnZXJBUEkgbG9nZ2VyLCBQcm9ncmFtQVBJIHByb2dyYW0sIFV0aWxpdHlBUEkgdXRpbGl0eSwgTUlDYWxsZXJBUEkgbWlDYWxsZXIpIHsNCiAgICB0aGlzLm1pID0gbWkNCiAgICB0aGlzLmRhdGFiYXNlID0gZGF0YWJhc2UNCiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcg0KICAgIHRoaXMucHJvZ3JhbSA9IHByb2dyYW0NCiAgICB0aGlzLnV0aWxpdHkgPSB1dGlsaXR5DQogICAgdGhpcy5taUNhbGxlciA9IG1pQ2FsbGVyDQogIH0NCg0KICBwdWJsaWMgdm9pZCBtYWluKCkgew0KICAgIGlDT05PID0gbWkuaW5EYXRhLmdldCgiQ09OTyIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiQ09OTyIpID09IDAgPyBwcm9ncmFtLkxEQVpELkNPTk8udG9TdHJpbmcoKSBhcyBJbnRlZ2VyIDogbWkuaW5EYXRhLmdldCgiQ09OTyIpIGFzIEludGVnZXINCiAgICBpV0hMTyA9IG1pLmluRGF0YS5nZXQoIldITE8iKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIldITE8iKS50cmltKCkgPT0gIj8iID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJXSExPIikudHJpbSgpDQogICAgaUlUTk8gPSBtaS5pbkRhdGEuZ2V0KCJJVE5PIikgPT0gbnVsbCB8fCBtaS5pbkRhdGEuZ2V0KCJJVE5PIikudHJpbSgpID09ICI/IiA/ICIiIDogbWkuaW5EYXRhLmdldCgiSVROTyIpLnRyaW0oKQ0KICAgIGlSR0RUID0gbWkuaW5EYXRhLmdldCgiUkdEVCIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiUkdEVCIpLnRyaW0oKSA9PSAiPyIgPyAiIiA6IG1pLmluRGF0YS5nZXQoIlJHRFQiKS50cmltKCkNCiAgICBpUkdUTSA9IG1pLmluRGF0YS5nZXQoIlJHVE0iKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIlJHVE0iKS50cmltKCkgPT0gIj8iID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJSR1RNIikudHJpbSgpDQogICAgaVRNU1ggPSBtaS5pbkRhdGEuZ2V0KCJUTVNYIikgPT0gbnVsbCB8fCBtaS5pbkRhdGEuZ2V0KCJUTVNYIikudHJpbSgpID09ICI/IiA/ICIiIDogbWkuaW5EYXRhLmdldCgiVE1TWCIpLnRyaW0oKQ0KICAgIGlTQkFOID0gbWkuaW5EYXRhLmdldCgiU0JBTiIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiU0JBTiIpLnRyaW0oKSA9PSAiPyIgPyAiIiA6IG1pLmluRGF0YS5nZXQoIlNCQU4iKS50cmltKCkNCiAgICBpQ0FNVSA9IG1pLmluRGF0YS5nZXQoIkNBTVUiKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIkNBTVUiKS50cmltKCkgPT0gIj8iID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJDQU1VIikudHJpbSgpDQogICAgaUxXSEwgPSBtaS5pbkRhdGEuZ2V0KCJMV0hMIikgPT0gbnVsbCB8fCBtaS5pbkRhdGEuZ2V0KCJMV0hMIikudHJpbSgpID09ICI/IiA/ICIiIDogbWkuaW5EYXRhLmdldCgiTFdITCIpLnRyaW0oKQ0KICAgIGlMV0hTID0gbWkuaW5EYXRhLmdldCgiTFdIUyIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiTFdIUyIpLnRyaW0oKSA9PSAiPyIgPyAiIiA6IG1pLmluRGF0YS5nZXQoIkxXSFMiKS50cmltKCkNCiAgICBpVFRZUCA9IG1pLmluRGF0YS5nZXQoIlRUWVAiKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIlRUWVAiKS50cmltKCkgPT0gIj8iID8gMCA6IG1pLmluRGF0YS5nZXQoIlRUWVAiKS50cmltKCkgYXMgaW50DQoNCiAgICBSRlRYID0gIiINCiAgICBUUlFUID0gMA0KICAgIFNUUVQgPSAwDQogICAgZnJvbVdITE8gPSBpTFdITC50cmltKCkNCiAgICB0b1dITE8gPSBpTFdITC50cmltKCkNCg0KICAgIGxvZ2dlci5kZWJ1ZyhtaS5pbi50b1N0cmluZygpKQ0KICAgIG15THZsX0JBTk8gPSBpU0JBTg0KDQogICAgdmFsaWRhdGVUVFlQKGlDT05PLCBpVFRZUCkgLyogVmFsaWRhdGUgU3RvY2sgdHJhbnNhY3Rpb24gdHlwZSAqLw0KDQogICAgREJBY3Rpb24gYWN0aW9uTUlUVFJBID0gZGF0YWJhc2UudGFibGUoIk1JVFRSQSIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTVRDT05PIiwgIk1UV0hMTyIsICJNVFdIU0wiLCAiTVRJVE5PIiwgIk1UQ0FNVSIsICJNVFJHRFQiLCAiTVRSR1RNIiwgIk1UVE1TWCIsICJNVFJGVFgiLCAiTVRUVFlQIiwgIk1UVFJRVCIsICJNVFJJRE4iLCAiTVRSSURMIiwgIk1UTE1UUyIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJNSVRUUkEgPSBhY3Rpb25NSVRUUkEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lck1JVFRSQS5zZXQoIk1UQ09OTyIsIHByb2dyYW0uTERBWkQuQ09OTyBhcyBpbnQpDQogICAgY29udGFpbmVyTUlUVFJBLnNldCgiTVRXSExPIiwgaVdITE8pDQogICAgY29udGFpbmVyTUlUVFJBLnNldCgiTVRJVE5PIiwgaUlUTk8pDQogICAgY29udGFpbmVyTUlUVFJBLnNldCgiTVRSR0RUIiwgaVJHRFQgYXMgaW50KQ0KICAgIGNvbnRhaW5lck1JVFRSQS5zZXQoIk1UUkdUTSIsIGlSR1RNIGFzIGludCkNCiAgICBjb250YWluZXJNSVRUUkEuc2V0KCJNVFRNU1giLCBpVE1TWCBhcyBpbnQpDQoNCiAgICBhY3Rpb25NSVRUUkEucmVhZChjb250YWluZXJNSVRUUkEpDQoNCiAgICBTdHJpbmcgcmVmZXJlbmNlVGV4dCA9IGNvbnRhaW5lck1JVFRSQS5nZXRTdHJpbmcoIk1UUkZUWCIpDQogICAgaW50IHRyYW5zYWN0aW9uVHlwZSA9IGNvbnRhaW5lck1JVFRSQS5nZXRJbnQoIk1UVFRZUCIpDQoNCiAgICBpZiAodHJhbnNhY3Rpb25UeXBlID09IDUyICYmIHJlZmVyZW5jZVRleHQuY29udGFpbnMoIj0+IikpIHsNCiAgICAgIGlmIChjb250YWluZXJNSVRUUkEuZ2V0RG91YmxlKCJNVFRSUVQiKSA8IDApIHsNCg0KICAgICAgICBmcm9tV0hMTyA9IGNvbnRhaW5lck1JVFRSQS5nZXRTdHJpbmcoIk1UV0hMTyIpDQogICAgICAgIGZyb21XSFNMID0gY29udGFpbmVyTUlUVFJBLmdldFN0cmluZygiTVRXSFNMIikNCiAgICAgICAgZnJvbUNBTVUgPSBjb250YWluZXJNSVRUUkEuZ2V0U3RyaW5nKCJNVENBTVUiKQ0KDQogICAgICAgIHRvV0hMTyA9IHJlZmVyZW5jZVRleHQuc3BsaXQoIj0+IilbMV0udHJpbSgpDQogICAgICAgIHRvV0hTTCA9IHJlZmVyZW5jZVRleHQudHJpbSgpDQogICAgICAgIHRvQ0FNVSA9IGNvbnRhaW5lck1JVFRSQS5nZXRTdHJpbmcoIk1UQ0FNVSIpDQogICAgICB9DQogICAgfSBlbHNlIGlmICh0cmFuc2FjdGlvblR5cGUgPT0gNTAgJiYgcmVmZXJlbmNlVGV4dC5jb250YWlucygiPT4iKSkgew0KICAgICAgaWYgKGNvbnRhaW5lck1JVFRSQS5nZXREb3VibGUoIk1UVFJRVCIpID4gMCkgew0KDQogICAgICAgIGZyb21XSExPID0gcmVmZXJlbmNlVGV4dC5zcGxpdCgiPT4iKVswXS50cmltKCkNCiAgICAgICAgZnJvbVdIU0wgPSByZWZlcmVuY2VUZXh0LnN1YnN0cmluZygwLCAxMCkudHJpbSgpDQogICAgICAgIGZyb21DQU1VID0gY29udGFpbmVyTUlUVFJBLmdldFN0cmluZygiTVRDQU1VIikNCg0KICAgICAgICB0b1dITE8gPSByZWZlcmVuY2VUZXh0LnNwbGl0KCI9PiIpWzFdLnN1YnN0cmluZygwLCAzKS50cmltKCkNCiAgICAgICAgdG9XSFNMID0gY29udGFpbmVyTUlUVFJBLmdldFN0cmluZygiTVRXSFNMIikNCiAgICAgICAgdG9DQU1VID0gY29udGFpbmVyTUlUVFJBLmdldFN0cmluZygiTVRDQU1VIikNCg0KICAgICAgICBSRlRYID0gY29udGFpbmVyTUlUVFJBLmdldFN0cmluZygiTVRSRlRYIikNCiAgICAgICAgVFJRVCA9IGNvbnRhaW5lck1JVFRSQS5nZXQoIk1UVFJRVCIpIGFzIGRvdWJsZQ0KICAgICAgICBUUk5SID0gY29udGFpbmVyTUlUVFJBLmdldCgiTVRSSUROIikgYXMgU3RyaW5nDQogICAgICAgIFBPTlIgPSBjb250YWluZXJNSVRUUkEuZ2V0KCJNVFJJREwiKSBhcyBTdHJpbmcNCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKHRyYW5zYWN0aW9uVHlwZSA9PSA5Mykgew0KICAgICAgZnJvbVdITE8gPSBjb250YWluZXJNSVRUUkEuZ2V0U3RyaW5nKCJNVFdITE8iKS50cmltKCkNCiAgICAgIGZyb21XSFNMID0gcmVmZXJlbmNlVGV4dC5zdWJzdHJpbmcoMCwgMTApLnRyaW0oKQ0KDQogICAgICBpZiAocmVmZXJlbmNlVGV4dC5jb250YWlucygiPT4iKSkgew0KICAgICAgICBmcm9tQ0FNVSA9IGNvbnRhaW5lck1JVFRSQS5nZXRTdHJpbmcoIk1UQ0FNVSIpDQogICAgICB9IGVsc2Ugew0KICAgICAgICBmcm9tQ0FNVSA9IHJlZmVyZW5jZVRleHQuc3Vic3RyaW5nKDExKS50cmltKCkNCiAgICAgIH0NCg0KICAgICAgdG9XSExPID0gY29udGFpbmVyTUlUVFJBLmdldFN0cmluZygiTVRXSExPIikNCiAgICAgIHRvV0hTTCA9IGNvbnRhaW5lck1JVFRSQS5nZXRTdHJpbmcoIk1UV0hTTCIpDQogICAgICB0b0NBTVUgPSBjb250YWluZXJNSVRUUkEuZ2V0U3RyaW5nKCJNVENBTVUiKQ0KDQogICAgfQ0KDQogICAgbG9nZ2VyLmRlYnVnKCJmcm9tV0hMTzogIiArIGZyb21XSExPICsgIiB8IGZyb21XSFNMOiAiICsgZnJvbVdIU0wgKyAiIHwgZnJvbUNBTVU6ICIgKyBmcm9tQ0FNVSkNCiAgICBsb2dnZXIuZGVidWcoInRvV0hMTzogIiArIHRvV0hMTyArICIgfCB0b1dIU0w6ICIgKyB0b1dIU0wgKyAiIHwgdG9DQU1VOiAiICsgdG9DQU1VKQ0KICAgIGxvZ2dlci5kZWJ1ZygiUkZUWDogIiArIFJGVFggKyAiIHwgVFJRVDogIiArIFRSUVQgKyAiIHwgVFJOUjogIiArIFRSTlIgKyAiIHwgUE9OUjogIiArIFBPTlIpDQoNCiAgICBpZiAoZnJvbVdITE8udHJpbSgpLmlzRW1wdHkoKSB8fCB0b1dITE8udHJpbSgpLmlzRW1wdHkoKSkgew0KICAgICAgbWkuZXJyb3IoIlRyYW5zYWN0aW9uIG5vdCBmb3VuZCIpDQogICAgICByZXR1cm4NCiAgICB9DQoNCiAgICBjYWxsTUlUTE9DKGZyb21XSExPLCBmcm9tV0hTTCwgZnJvbUNBTVUpDQoNCiAgICBpZiAoU1RRVCAhPSAwKSB7DQogICAgICBtaS5lcnJvcigiU3ViLUxvdCByZWNvcmQgdG8gY2hhbmdlIG5vdCBmb3VuZCBpbiBjYWxsTUlUTE9DIHdpdGggZnJvbVdITE8gIiArIFNUUVQpDQogICAgICByZXR1cm4NCiAgICB9IGVsc2Ugew0KICAgICAgREJBY3Rpb24gYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxTVEFTIiwgIk1MU1RRVCIsICJNTFFJQUQiLCAiTUxMTURUIiwgIk1MQ0hOTyIsICJNTENISUQiKS5idWlsZCgpDQogICAgICBjb250YWluZXJNSVRMT0MgPSBhY3Rpb25NSVRMT0MuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDT05PIiwgaUNPTk8pDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdITE8iLCBmcm9tV0hMTykNCiAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MSVROTyIsIGlJVE5PKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSFNMIiwgZnJvbVdIU0wpDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBpU0JBTikNCiAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIGZyb21DQU1VKQ0KDQogICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRNSVRMT0MgPSB7DQogICAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgICBjb250YWluZXJNSVRMT0MgPSByZXN1bHRDb250YWluZXINCiAgICAgIH0NCg0KICAgICAgbG9nZ2VyLmRlYnVnKCJDYWxsaW5nIE1JVExPQyIpDQoNCiAgICAgIGZyb21FeGlzdHMgPSBhY3Rpb25NSVRMT0MucmVhZEFsbChjb250YWluZXJNSVRMT0MsIDYsIDEsIHJlYWRBbGxSZWNvcmRNSVRMT0MpDQoNCiAgICAgIGFjdGlvbk1JVExPQyA9IGRhdGFiYXNlLnRhYmxlKCJNSVRMT0MiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIk1MQ09OTyIsICJNTFdITE8iLCAiTUxXSFNMIiwgIk1MSVROTyIsICJNTEJBTk8iLCAiTUxDQU1VIiwgIk1MU1RBUyIsICJNTFNUUVQiLCAiTUxRSUFEIiwgIk1MTE1EVCIsICJNTENITk8iLCAiTUxDSElEIikuYnVpbGQoKQ0KICAgICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ09OTyIsIGlDT05PKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgdG9XSExPKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgaUlUTk8pDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdIU0wiLCB0b1dIU0wpDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBpU0JBTikNCiAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIHRvQ0FNVSkNCg0KICAgICAgcmVhZEFsbFJlY29yZE1JVExPQyA9IHsNCiAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgIGNvbnRhaW5lck1JVExPQyA9IHJlc3VsdENvbnRhaW5lcg0KICAgICAgfQ0KDQogICAgICBsb2dnZXIuZGVidWcoIkNhbGxpbmcgTUlUTE9DIikNCg0KICAgICAgdG9FeGlzdHMgPSBhY3Rpb25NSVRMT0MucmVhZEFsbChjb250YWluZXJNSVRMT0MsIDYsIDEsIHJlYWRBbGxSZWNvcmRNSVRMT0MpDQoNCiAgICAgIGxvZ2dlci5kZWJ1ZygiZnJvbUV4aXN0czogIiArIGZyb21FeGlzdHMgKyAiIHwgdG9FeGlzdHM6ICIgKyB0b0V4aXN0cykNCg0KICAgICAgREJBY3Rpb24gYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICAgIGNvbnRhaW5lckVYVDQwMSA9IGFjdGlvbkVYVDQwMS5nZXRDb250YWluZXIoKQ0KDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBpQ09OTy50b0ludGVnZXIoKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGZyb21XSExPKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk8pDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBpU0JBTikNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGZyb21DQU1VKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgZnJvbVdIU0wpDQoNCiAgICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgIGNvbnRhaW5lckVYVDQwMSA9IHJlc3VsdENvbnRhaW5lcg0KICAgICAgfQ0KDQogICAgICBsb2dnZXIuZGVidWcoIkNhbGxpbmcgRVhUNDAxIC0gMSIpDQoNCiAgICAgIGlmIChhY3Rpb25FWFQ0MDEucmVhZEFsbChjb250YWluZXJFWFQ0MDEsIDYsIDEsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpKSB7DQogICAgICAgIGJhc2VCQU5PID0gY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhCQU5PIikNCg0KICAgICAgICBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjk5Iikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTFNUQVMiLCAiTUxTVFFUIiwgIk1MUUlBRCIsICJNTExNRFQiLCAiTUxDSE5PIiwgIk1MQ0hJRCIpLmJ1aWxkKCkNCiAgICAgICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDT05PIiwgaUNPTk8pDQogICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIHRvQ0FNVSkNCg0KICAgICAgICB0b3RMb2NhdGlvblF0eSA9IGdldFRvdGFsUXR5TG9jQ0FNVShhY3Rpb25NSVRMT0MsIGNvbnRhaW5lck1JVExPQywgYmFzZUJBTk8pDQoNCiAgICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxID0gYWN0aW9uRVhUNDAxLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgaUNPTk8udG9JbnRlZ2VyKCkpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIHRvV0hMTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIGlTQkFOKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCB0b0NBTVUpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIHRvV0hTTCkNCg0KICAgICAgICBsb2dnZXIuZGVidWcoIkNhbGxpbmcgRVhUNDAxIC0gRGVsZXRlIHRoZSBQcmV2aW91cyBSZWNvcmQgKyBSZWxhdGVkIFBvc3QvUHJlLUxldmVscyIpDQoNCiAgICAgICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZEVYVDQwMSkpIHsNCiAgICAgICAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAgICAgICAvLyoqKioqKiogRGVsZXRlIHRoZSBQcmV2aW91cyBSZWNvcmQgKyBSZWxhdGVkIFBvc3QvUHJlLUxldmVscw0KICAgICAgICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgICAgICAgdXBkYXRlU3RhdHVzKCkNCg0KICAgICAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxID0gYWN0aW9uRVhUNDAxLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBpQ09OTy50b0ludGVnZXIoKSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBmcm9tV0hMTykNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCBpSVROTykNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBpU0JBTikNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBmcm9tQ0FNVSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBmcm9tV0hTTCkNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2FsbGluZyBFWFQ0MDEgLSBEZWxldGUgdGhlIFByZXZpb3VzIFJlY29yZCArIFJlbGF0ZWQgUG9zdC9QcmUtTGV2ZWxzIEFHQUlOIikNCiAgICAgICAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hMIikpDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFBCQU4iKSkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhDQU1VIikpDQoNCiAgICAgICAgICAgIENsb3N1cmUgPCA/ID4gZGVsZXRlQWxsUmVjb3JkRVhUNDAxID0gew0KICAgICAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIGxvY2tlZFJlc3VsdC5nZXRTdHJpbmcoIkVYUEJBTiIpKQ0KICAgICAgICAgICAgICBsb2NrZWRSZXN1bHQuZGVsZXRlKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJDYWxsaW5nIEVYVDQwMSAtIERlbGV0ZSB0aGUgUHJldmlvdXMgUmVjb3JkICsgUmVsYXRlZCBQb3N0L1ByZS1MZXZlbHMgREVMRVRFIikNCiAgICAgICAgICAgIHdoaWxlIChhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCBkZWxldGVBbGxSZWNvcmRFWFQ0MDEpKSB7DQogICAgICAgICAgICAgIC8vRGVsZXRlIHJlY29yZCBhbmQgc2V0IEVYUEJBTg0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxID0gYWN0aW9uRVhUNDAxLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBwcm9ncmFtLkxEQVpELkNPTk8gYXMgaW50KQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGZyb21XSExPKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIGlTQkFOKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGZyb21DQU1VKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGZyb21XSFNMKQ0KDQogICAgICAgICAgQ2xvc3VyZSA8ID8gPiBkZWxldGVBbGxSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFBCQU4iLCBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCiAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5kZWxldGUoKQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2FsbGluZyBFWFQ0MDEgLSAyIikNCiAgICAgICAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGxMb2NrKGNvbnRhaW5lckVYVDQwMSwgNiwgZGVsZXRlQWxsUmVjb3JkRVhUNDAxKSkgew0KDQogICAgICAgICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjEwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIkNhbGxpbmcgRVhUNDAxIC0gV0hJTEUiKQ0KICAgICAgICAgICAgd2hpbGUgKGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIGRlbGV0ZUFsbFJlY29yZEVYVDQwMSkpIHsNCiAgICAgICAgICAgICAgLy9EZWxldGUgcmVjb3JkIGFuZCBzZXQgRVhQQkFODQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgb3JpZ1dITE8gPSBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKQ0KICAgICAgICAgIG9yaWdCQU5PID0gY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikNCiAgICAgICAgICBvcmlnQ0FNVSA9IGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQ0FNVSIpDQogICAgICAgICAgb3JpZ1dIU0wgPSBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSFMiKQ0KDQogICAgICAgICAgbWkub3V0RGF0YS5wdXQoIkxXSEwiLCBvcmlnV0hMTykNCiAgICAgICAgICBtaS5vdXREYXRhLnB1dCgiTFdIUyIsIG9yaWdXSFNMKQ0KDQogICAgICAgICAgb3V0cHV0TFdITCA9IG9yaWdXSExPDQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vU2tpcE1vdmUNCiAgICAgICAgaWYgKHRydWUpIHsNCiAgICAgICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjEwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5DT05PIGFzIGludCkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCBpSVROTykNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFBCQU4iLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBpQ0FNVSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2FsbGluZyBFWFQ0MDEgLSBTS0lQIikNCiAgICAgICAgICBib29sZWFuIElOOTMgPSAhYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3JkRVhUNDAxKQ0KDQogICAgICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIHByb2dyYW0uTERBWkQuQ09OTyBhcyBpbnQpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgZnJvbVdITE8pDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk8pDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgaVNCQU4pDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgZnJvbUNBTVUpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgZnJvbVdIU0wpDQoNCiAgICAgICAgICBDbG9zdXJlIDwgPyA+IHVwZGF0ZUFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCg0KICAgICAgICAgICAgb3JpZ1dITE8gPSBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWExXSEwiKQ0KICAgICAgICAgICAgb3JpZ0JBTk8gPSBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWFNCQU4iKQ0KICAgICAgICAgICAgb3JpZ0NBTVUgPSBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWENBTVUiKQ0KICAgICAgICAgICAgb3JpZ1dIU0wgPSBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWExXSFMiKQ0KDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBpTFdITCkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIHRvV0hTTCkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIHRvQ0FNVSkNCiAgICAgICAgICAgIGlmIChJTjkzKSB7DQogICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ1dITCIsIGlMV0hMKQ0KICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENXSFMiLCB0b1dIU0wpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGRlZiBjb2x1bW5zVG9Db3B5ID0gWyJFWExXSEwiLCAiRVhMV0hTIiwgIkVYQ0FNVSIsICJFWExTVFEiLCAiRVhMTURUIiwgIkVYQ0hOTyIsICJFWENISUQiXQ0KICAgICAgICAgICAgaWYgKElOOTMpIHsNCiAgICAgICAgICAgICAgY29sdW1uc1RvQ29weS5hZGRBbGwoWyJFWENXSEwiLCAiRVhDV0hTIl0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5hbGxDb2x1bW5zLmVhY2ggew0KICAgICAgICAgICAgICBTdHJpbmcgY29sdW1uIC0+DQogICAgICAgICAgICAgICAgaWYgKCFjb2x1bW5zVG9Db3B5LmNvbnRhaW5zKGNvbHVtbikpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoY29sdW1uLCBsb2NrZWRSZXN1bHQuZ2V0KGNvbHVtbikpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExTVFEiLCB0b3RMb2NhdGlvblF0eSkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTE1EVCIsIHV0aWxpdHkuY2FsbCgiRGF0ZVV0aWwiLCAiY3VycmVudERhdGVZOEFzSW50IikpDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENITk8iLCBsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCg0KICAgICAgICAgICAgaWYgKGxvY2tlZFJlc3VsdC5kZWxldGUoKSkgew0KICAgICAgICAgICAgICBhY3Rpb25FWFQ0MDEuaW5zZXJ0KGNvbnRhaW5lckVYVDQwMSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGxvY2tlZFJlc3VsdC50b1N0cmluZygpKQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2FsbGluZyBFWFQ0MDEgLSBVUERBVEUgSU45MyIpDQoNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIHByb2dyYW0uTERBWkQuQ09OTyBhcyBpbnQpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgdG9XSExPKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIGlTQkFOKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIHRvQ0FNVSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCB0b1dIU0wpDQoNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIlVwZGF0aW5nIHRvIExvY2F0aW9uIikNCiAgICAgICAgICBhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCB1cGRhdGVBbGxSZWNvcmRFWFQ0MDEpDQoNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIHByb2dyYW0uTERBWkQuQ09OTyBhcyBpbnQpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgZnJvbVdITE8pDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk8pDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgaVNCQU4pDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgZnJvbUNBTVUpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgZnJvbVdIU0wpDQoNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIlVwZGF0aW5nIGZyb20gTG9jYXRpb24iKQ0KICAgICAgICAgIGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZUFsbFJlY29yZEVYVDQwMSkNCg0KICAgICAgICAgIG1pLm91dERhdGEucHV0KCJMV0hMIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hMIikpDQogICAgICAgICAgbWkub3V0RGF0YS5wdXQoIkxXSFMiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCg0KICAgICAgICAgIG91dHB1dExXSEwgPSBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKQ0KDQogICAgICAgICAgdXBkTG9jU3ViTGV2ZWxzKGlMV0hMLCB0b1dIU0wsIHRvQ0FNVSkNCiAgICAgICAgICB1cGRRdHlTdWJMZXZlbHMoaUxXSEwsIHRvV0hTTCwgdG9DQU1VLCB0b3RMb2NhdGlvblF0eS50b1N0cmluZygpLCBvcmlnQkFOTykNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiZnJvbVdITE86ICIgKyBmcm9tV0hMTyArICIgfCBpTFdITDogIiArIGlMV0hMKQ0KDQogICAgICAgICAgaWYgKGZyb21XSExPLnRyaW0oKSAhPSBpTFdITC50cmltKCkpIHsNCiAgICAgICAgICAgIERCQWN0aW9uIGFjdGlvbkVYVDYwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ2MDEiKS5pbmRleCgiMDAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgICAgICAgICBEQkNvbnRhaW5lciBjb250YWluZXJFWFQ2MDEgPSBhY3Rpb25FWFQ2MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNjAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5DT05PIGFzIGludCkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDYwMS5zZXQoIkVYVFJOUiIsIFRSTlIpDQogICAgICAgICAgICBjb250YWluZXJFWFQ2MDEuc2V0KCJFWFBPTlIiLCBQT05SIGFzIGludCkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDYwMS5zZXQoIkVYQkFOTyIsIGlTQkFOKQ0KICAgICAgICAgICAgY29udGFpbmVyRVhUNjAxLnNldCgiRVhDQU1VIiwgaUNBTVUpDQoNCiAgICAgICAgICAgIENsb3N1cmUgPCA/ID4gdXBkYXRlQWxsUmVjb3JkRVhUNjAxID0gew0KICAgICAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgICAgICAgIGlmICgobG9ja2VkUmVzdWx0LmdldFN0cmluZygiRVhTVEFUIikgYXMgaW50KSA8IDkwKSB7DQoNCiAgICAgICAgICAgICAgICBjcnRSZWNsYXNzQmFsYW5jZV9FeGVjKHByb2dyYW0uTERBWkQuQ09OTy50b1N0cmluZygpLCAiSU5WIiwgIjkwIiwgaVNCQU4sICIiLCBpSVROTywgbG9ja2VkUmVzdWx0LmdldCgiRVhOU1RTIikudG9TdHJpbmcoKSwgaUxXSEwsIGlDQU1VLCBpTFdIUywgIiIpDQoNCiAgICAgICAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWFNUQVQiLCAiOTAiKQ0KICAgICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KDQogICAgICAgICAgICAgICAgbWkub3V0RGF0YS5wdXQoIlNUQVMiLCBsb2NrZWRSZXN1bHQuZ2V0KCJFWE5TVFMiKS50b1N0cmluZygpKQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2FsbGluZyBFWFQ0MDEgLSBVUERBVEUgY3J0UmVjbGFzc0JhbGFuY2VfRXhlYyIpDQogICAgICAgICAgICBpZiAoIWFjdGlvbkVYVDYwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ2MDEsIDUsIHVwZGF0ZUFsbFJlY29yZEVYVDYwMSkpIHsNCiAgICAgICAgICAgICAgLy9jcmVhdGUgUmVjbGFzcyBCYWxhbmNlDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKG91dHB1dExXSEwudHJpbSgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgbWkuZXJyb3IoIlN1Yi1Mb3QgcmVjb3JkIHRvIGNoYW5nZSBub3QgZm91bmQiKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG1pLndyaXRlKCkNCiAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbWkuZXJyb3IoIlN1Yi1Mb3QgcmVjb3JkIHRvIGNoYW5nZSBub3QgZm91bmQiKQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCg0KICAgIH0NCg0KICAgIC8qICAgIGNhbGxFWFQ0MDEoIkZST00iLCBmcm9tV0hMTywgZnJvbVdIU0wpDQogICAgICAgIFZhbGlkYXRlNDAxKCkNCiAgICAgICAgdXBkTG9jU3ViTGV2ZWxzKGlMV0hMLCB0b1dIU0wpDQogICAgICAgIHVwZFF0eVN1YkxldmVscyhpTFdITCwgdG9XSFNMLCB0b3RMb2NhdGlvblF0eS50b1N0cmluZygpLCBpU0JBTikNCiAgICAgICAgaWYgKCFmcm9tV0hMTy50cmltKCkuZXF1YWxzSWdub3JlQ2FzZShpTFdITCkpIHsNCiAgICAgICAgICBjYWxsRVhUNjAxKCkNCiAgICAgICAgfQ0KICAgICAgICBjYWxsRVhUNjAxKCkNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJGaW5hbCByZXNwb25zZSAiK2Zyb21XSExPICsgIiAiICsgZnJvbVdIU0wgKyAiICIgKyB0b1dITE8gKyAiICIgKyB0b1dIU0wgKyAiICIgKyBUUlFUICsgIiAiICsgUkZUWCArICIgIiArYmFzZUJBTk8gKyAiICIgKyBpTFdITCkqLw0KICB9DQoNCiAgcHJpdmF0ZSB2YWxpZGF0ZVRUWVAoaW50IGNvbm8sIGludCB0dHlwKSB7DQogICAgLy8gVmFsaWRhdGUgRGl2aXNpb24NCiAgICBEQkFjdGlvbiBkYmFjdGlvbiA9IGRhdGFiYXNlLnRhYmxlKCJDU1lUQUIiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIkNUQ09OTyIsICJDVFNUQ08iLCAiQ1RTVEtZIikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNzeXRhYiA9IGRiYWN0aW9uLmdldENvbnRhaW5lcigpDQogICAgY3N5dGFiLnNldCgiQ1RDT05PIiwgY29ubykNCiAgICBjc3l0YWIuc2V0KCJDVFNUQ08iLCAiVFRZUCIpDQogICAgY3N5dGFiLnNldCgiQ1RTVEtZIiwgdHR5cC50b1N0cmluZygpKQ0KDQogICAgaWYgKCFkYmFjdGlvbi5yZWFkKGNzeXRhYikpIHsNCiAgICAgIG1pLmVycm9yKCJTdG9jayB0cmFuc2FjdGlvbiB0eXBlICIgKyB0dHlwICsgIiBkb2VzIG5vdCBleGlzdCIpDQogICAgICBpc1ZhbGlkSW5wdXQgPSBmYWxzZQ0KICAgICAgcmV0dXJuDQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIFZhbGlkYXRlIGlucHV0IHRyYW5zYWN0aW9uIGFuZCBmZXRjaCBSRlRYIHJlY29yZCBmcm9tIE1JVFRSQSB0YWJsZQ0KICAgKi8NCiAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlSW5wdXRUcmFuc2FjdGlvbigpIHsNCiAgICBsb2dnZXIuZGVidWcoIkluIHZhbGlkYXRlSW5wdXRUcmFuc2FjdGlvbiBtZXRob2QiKQ0KDQogICAgRXhwcmVzc2lvbkZhY3RvcnkgZXhwcmVzc2lvbiA9IGRhdGFiYXNlLmdldEV4cHJlc3Npb25GYWN0b3J5KCJNSVRUUkEiKQ0KICAgIGV4cHJlc3Npb24gPSAoZXhwcmVzc2lvbi5lcSgiTVRDQU1VIiwgaUNBTVUpICYgZXhwcmVzc2lvbi5lcSgiTVRXSExPIiwgaUxXSEwpKSAmIGV4cHJlc3Npb24uZXEoIk1UV0hTTCIsIGlMV0hTKQ0KDQogICAgREJBY3Rpb24gYWN0aW9uTUlUVFJBID0gZGF0YWJhc2UudGFibGUoIk1JVFRSQSIpLmluZGV4KCIyMCIpLm1hdGNoaW5nKGV4cHJlc3Npb24pLnNlbGVjdGlvbigiTVRDT05PIiwgIk1UV0hMTyIsICJNVFdIU0wiLCAiTVRJVE5PIiwgIk1UQ0FNVSIsICJNVFJHRFQiLCAiTVRSR1RNIiwgIk1UVE1TWCIsICJNVFJGVFgiLCAiTVRUVFlQIiwgIk1UVFJRVCIsICJNVFJJRE4iLCAiTVRSSURMIiwgIk1UTE1UUyIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJNSVRUUkEgPSBhY3Rpb25NSVRUUkEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lck1JVFRSQS5zZXQoIk1UQ09OTyIsIGlDT05PKQ0KICAgIGNvbnRhaW5lck1JVFRSQS5zZXQoIk1UVFRZUCIsIGlUVFlQKQ0KICAgIGNvbnRhaW5lck1JVFRSQS5zZXQoIk1USVROTyIsIGlJVE5PKQ0KICAgIGNvbnRhaW5lck1JVFRSQS5zZXQoIk1UQkFOTyIsIGlTQkFOKQ0KDQogICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkTUlUVFJBID0gew0KICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICBSRlRYID0gcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiTVRSRlRYIikNCiAgICAgIFRSUVQgPSByZXN1bHRDb250YWluZXIuZ2V0RG91YmxlKCJNVFRSUVQiKQ0KICAgICAgVFJOUiA9IHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIk1UUklETiIpDQogICAgICBQT05SID0gcmVzdWx0Q29udGFpbmVyLmdldCgiTVRSSURMIikNCiAgICB9DQoNCiAgICBpZiAoIWFjdGlvbk1JVFRSQS5yZWFkQWxsKGNvbnRhaW5lck1JVFRSQSwgNCwgcmVhZEFsbFJlY29yZE1JVFRSQSkpIHsNCiAgICAgIG1pLmVycm9yKCJUcmFuc2FjdGlvbiBub3QgZm91bmQiKQ0KICAgICAgcmV0dXJuDQogICAgfQ0KDQogIH0NCg0KICB2b2lkIGZpbmRSZWxhdGVkTG9jYXRpb24oU3RyaW5nIGZpbmRUeXBlKSB7DQoNCiAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uID0gZGF0YWJhc2UuZ2V0RXhwcmVzc2lvbkZhY3RvcnkoIk1JVFRSQSIpDQogICAgZXhwcmVzc2lvbiA9IChleHByZXNzaW9uLmVxKCJNVENBTVUiLCBpQ0FNVSkgJiBleHByZXNzaW9uLmVxKCJNVFdITE8iLCBpTFdITCkpICYgZXhwcmVzc2lvbi5lcSgiTVRXSFNMIiwgaUxXSFMpDQoNCiAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRzTUlUVFJBID0gew0KICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICBpZiAoZmluZFR5cGUuZXF1YWxzSWdub3JlQ2FzZSgiRlJPTSIpKSB7DQogICAgICAgIGZyb21XSExPID0gcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiTVRXSExPIikNCiAgICAgICAgZnJvbVdIU0wgPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJNVFdIU0wiKQ0KICAgICAgfQ0KICAgICAgaWYgKGZpbmRUeXBlLmVxdWFsc0lnbm9yZUNhc2UoIlRPIikpIHsNCiAgICAgICAgdG9XSExPID0gcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiTVRXSExPIikNCiAgICAgICAgdG9XSFNMID0gcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiTVRXSFNMIikNCiAgICAgIH0NCiAgICB9DQoNCiAgICBEQkFjdGlvbiBhY3Rpb25NSVRUUkEgPSBkYXRhYmFzZS50YWJsZSgiTUlUVFJBIikuaW5kZXgoIjIwIikubWF0Y2hpbmcoZXhwcmVzc2lvbikuc2VsZWN0aW9uKCJNVENPTk8iLCAiTVRXSExPIiwgIk1UV0hTTCIsICJNVElUTk8iLCAiTVRDQU1VIiwgIk1UUkdEVCIsICJNVFJHVE0iLCAiTVRUTVNYIiwgIk1UUkZUWCIsICJNVFRUWVAiLCAiTVRUUlFUIiwgIk1UUklETiIsICJNVFJJREwiLCAiTVRMTVRTIikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lck1JVFRSQSA9IGFjdGlvbk1JVFRSQS5nZXRDb250YWluZXIoKQ0KDQogICAgY29udGFpbmVyTUlUVFJBLnNldCgiTVRDT05PIiwgaUNPTk8pDQogICAgY29udGFpbmVyTUlUVFJBLnNldCgiTVRUVFlQIiwgaVRUWVApDQogICAgY29udGFpbmVyTUlUVFJBLnNldCgiTVRJVE5PIiwgaUlUTk8pDQogICAgY29udGFpbmVyTUlUVFJBLnNldCgiTVRCQU5PIiwgaVNCQU4pDQoNCiAgICBhY3Rpb25NSVRUUkEucmVhZEFsbChjb250YWluZXJNSVRUUkEsIDcsIHJlYWRBbGxSZWNvcmRzTUlUVFJBKQ0KICB9DQogIC8qKg0KICAgKiBDYWxsaW5nIE1JVExPQyB0byBSZWFkIEJhbGFuY2UgSWQgdXNpbmcgdGhlIEZyb20gTG9jYXRpb24gS2V5cw0KICAgKi8NCiAgcHJpdmF0ZSB2b2lkIGNhbGxNSVRMT0MoU3RyaW5nIGluV0hMTywgU3RyaW5nIGluV0hTTCwgU3RyaW5nIGluQ0FNVSkgew0KICAgIGxvZ2dlci5kZWJ1ZygiSW4gY2FsbE1JVExPQyBtZXRob2QiKQ0KDQogICAgREJBY3Rpb24gYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxTVEFTIiwgIk1MU1RRVCIsICJNTFFJQUQiLCAiTUxMTURUIiwgIk1MQ0hOTyIsICJNTENISUQiKS5idWlsZCgpDQogICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENPTk8iLCBpQ09OTykNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdITE8iLCBpbldITE8pDQogICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgaUlUTk8pDQogICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSFNMIiwgaW5XSFNMKQ0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIGlTQkFOKQ0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIGluQ0FNVSkNCg0KICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZE1JVExPQyA9IHsNCiAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgY29udGFpbmVyTUlUTE9DID0gcmVzdWx0Q29udGFpbmVyDQogICAgICBTVFFUID0gcmVzdWx0Q29udGFpbmVyLmdldERvdWJsZSgiTUxTVFFUIikNCiAgICAgIHRvdExvY2F0aW9uUXR5ICs9IHJlc3VsdENvbnRhaW5lci5nZXREb3VibGUoIk1MU1RRVCIpDQogICAgICBsb2dnZXIuZGVidWcoInRvdExvY2F0aW9uUXR5OiAiICsgdG90TG9jYXRpb25RdHkpDQogICAgfQ0KDQogICAgaWYgKCFhY3Rpb25NSVRMT0MucmVhZEFsbChjb250YWluZXJNSVRMT0MsIDYsIHJlYWRBbGxSZWNvcmRNSVRMT0MpKSB7DQogICAgICBsb2dnZXIuZGVidWcoIlN1Yi1sb3QgcmVjb3JkIG5vdCBmb3VuZCAiICsgaW5XSExPICsgIiAiICsgaW5XSFNMKQ0KICAgICAgcmV0dXJuDQogICAgfQ0KDQogIH0NCg0KICAvKioNCiAgICogQ2FsbGluZyBFWFQ0MDEgdG8gdmFsaWRhdGUgdGhlIHJlY29yZHMNCiAgICovDQogIHByaXZhdGUgdm9pZCBjYWxsRVhUNDAxKFN0cmluZyBhcGljYWxsZnJvbSwgU3RyaW5nIGluV0hMTywgU3RyaW5nIGluV0hTTCkgew0KICAgIGxvZ2dlci5kZWJ1ZygiSW4gY2FsbEVYVDQwMSBtZXRob2QgIiArIGFwaWNhbGxmcm9tICsgIiB3YXJlaG91c2UgIiArIGluV0hMTykNCg0KICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb24gPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiRVhUNDAxIikNCiAgICBleHByZXNzaW9uID0gKChleHByZXNzaW9uLmVxKCJFWEJBTk8iLCBpU0JBTikgJiBleHByZXNzaW9uLmVxKCJFWENBTVUiLCBpQ0FNVSkpICYgZXhwcmVzc2lvbi5lcSgiRVhXSFNMIiwgaW5XSFNMKSkgJiBleHByZXNzaW9uLmVxKCJFWFdITE8iLCBpbldITE8pDQoNCiAgICBEQkFjdGlvbiBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikubWF0Y2hpbmcoZXhwcmVzc2lvbikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGV4dDQwMSA9IGFjdGlvbkVYVDQwMS5nZXRDb250YWluZXIoKQ0KDQogICAgZXh0NDAxLnNldCgiRVhDT05PIiwgaUNPTk8pDQogICAgZXh0NDAxLnNldCgiRVhJVE5PIiwgaUlUTk8udHJpbSgpKQ0KDQogICAgTGFzdExXSEwgPSBpbldITE8NCiAgICBMYXN0TFdIUyA9IGluV0hTTA0KDQogICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkRVhUNDAxID0gew0KICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICBpZiAoYXBpY2FsbGZyb20udHJpbSgpLmVxdWFsc0lnbm9yZUNhc2UoIkZST00iKSkgew0KICAgICAgICB0b3RMb2NhdGlvblF0eSA9IDANCiAgICAgICAgYmFzZUJBTk8gPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWEJBTk8iKQ0KICAgICAgICBjYWxsTUlUTE9DKHRvV0hMTywgdG9XSFNMLCB0b0NBTVUpDQogICAgICAgIGNhbGxFWFQ0MDEoIlRPIiwgdG9XSExPLCB0b1dIU0wpDQogICAgICB9IGVsc2UgaWYgKGFwaWNhbGxmcm9tLnRyaW0oKS5lcXVhbHNJZ25vcmVDYXNlKCJUTyIpKSB7DQogICAgICAgIExXSEwgPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWExXSEwiKQ0KICAgICAgICBQQkFOID0gcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhQQkFOIikNCiAgICAgICAgTFdIUyA9IHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYTFdIUyIpDQogICAgICAgIGNhbGxFWFQ0MDFEZWxldGUoTFdITCwgUEJBTiwgTFdIUykNCiAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAoIWFjdGlvbkVYVDQwMS5yZWFkQWxsKGV4dDQwMSwgMiwgcmVhZEFsbFJlY29yZEVYVDQwMSkpIHsNCiAgICAgIGlmIChhcGljYWxsZnJvbS50cmltKCkuZXF1YWxzSWdub3JlQ2FzZSgiRlJPTSIpKSB7DQogICAgICAgIG1pLmVycm9yKCJTdWItbG90IHJlY29yZCBub3QgZm91bmQgaW4gRVhUNDAxIHdpdGggd2FyZWhvdXNlICIgKyBpbldITE8gKyAiICIgKyBpbldIU0wgKyAiICIgKyBpU0JBTiArICIgIiArIGlDQU1VKQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICAvKioNCiAgICogQ2FsbGluZyBFWFQ0MDEgdG8gZGVsZXRlIHRoZSByZWNvcmRzDQogICAqLw0KICBwcml2YXRlIHZvaWQgY2FsbEVYVDQwMURlbGV0ZShTdHJpbmcgaW5MV0hMLCBTdHJpbmcgaW5QQkFOLCBTdHJpbmcgaW5MV0hTKSB7DQogICAgbG9nZ2VyLmRlYnVnKCJJbiBjYWxsRVhUNDAxRGVsZXRlIG1ldGhvZCAiICsgaW5MV0hMICsgIiAiICsgaW5QQkFOKQ0KICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb24gPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiRVhUNDAxIikNCiAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5lcSgiRVhTQkFOIiwgaW5QQkFOKS5hbmQoZXhwcmVzc2lvbi5lcSgiRVhDQU1VIiwgaUNBTVUpKS5hbmQoZXhwcmVzc2lvbi5lcSgiRVhMV0hTIiwgaW5MV0hTKSkuYW5kKGV4cHJlc3Npb24uZXEoIkVYTFdITCIsIGluTFdITCkpDQoNCiAgICBEQkFjdGlvbiBkYkFjdGlvbmV4dDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5tYXRjaGluZyhleHByZXNzaW9uKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgLy9YdGVuZE0zIGNoYW5nZQ0KICAgIERCQ29udGFpbmVyIGV4dDQwMSA9IGRiQWN0aW9uZXh0NDAxLmdldENvbnRhaW5lcigpDQoNCiAgICBleHQ0MDEuc2V0KCJFWENPTk8iLCBpQ09OTykNCiAgICBleHQ0MDEuc2V0KCJFWElUTk8iLCBpSVROTy50cmltKCkpDQoNCiAgICBDbG9zdXJlIDwgPyA+IGRlbGV0ZVJlY29yZEVYVDQwMSA9IHsNCiAgICAgIExvY2tlZFJlc3VsdCByZXN1bHQgLT4gcmVzdWx0LmRlbGV0ZSgpDQogICAgfQ0KICAgIExhc3RMV0hMID0gaW5MV0hMDQogICAgTGFzdExXSFMgPSBpbkxXSFMNCiAgICBtaS5vdXREYXRhLnB1dCgiTFdITCIsIGluTFdITCkNCiAgICBtaS5vdXREYXRhLnB1dCgiTFdIUyIsIGluTFdIUykNCiAgfQ0KDQogIC8qKg0KICAgKiBDYWxsaW5nIEVYVDQwMSB0byB2YWxpZGF0ZSB0aGUgcmVjb3Jkcw0KICAgKi8NCiAgcHJpdmF0ZSB2b2lkIFZhbGlkYXRlNDAxKCkgew0KICAgIGxvZ2dlci5kZWJ1ZygiSW4gVmFsaWRhdGU0MDEgbWV0aG9kIikNCg0KICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb24gPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiRVhUNDAxIikNCiAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5lcSgiRVhQQkFOIiwgaVNCQU4pLmFuZChleHByZXNzaW9uLmVxKCJFWENBTVUiLCBpQ0FNVSkpLmFuZChleHByZXNzaW9uLmVxKCJFWExXSFMiLCBMYXN0TFdIUykpLmFuZChleHByZXNzaW9uLmVxKCJFWFdITE8iLCBMYXN0TFdITCkpDQoNCiAgICBEQkFjdGlvbiBkYkFjdGlvbmV4dDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5tYXRjaGluZyhleHByZXNzaW9uKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgLy9YdGVuZE0zIGNoYW5nZQ0KICAgIERCQ29udGFpbmVyIGV4dDQwMSA9IGRiQWN0aW9uZXh0NDAxLmdldENvbnRhaW5lcigpDQoNCiAgICBleHQ0MDEuc2V0KCJFWENPTk8iLCBpQ09OTykNCiAgICBleHQ0MDEuc2V0KCJFWElUTk8iLCBpSVROTy50cmltKCkpDQoNCiAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDEgPSB7DQogICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgIGlzVmFsaWRhdGVFWFQ0MDEgPSB0cnVlDQogICAgICB1cGRhdGVFWFQ0MDEoKQ0KICAgIH0NCg0KICAgIGlmICghZGJBY3Rpb25leHQ0MDEucmVhZEFsbChleHQ0MDEsIDIsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpKSB7DQogICAgICBsb2dnZXIuZGVidWcoImlzVmFsaWRhdGVFWFQ0MDEgaXMgZmFsc2UiKQ0KICAgICAgaXNWYWxpZGF0ZUVYVDQwMSA9IGZhbHNlDQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIENhbGxpbmcgRVhUNDAxIHRvIHVwZGF0ZSB0aGUgcmVjb3Jkcw0KICAgKi8NCiAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUVYVDQwMSgpIHsNCiAgICBsb2dnZXIuZGVidWcoIkluIHVwZGF0ZUVYVDQwMSBtZXRob2QiKQ0KDQogICAgRXhwcmVzc2lvbkZhY3RvcnkgZXhwcmVzc2lvbiA9IGRhdGFiYXNlLmdldEV4cHJlc3Npb25GYWN0b3J5KCJFWFQ0MDEiKQ0KICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmVxKCJFWFNCQU4iLCBpU0JBTikuYW5kKGV4cHJlc3Npb24uZXEoIkVYQ0FNVSIsIGlDQU1VKSkuYW5kKGV4cHJlc3Npb24uZXEoIkVYTFdIUyIsIGZyb21XSFNMKSkuYW5kKGV4cHJlc3Npb24uZXEoIkVYTFdITCIsIGZyb21XSExPKSkNCg0KICAgIERCQWN0aW9uIGRiQWN0aW9uZXh0NDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLm1hdGNoaW5nKGV4cHJlc3Npb24pLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICAvL1h0ZW5kTTMgY2hhbmdlDQogICAgREJDb250YWluZXIgZXh0NDAxID0gZGJBY3Rpb25leHQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGV4dDQwMS5zZXQoIkVYQ09OTyIsIGlDT05PKQ0KICAgIGV4dDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PLnRyaW0oKSkNCg0KICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCiAgICAgIGlmIChpTFdIUy50cmltKCkgIT0gIiIpIHsNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMV0hTIiwgaUxXSFMpDQogICAgICB9DQogICAgICBpZiAoaUxXSEwudHJpbSgpICE9ICIiKSB7DQogICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTFdITCIsIGlMV0hMKQ0KICAgICAgfQ0KICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMU1RRIiwgdG90TG9jYXRpb25RdHkudG9JbnRlZ2VyKCkpDQoNCiAgICAgIGlmIChpc1ZhbGlkYXRlRVhUNDAxKSB7DQogICAgICAgIGlmIChpTFdIUy50cmltKCkgIT0gIiIpIHsNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENXSFMiLCBpTFdIUykNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaUxXSEwudHJpbSgpICE9ICIiKSB7DQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDV0hMIiwgaUxXSEwpDQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgbWkub3V0RGF0YS5wdXQoIkxXSEwiLCBpTFdITCkNCiAgICAgIG1pLm91dERhdGEucHV0KCJMV0hTIiwgaUxXSFMpDQoNCiAgICAgIC8vIFVwZGF0ZSBjaGFuZ2VkIGluZm9ybWF0aW9uDQogICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWFJHVE0iLCBMb2NhbERhdGVUaW1lLm5vdygpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oIkhIbW1zcyIpKS50b0ludGVnZXIoKSkNCiAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTE1EVCIsIExvY2FsRGF0ZS5ub3coKS5mb3JtYXQoRGF0ZVRpbWVGb3JtYXR0ZXIub2ZQYXR0ZXJuKCJ5eXl5TU1kZCIpKS50b0ludGVnZXIoKSkNCiAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hOTyIsIChsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpKQ0KICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCiAgICB9DQoNCiAgICBpZiAoIWRiQWN0aW9uZXh0NDAxLnJlYWRMb2NrKGV4dDQwMSwgcmVhZEFsbFJlY29yZEVYVDQwMSkpIHsNCiAgICAgIGxvZ2dlci5kZWJ1ZygiRmFpbGVkIHRvIHVwZGF0ZSAgRVhUNDAxIikNCiAgICB9DQogIH0NCg0KICAvKioNCiAgICogQ2FsbGluZyBFWFQ2MDEgdG8gUmVhZCBCYWxhbmNlIElkIHVzaW5nIHRoZSBGcm9tIExvY2F0aW9uIEtleXMNCiAgICovDQogIHByaXZhdGUgdm9pZCBjYWxsRVhUNjAxKCkgew0KICAgIGxvZ2dlci5kZWJ1ZygiSW4gY2FsbEVYVDYwMSBtZXRob2QiKQ0KDQogICAgREJBY3Rpb24gZGJBY3Rpb25leHQ2MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNjAxIikuaW5kZXgoIjAwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGV4dDYwMSA9IGRiQWN0aW9uZXh0NjAxLmdldENvbnRhaW5lcigpDQoNCiAgICBleHQ2MDEuc2V0KCJFWENPTk8iLCBpQ09OTykNCiAgICBleHQ2MDEuc2V0KCJFWFRSTlIiLCBUUk5SKQ0KICAgIGV4dDYwMS5zZXQoIkVYUE9OUiIsIFBPTlIudG9JbnRlZ2VyKCkpDQogICAgZXh0NjAxLnNldCgiRVhCQU5PIiwgaVNCQU4pDQogICAgZXh0NjAxLnNldCgiRVhDQU1VIiwgaUNBTVUpDQoNCiAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ2MDEgPSB7DQogICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgIEVYVDYwMVNUQVQgPSByZXN1bHRDb250YWluZXIuZ2V0RG91YmxlKCJFWFNUQVQiKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIlNUQVMiLCBFWFQ2MDFTVEFULnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJFWFQ2MDFTVEFUOiAiICsgRVhUNjAxU1RBVCkNCiAgICAgIGlmIChFWFQ2MDFTVEFULnRvSW50ZWdlcigpIDwgOTApIHsNCiAgICAgICAgY3J0UmVjbGFzc0JhbGFuY2VfRXhlYyhpQ09OTy50b1N0cmluZygpLCAiSU5WIiwgIjkwIiwgdG9XSExPLCB0b1dIU0wsIGlJVE5PLCBpU0JBTiwgaUNBTVUsIEVYVDYwMVNUQVQudG9TdHJpbmcoKSwgIiIsICIiKQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIGlmICghZGJBY3Rpb25leHQ2MDEucmVhZEFsbChleHQ2MDEsIDUsIHJlYWRBbGxSZWNvcmRFWFQ2MDEpKSB7DQogICAgICBsb2dnZXIuZGVidWcoIkZhaWxlZCB0byByZWFkICBFWFQ2MDEiKQ0KICAgIH0NCg0KICB9DQoNCiAgLyoqDQogICAqIENhbGxpbmcgdXBkTG9jU3ViTGV2ZWxzIHRvIHVwZGF0ZSBMYXN0IExvY2F0aW9uIG9uIGFsbCBTdWIgTGV2ZWxzIGFzIHdlbGwNCiAgICovDQogIHByaXZhdGUgdm9pZCB1cGRMb2NTdWJMZXZlbHMoU3RyaW5nIG5ld1dITE8sIFN0cmluZyBuZXdXSFNMLCBTdHJpbmcgbmV3Q0FNVSkgew0KICAgIGxvZ2dlci5kZWJ1ZygiSW4gdXBkTG9jU3ViTGV2ZWxzIG1ldGhvZCIpDQoNCiAgICBEQkFjdGlvbiBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KICAgIGNvbnRhaW5lckVYVDQwMSA9IGFjdGlvbkVYVDQwMS5nZXRDb250YWluZXIoKQ0KDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5DT05PIGFzIGludCkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBuZXdXSExPKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIG9yaWdCQU5PKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG5ld1dIU0wpDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgbmV3Q0FNVSkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCBpSVROTykNCg0KICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgY29udGFpbmVyRVhUNDAxID0gcmVzdWx0Q29udGFpbmVyDQogICAgfQ0KDQogICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZEVYVDQwMSkpIHsNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGZyb21XSExPKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhQQkFOIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBmcm9tV0hTTCkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGZyb21DQU1VKQ0KDQogICAgICBDbG9zdXJlIDwgPyA+IHVwZGF0ZUFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KDQogICAgICAgIGxvY2tlZFJlc3VsdC5hbGxDb2x1bW5zLmVhY2ggew0KICAgICAgICAgIFN0cmluZyBjb2x1bW4gLT4NCiAgICAgICAgICAgIGlmICghWyJFWExXSEwiLCAiRVhMV0hTIiwgIkVYQ0FNVSIsICJFWExNRFQiLCAiRVhDSE5PIiwgIkVYQ0hJRCJdLmNvbnRhaW5zKGNvbHVtbikpIHsNCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldChjb2x1bW4sIGxvY2tlZFJlc3VsdC5nZXQoY29sdW1uKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChsb2NrZWRSZXN1bHQuZGVsZXRlKCkpIHsNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBuZXdXSExPKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG5ld1dIU0wpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgbmV3Q0FNVSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0hOTyIsIGxvY2tlZFJlc3VsdC5nZXRJbnQoIkVYQ0hOTyIpICsgMSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCg0KICAgICAgICAgIGFjdGlvbkVYVDQwMS5pbnNlcnQoY29udGFpbmVyRVhUNDAxKQ0KICAgICAgICB9DQoNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgZnJvbVdITE8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIGxvY2tlZFJlc3VsdC5nZXRTdHJpbmcoIkVYUEJBTiIpKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBmcm9tV0hTTCkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgZnJvbUNBTVUpDQogICAgICB9DQoNCiAgICAgIHdoaWxlIChhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCB1cGRhdGVBbGxSZWNvcmRFWFQ0MDEpKSB7DQogICAgICAgIC8vDQogICAgICB9DQogICAgfQ0KDQogICAgLy9DaGFuZ2UgYWxsIFBvc3QtTGV2ZWxzIChVcHdhcmRzIGluIHRoZSBIaWVyYXJjaHkhKSAmIEFkZCBUZXh0IHRvIFN1Yi1Mb3QNCg0KICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBwcm9ncmFtLkxEQVpELkNPTk8gYXMgaW50KQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG5ld1dITE8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ0JBTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgbmV3V0hTTCkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBuZXdDQU1VKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PKQ0KDQogICAgaWYgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZEVYVDQwMSkpIHsNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGZyb21XSExPKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBmcm9tV0hTTCkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGZyb21DQU1VKQ0KDQogICAgICBDbG9zdXJlIDwgPyA+IHVwZGF0ZUFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KICAgICAgICBsb2NrZWRSZXN1bHQuYWxsQ29sdW1ucy5lYWNoIHsNCiAgICAgICAgICBTdHJpbmcgY29sdW1uIC0+DQogICAgICAgICAgICBpZiAoIVsiRVhMV0hMIiwgIkVYTFdIUyIsICJFWENBTVUiLCAiRVhMTURUIiwgIkVYQ0hOTyIsICJFWENISUQiXS5jb250YWlucyhjb2x1bW4pKSB7DQogICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoY29sdW1uLCBsb2NrZWRSZXN1bHQuZ2V0KGNvbHVtbikpDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAobG9ja2VkUmVzdWx0LmRlbGV0ZSgpKSB7DQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgbmV3V0hMTykNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBuZXdXSFNMKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIG5ld0NBTVUpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMTURUIiwgdXRpbGl0eS5jYWxsKCJEYXRlVXRpbCIsICJjdXJyZW50RGF0ZVk4QXNJbnQiKSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENITk8iLCBsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpDQogICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQoNCiAgICAgICAgICBhY3Rpb25FWFQ0MDEuaW5zZXJ0KGNvbnRhaW5lckVYVDQwMSkNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGZyb21XSExPKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFBCQU4iLCBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgZnJvbVdIU0wpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGZyb21DQU1VKQ0KICAgICAgfQ0KDQogICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjEwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICB3aGlsZSAoYWN0aW9uRVhUNDAxLnJlYWRBbGxMb2NrKGNvbnRhaW5lckVYVDQwMSwgNiwgdXBkYXRlQWxsUmVjb3JkRVhUNDAxKSkgew0KICAgICAgICAvL1VwZGF0ZSByZWNvcmRzIGluIENsb3N1cmUNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBwcml2YXRlIHZvaWQgdXBkUXR5U3ViTGV2ZWxzKFN0cmluZyBuZXdXSExPLCBTdHJpbmcgbmV3V0hTTCwgU3RyaW5nIG5ld0NBTVUsIFN0cmluZyBuZXdTVFFULCBTdHJpbmcgb3JpZ0JBTk8pIHsNCiAgICBsb2dnZXIuZGVidWcoIlN0YXJ0ZWQgdXBkUXR5U3ViTGV2ZWxzIikNCg0KICAgIERCQWN0aW9uIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBwcm9ncmFtLkxEQVpELmdldCgiQ09OTyIpLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkpDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgbmV3V0hMTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBuZXdXSFNMKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIG5ld0NBTVUpDQoNCiAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDEgPSB7DQogICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgIGNvbnRhaW5lckVYVDQwMSA9IHJlc3VsdENvbnRhaW5lcg0KDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYUEJBTiIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhMV0hTIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWENBTVUiKSkNCiAgICB9DQoNCiAgICBsb2dnZXIuZGVidWcoIlN0YXJ0aW5nIGZpcnN0IElGIC0gdXBkUXR5U3ViTGV2ZWxzIikNCiAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KDQogICAgICBDbG9zdXJlIDwgPyA+IHVwZGF0ZUFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KDQogICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTFNUUSIsIG5ld1NUUVQudG9Eb3VibGUoKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMTURUIiwgTG9jYWxEYXRlLm5vdygpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oIllZWVlNTWRkIikpLnRvSW50ZWdlcigpKQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiU3RhcnRpbmcgZmlyc3QgVVBEQVRFIC0gdXBkUXR5U3ViTGV2ZWxzIikNCiAgICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQoNCiAgICAgICAgbG9ja2VkUmVzdWx0LmFsbENvbHVtbnMuZWFjaCB7DQogICAgICAgICAgU3RyaW5nIGNvbHVtbiAtPg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldChjb2x1bW4sIGxvY2tlZFJlc3VsdC5nZXQoY29sdW1uKSkNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFBCQU4iKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hTIikpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiU3RhcnRpbmcgZmlyc3QgUkVBRCAtIHVwZFF0eVN1YkxldmVscyIpDQogICAgICB9DQoNCiAgICAgIGxvZ2dlci5kZWJ1ZygiU3RhcnRpbmcgZmlyc3QgV0hJTEUgLSB1cGRRdHlTdWJMZXZlbHMiKQ0KICAgICAgd2hpbGUgKGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZUFsbFJlY29yZEVYVDQwMSkpIHsNCiAgICAgICAgLy9VcGRhdGUgcmVjb3JkcyBpbiBDbG9zdXJlDQogICAgICB9DQoNCiAgICB9DQoNCiAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG5ld1dITE8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ0JBTk8pDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgbmV3V0hTTCkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBuZXdDQU1VKQ0KDQogICAgcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgY29udGFpbmVyRVhUNDAxID0gcmVzdWx0Q29udGFpbmVyDQoNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KICAgIH0NCg0KICAgIGxvZ2dlci5kZWJ1ZygiU3RhcnRpbmcgc2Vjb25kIElGIC0gdXBkUXR5U3ViTGV2ZWxzIikNCiAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KDQogICAgICBDbG9zdXJlIDwgPyA+IHVwZGF0ZUFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KDQogICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTFNUUSIsIG5ld1NUUVQudG9Eb3VibGUoKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMTURUIiwgTG9jYWxEYXRlLm5vdygpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oIllZWVlNTWRkIikpLnRvSW50ZWdlcigpKQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiU3RhcnRpbmcgc2Vjb25kIFVQREFURSAtIHVwZFF0eVN1YkxldmVscyIpDQogICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KDQogICAgICAgIGxvY2tlZFJlc3VsdC5hbGxDb2x1bW5zLmVhY2ggew0KICAgICAgICAgIFN0cmluZyBjb2x1bW4gLT4NCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoY29sdW1uLCBsb2NrZWRSZXN1bHQuZ2V0KGNvbHVtbikpDQogICAgICAgIH0NCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWENBTVUiKSkNCg0KICAgICAgICBsb2dnZXIuZGVidWcoIlN0YXJ0aW5nIHNlY29uZCBSRUFEIC0gdXBkUXR5U3ViTGV2ZWxzIikNCiAgICAgIH0NCg0KICAgICAgbG9nZ2VyLmRlYnVnKCJTdGFydGluZyBzZWNvbmQgV0hJTEUgLSB1cGRRdHlTdWJMZXZlbHMiKQ0KICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIxMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICAgIHdoaWxlIChhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCB1cGRhdGVBbGxSZWNvcmRFWFQ0MDEpKSB7DQogICAgICAgIC8vVXBkYXRlIHJlY29yZHMgaW4gQ2xvc3VyZQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIGxvZ2dlci5kZWJ1ZygiRmluaXNoZWQgdXBkUXR5U3ViTGV2ZWxzIikNCg0KICB9DQoNCiAgcHJpdmF0ZSB2b2lkIGNydFJlY2xhc3NCYWxhbmNlX0V4ZWMoU3RyaW5nIGlDT05PX1JjbEJhbCwgU3RyaW5nIGlFMFBBX1JjbEJhbCwgU3RyaW5nIGlFMDY1X1JjbEJhbCwgU3RyaW5nIGlCQU5PX1JjbEJhbCwgU3RyaW5nIGlOQkFOX1JjbEJhbCwgU3RyaW5nIGlJVE5PX1JjbEJhbCwgU3RyaW5nIGlTVEFTX1JjbEJhbCwgU3RyaW5nIGlXSExPX1JjbEJhbCwgU3RyaW5nIGlDQU1VX1JjbEJhbCwgU3RyaW5nIGlXSFNMX1JjbEJhbCwgU3RyaW5nIGlSU0NEX1JjbEJhbCkgew0KICAgIHpOZXdTVEFTID0gaVNUQVNfUmNsQmFsDQoNCiAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjAwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KICAgIGNvbnRhaW5lckVYVDQwMSA9IGFjdGlvbkVYVDQwMS5nZXRDb250YWluZXIoKQ0KDQogICAgREJBY3Rpb24gYWN0aW9uTUlUV0hMID0gZGF0YWJhc2UudGFibGUoIk1JVFdITCIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTVdDT05PIiwgIk1XV0hMTyIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJNSVRXSEwgPSBhY3Rpb25NSVRXSEwuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lck1JVFdITC5zZXQoIk1XQ09OTyIsIGlDT05PX1JjbEJhbC50b0ludGVnZXIoKSkNCiAgICBjb250YWluZXJNSVRXSEwuc2V0KCJNV1dITE8iLCBpV0hMT19SY2xCYWwpDQoNCiAgICBhY3Rpb25NSVRXSEwucmVhZChjb250YWluZXJNSVRXSEwpDQoNCiAgICBGQUNJID0gY29udGFpbmVyTUlUV0hMLmdldFN0cmluZygiTVdGQUNJIikNCg0KICAgIFN0cmluZyBiYXNlX0JBTk8sIGJhc2VfTkJBTg0KICAgIGRvdWJsZSB0b3RhbFF0eUluTG9jYXRpb24gPSAwDQoNCiAgICBiYXNlX0JBTk8gPSBpQkFOT19SY2xCYWwNCiAgICBpZiAoaUJBTk9fUmNsQmFsLmluZGV4T2YoJ3wnKSA+IDApIHsNCiAgICAgIGJhc2VfQkFOTyA9IGlCQU5PX1JjbEJhbC5zcGxpdCgiXFx8IilbMF0NCiAgICB9DQoNCiAgICBiYXNlX05CQU4gPSBpTkJBTl9SY2xCYWwNCiAgICBpZiAoaU5CQU5fUmNsQmFsLmluZGV4T2YoJ3wnKSA+IDApIHsNCiAgICAgIGJhc2VfTkJBTiA9IGlOQkFOX1JjbEJhbC5zcGxpdCgiXFx8IilbMF0NCiAgICB9DQoNCiAgICBpZiAoYmFzZV9OQkFOICE9IGJhc2VfQkFOTyAmJiAhaU5CQU5fUmNsQmFsLmlzRW1wdHkoKSkgew0KICAgICAgcmV0dXJuDQogICAgfQ0KDQogICAgYm9vbGVhbiBmaXJzdFJlY2xhc3NTdWJsb3QgPSB0cnVlDQoNCiAgICBEQkFjdGlvbiBhY3Rpb25RTVNSUUggPSBkYXRhYmFzZS50YWJsZSgiUU1TUlFIIikuaW5kZXgoIjMwIikuc2VsZWN0aW9uKCJSSENPTk8iLCAiUkhJVE5PIiwgIlJIQkFOTyIsICJSSFFTVEEiLCAiUkhRUlJQIiwgIlJIUUFQUiIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJRTVNSUUggPSBhY3Rpb25RTVNSUUguZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lclFNU1JRSC5zZXQoIlJIQ09OTyIsIGlDT05PX1JjbEJhbC50b0ludGVnZXIoKSkNCiAgICBjb250YWluZXJRTVNSUUguc2V0KCJSSElUTk8iLCBpSVROT19SY2xCYWwpDQogICAgY29udGFpbmVyUU1TUlFILnNldCgiUkhCQU5PIiwgaU5CQU5fUmNsQmFsKQ0KDQogICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3Jkc1FNU1JRSCA9IHsNCiAgICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciAtPg0KICAgIH0NCg0KICAgIGlmIChhY3Rpb25RTVNSUUgucmVhZEFsbChjb250YWluZXJRTVNSUUgsIDMsIHJlYWRBbGxSZWNvcmRzUU1TUlFIKSkgew0KICAgICAgZmlyc3RSZWNsYXNzU3VibG90ID0gZmFsc2UNCiAgICB9DQoNCiAgICBib29sZWFuIHpWYWxpZFJlYyA9IHRydWUNCiAgICBpbnQgY3VyckxldmVsID0gMA0KICAgIGludCB1cGRUeXBlID0gMA0KDQogICAgaWYgKCFbIjEiLCAiMiIsICIzIiwgIjkiXS5jb250YWlucyhpU1RBU19SY2xCYWwpKSB7DQogICAgICB6VmFsaWRSZWMgPSBmYWxzZQ0KICAgIH0NCg0KICAgIG9yaWdXSExPID0gaVdITE9fUmNsQmFsDQogICAgb3JpZ0JBTk8gPSBpQkFOT19SY2xCYWwNCiAgICBvcmlnQ0FNVSA9IGlDQU1VX1JjbEJhbA0KICAgIG9yaWdXSFNMID0gaVdIU0xfUmNsQmFsDQoNCiAgICBTdHJpbmcgYmFzZUJBTk8NCiAgICBpZiAob3JpZ0JBTk8uaW5kZXhPZignfCcpID4gMCkgew0KICAgICAgYmFzZUJBTk8gPSBvcmlnQkFOTy5zcGxpdCgiXFx8IilbMF0NCiAgICB9IGVsc2Ugew0KICAgICAgYmFzZUJBTk8gPSBvcmlnQkFOTw0KICAgIH0NCg0KICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb24gPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiTUlUTE9DIikNCiAgICBTdHJpbmcgYmFzZUNBTVUgPSBvcmlnQ0FNVS5zcGxpdCgiXyIpWzBdDQogICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24ubGlrZSgiTUxDQU1VIiwgYmFzZUNBTVUgKyAiJSIpDQoNCiAgICBEQkFjdGlvbiBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjk5Iikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTFNUQVMiLCAiTUxTVFFUIiwgIk1MUUlBRCIsICJNTExNRFQiLCAiTUxDSE5PIiwgIk1MQ0hJRCIpLmJ1aWxkKCkNCiAgICBjb250YWluZXJNSVRMT0MgPSBhY3Rpb25NSVRMT0MuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ09OTyIsIGlDT05PX1JjbEJhbC50b0ludGVnZXIoKSkNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENBTVUiLCBvcmlnQ0FNVSkNCg0KICAgIHRvdGFsUXR5SW5Mb2NhdGlvbiA9IGdldFRvdGFsUXR5TG9jQ0FNVShhY3Rpb25NSVRMT0MsIGNvbnRhaW5lck1JVExPQywgYmFzZUJBTk8pDQoNCiAgICBsb2dnZXIuZGVidWcoIkJlZm9yZSBOQkFOIGNoZWNrIikNCiAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCg0KICAgIGlmIChpTkJBTl9SY2xCYWwudHJpbSgpLmxlbmd0aCgpID4gMSkgew0KICAgICAgbG9nZ2VyLmRlYnVnKCJJbnNpZGUgTkJBTiBjaGVjayB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMpDQoNCiAgICAgIGlmIChpQkFOT19SY2xCYWwudHJpbSgpLmxlbmd0aCgpID4gaU5CQU5fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSkgew0KICAgICAgICB6VmFsaWRSZWMgPSBmYWxzZQ0KICAgICAgfQ0KDQogICAgICBpZiAoaUJBTk9fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSA8IGlOQkFOX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgJiYgKGlOQkFOX1JjbEJhbC5zdWJzdHJpbmcoMCwgaU5CQU5fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSAtIDQpICE9IGlCQU5PX1JjbEJhbCkgfHwgaU5CQU5fUmNsQmFsLnN1YnN0cmluZyhpTkJBTl9SY2xCYWwudHJpbSgpLmxlbmd0aCgpIC0gNCwgaU5CQU5fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSAtIDMpICE9ICJ8Iikgew0KICAgICAgICB6VmFsaWRSZWMgPSBmYWxzZQ0KICAgICAgfQ0KDQogICAgICBpZiAoaUJBTk9fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSA9PSBpTkJBTl9SY2xCYWwudHJpbSgpLmxlbmd0aCgpICYmIChpTkJBTl9SY2xCYWwuc3Vic3RyaW5nKGlOQkFOX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgLSA0LCBpTkJBTl9SY2xCYWwudHJpbSgpLmxlbmd0aCgpIC0gMykgIT0gInwiIHwgaUJBTk9fUmNsQmFsLnN1YnN0cmluZyhpQkFOT19SY2xCYWwudHJpbSgpLmxlbmd0aCgpIC0gNCwgaUJBTk9fUmNsQmFsLnRyaW0oKS5sZW5ndGgoKSAtIDMpICE9ICJ8IiB8fCBpTkJBTl9SY2xCYWwuc3Vic3RyaW5nKDAsIGlOQkFOX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgLSA0KSAhPSBpQkFOT19SY2xCYWwuc3Vic3RyaW5nKDAsIGlCQU5PX1JjbEJhbC50cmltKCkubGVuZ3RoKCkgLSA0KSkpIHsNCiAgICAgICAgelZhbGlkUmVjID0gZmFsc2UNCiAgICAgIH0NCg0KICAgICAgbG9nZ2VyLmRlYnVnKCJ6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMpDQoNCiAgICAgIHVwZFR5cGUgPSAxDQoNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGlXSExPX1JjbEJhbCkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGlXSFNMX1JjbEJhbCkNCg0KICAgIH0gZWxzZSB7DQogICAgICBpZiAoaVNUQVNfUmNsQmFsLmlzQmxhbmsoKSkgew0KICAgICAgICB6VmFsaWRSZWMgPSBmYWxzZQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaU5CQU5fUmNsQmFsID0gaUJBTk9fUmNsQmFsDQoNCiAgICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxID0gYWN0aW9uRVhUNDAxLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBvcmlnV0hMTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk9fUmNsQmFsKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ0NBTVUpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdXSFNMKQ0KDQogICAgICAgIExpc3QgPCBMb2NrZWRSZXN1bHQgPiBhcnJheU9mQ29udGFpbmVycyA9IG5ldyBBcnJheUxpc3QgPCBMb2NrZWRSZXN1bHQgPiAoKQ0KICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KICAgICAgICAgIGFycmF5T2ZDb250YWluZXJzLmFkZChsb2NrZWRSZXN1bHQpDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGxMb2NrKGNvbnRhaW5lckVYVDQwMSwgNiwgcmVhZEFsbFJlY29yZEVYVDQwMSkpIHsNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVjb3JkIGZvdW5kIGluIEVYVDQwMS4gVXBkYXRpbmcgRVhTVEFTIGZvciBTQkFOOiAiICsgb3JpZ0JBTk8pDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0ID0gYXJyYXlPZkNvbnRhaW5lcnNbMF0NCg0KICAgICAgICAgIGlmICghaVJTQ0RfUmNsQmFsLmlzQmxhbmsoKSkgew0KICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhSU0NEIiwgaVJTQ0RfUmNsQmFsKQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYU1RBUyIsIHpOZXdTVEFTIGFzIGNoYXIpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMU1RRIiwgdG90YWxRdHlJbkxvY2F0aW9uKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTE1EVCIsIExvY2FsRGF0ZS5ub3coKS5mb3JtYXQoRGF0ZVRpbWVGb3JtYXR0ZXIub2ZQYXR0ZXJuKCJZWVlZTU1kZCIpKS50b0ludGVnZXIoKSkNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENITk8iLCBsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQoNCiAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCg0KICAgICAgICAgIGlmICh6TmV3U1RBUyA9PSAnOScgfHwgek5ld1NUQVMgPT0gJzInKSB7DQogICAgICAgICAgICBpTkJBTl9SY2xCYWwgPSBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWFBCQU4iKQ0KICAgICAgICAgICAgaVNUQVNfUmNsQmFsID0gIjIiDQogICAgICAgICAgICB6TmV3U1RBUyA9ICIyIg0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmICh6TmV3U1RBUyA9PSAnMycpIHsNCiAgICAgICAgICAgIGlOQkFOX1JjbEJhbCA9IGxvY2tlZFJlc3VsdC5nZXRTdHJpbmcoIkVYQkFOTyIpDQogICAgICAgICAgfQ0KDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZWNvcmQgZm91bmQgaW4gRVhUNDAxLiBVcGRhdGVkIEVYU1RBUyBmb3IgU0JBTjogIiArIG9yaWdCQU5PKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHpOZXdTVEFTID09ICczJykgew0KICAgICAgICAgIGlOQkFOX1JjbEJhbCA9IGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQkFOTyIpDQogICAgICAgICAgYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxTVEFTIiwgIk1MU1RRVCIsICJNTFFJQUQiLCAiTUxMTURUIiwgIk1MQ0hOTyIsICJNTENISUQiKS5idWlsZCgpDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENPTk8iLCBwcm9ncmFtLkxEQVpELmdldCgiQ09OTyIpLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkpDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgb3JpZ1dITE8pDQogICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgaUlUTk9fUmNsQmFsKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIG9yaWdXSFNMKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIG9yaWdCQU5PKQ0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIG9yaWdDQU1VKQ0KDQogICAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkTUlUTE9DID0gew0KICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgICAgICBjb250YWluZXJNSVRMT0MgPSByZXN1bHRDb250YWluZXINCiAgICAgICAgICB9DQoNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIkluc2lkZSBSZWplY3Rpb24gbG9naWMiKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgYm9vbGVhbiBJTjkxID0gIWFjdGlvbk1JVExPQy5yZWFkQWxsKGNvbnRhaW5lck1JVExPQywgNiwgMSwgcmVhZEFsbFJlY29yZE1JVExPQykNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDFfMSA9IHsNCiAgICAgICAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxID0gcmVzdWx0Q29udGFpbmVyDQogICAgICAgICAgfQ0KDQogICAgICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIHByb2dyYW0uTERBWkQuZ2V0KCJDT05PIikgYXMgaW50KQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdXSExPKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PX1JjbEJhbCkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVhZGluZyBFWFQ0MDEgfCBCZWZvcmUgY29udGFpbmVyRVhUNDAxOiAiICsgY29udGFpbmVyRVhUNDAxLnRvU3RyaW5nKCkpDQogICAgICAgICAgYm9vbGVhbiBJTjkzID0gIWFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZEVYVDQwMV8xKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVhZGluZyBFWFQ0MDEgfCBBZnRlciBjb250YWluZXJFWFQ0MDE6ICIgKyBjb250YWluZXJFWFQ0MDEudG9TdHJpbmcoKSkNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIklOOTE6ICIgKyBJTjkxICsgIiB8IElOOTM6ICIgKyBJTjkzKQ0KICAgICAgICAgIHdoaWxlIChJTjkxICYmICFJTjkzKSB7DQogICAgICAgICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjEwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBwcm9ncmFtLkxEQVpELmdldCgiQ09OTyIpLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkpDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYSVROTyIpKQ0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWENBTVUiKSkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KDQogICAgICAgICAgICBMaXN0IDwgTG9ja2VkUmVzdWx0ID4gbG9ja2VkUmVzdWx0TGlzdCA9IG5ldyBBcnJheUxpc3QgPCBMb2NrZWRSZXN1bHQgPiAoKQ0KICAgICAgICAgICAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0TGlzdC5hZGQobG9ja2VkUmVzdWx0KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIkluc2lkZSB3aGlsZSBFWFQ0MDEgfCBCZWZvcmUgY29udGFpbmVyRVhUNDAxOiAiICsgY29udGFpbmVyRVhUNDAxLnRvU3RyaW5nKCkpDQogICAgICAgICAgICBJTjkzID0gIWFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZVJlY29yZEVYVDQwMSkNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiSW5zaWRlIHdoaWxlIEVYVDQwMSB8IEFmdGVyIGNvbnRhaW5lckVYVDQwMTogIiArIGNvbnRhaW5lckVYVDQwMS50b1N0cmluZygpKQ0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJJTjkzOiAiICsgSU45MykNCiAgICAgICAgICAgIGlmICghSU45Mykgew0KICAgICAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0ID0gbG9ja2VkUmVzdWx0TGlzdFswXQ0KDQogICAgICAgICAgICAgIGlmIChsb2NrZWRSZXN1bHQuZ2V0KCJFWFNUQVMiKSA9PSAiMSINCiAgICAgICAgICAgICAgICBhcyBjaGFyKSB7DQogICAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgek5ld1NUQVMgYXMgY2hhcikNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTFNUUSIsIHRvdGFsUXR5SW5Mb2NhdGlvbikNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMTURUIiwgdXRpbGl0eS5jYWxsKCJEYXRlVXRpbCIsICJjdXJyZW50RGF0ZVk4QXNJbnQiKSkNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hOTyIsIGxvY2tlZFJlc3VsdC5nZXRJbnQoIkVYQ0hOTyIpICsgMSkNCiAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQoNCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgbG9ja2VkUmVzdWx0LmdldFN0cmluZygiRVhTQkFOIikpDQoNCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJVcGRhdGVkIExvY2tlZHJlc3VsdDogIiArIGxvY2tlZFJlc3VsdCkNCg0KICAgICAgICAgICAgICBhY3Rpb25NSVRMT0MgPSBkYXRhYmFzZS50YWJsZSgiTUlUTE9DIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNTENPTk8iLCAiTUxXSExPIiwgIk1MV0hTTCIsICJNTElUTk8iLCAiTUxCQU5PIiwgIk1MQ0FNVSIsICJNTFNUQVMiLCAiTUxTVFFUIiwgIk1MUUlBRCIsICJNTExNRFQiLCAiTUxDSE5PIiwgIk1MQ0hJRCIpLmJ1aWxkKCkNCiAgICAgICAgICAgICAgY29udGFpbmVyTUlUTE9DID0gYWN0aW9uTUlUTE9DLmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgICAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdITE8iLCBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxJVE5PIiwgbG9ja2VkUmVzdWx0LmdldFN0cmluZygiRVhJVE5PIikpDQogICAgICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIGxvY2tlZFJlc3VsdC5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KICAgICAgICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTEJBTk8iLCBsb2NrZWRSZXN1bHQuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCiAgICAgICAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDQU1VIiwgbG9ja2VkUmVzdWx0LmdldFN0cmluZygiRVhDQU1VIikpDQoNCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZWFkaW5nIE1JVExPQyB8IEJlZm9yZSBjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCiAgICAgICAgICAgICAgSU45MSA9ICFhY3Rpb25NSVRMT0MucmVhZEFsbChjb250YWluZXJNSVRMT0MsIDYsIDEsIHJlYWRBbGxSZWNvcmRNSVRMT0MpDQogICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVhZGluZyBNSVRMT0MgfCBCZWZvcmUgY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiSU45MTogIiArIElOOTEpDQogICAgICAgICAgICAgIGlmICghSU45MSkgew0KICAgICAgICAgICAgICAgIGlXSExPX1JjbEJhbCA9IGNvbnRhaW5lck1JVExPQy5nZXRTdHJpbmcoIk1MV0hMTyIpDQogICAgICAgICAgICAgICAgaUJBTk9fUmNsQmFsID0gY29udGFpbmVyTUlUTE9DLmdldFN0cmluZygiTUxCQU5PIikNCiAgICAgICAgICAgICAgICBpV0hTTF9SY2xCYWwgPSBjb250YWluZXJNSVRMT0MuZ2V0U3RyaW5nKCJNTFdIU0wiKQ0KDQogICAgICAgICAgICAgICAgb3JpZ1dITE8gPSBpV0hMT19SY2xCYWwNCiAgICAgICAgICAgICAgICBvcmlnQkFOTyA9IGlCQU5PX1JjbEJhbA0KICAgICAgICAgICAgICAgIG9yaWdXSFNMID0gaVdIU0xfUmNsQmFsDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnV0hMTzogIiArIG9yaWdXSExPICsgIiB8IG9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgb3JpZ1dIU0w6ICIgKyBvcmlnV0hTTCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB1cGRUeXBlID0gMg0KDQogICAgICB9DQogICAgfQ0KDQogICAgbG9nZ2VyLmRlYnVnKCJCZWZvcmUgelZhbGlkUmVjIGNoZWNrIikNCiAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCg0KICAgIGlmICh6VmFsaWRSZWMpIHsNCiAgICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gU2V0QmFsUmNsRHRJbnB1dCA9IFsNCiAgICAgICAgIldITE8iOiBjb250YWluZXJFWFQ0MDEuZ2V0KCJFWExXSEwiKS50b1N0cmluZygpLA0KICAgICAgICAiSVROTyI6IGlJVE5PX1JjbEJhbCwNCiAgICAgICAgIldIU0wiOiBjb250YWluZXJFWFQ0MDEuZ2V0KCJFWExXSFMiKS50b1N0cmluZygpLA0KICAgICAgICAiQkFOTyI6IGlCQU5PX1JjbEJhbA0KICAgICAgXQ0KDQogICAgICBib29sZWFuIGFwaVN1Y2Nlc3NmdWwgPSB0cnVlDQoNCiAgICAgIENsb3N1cmUgPCA/ID4gY2FsbEJhY2tBUElTZXRCYWxSY2xEdCA9IHsNCiAgICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsNCiAgICAgICAgICBhcGlTdWNjZXNzZnVsID0gZmFsc2UNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIk1JIEVycm9yIGNhbGxCYWNrQVBJU2V0QmFsUmNsRHQiKQ0KICAgICAgICAgIG1pLmVycm9yKHJlc3BvbnNlLmVycm9yTWVzc2FnZS50b1N0cmluZygpKQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgbG9nZ2VyLmRlYnVnKCJCZWZvcmUgc2V0QmFsYW5jZVJjbERhdGUiKQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCg0KICAgICAgc2V0QmFsYW5jZVJjbERhdGUoY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hMIiksIGlJVE5PX1JjbEJhbCwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hTIiksIGlCQU5PX1JjbEJhbCkNCg0KICAgICAgYWN0aW9uTUlUTE9DID0gZGF0YWJhc2UudGFibGUoIk1JVExPQyIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiTUxDT05PIiwgIk1MV0hMTyIsICJNTFdIU0wiLCAiTUxJVE5PIiwgIk1MQkFOTyIsICJNTENBTVUiLCAiTUxTVEFTIiwgIk1MU1RRVCIsICJNTFFJQUQiLCAiTUxMTURUIiwgIk1MQ0hOTyIsICJNTENISUQiKS5idWlsZCgpDQogICAgICBjb250YWluZXJNSVRMT0MgPSBhY3Rpb25NSVRMT0MuZ2V0Q29udGFpbmVyKCkNCg0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgb3JpZ1dITE8pDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTElUTk8iLCBpSVROT19SY2xCYWwpDQogICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdIU0wiLCBvcmlnV0hTTCkNCiAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIG9yaWdCQU5PKQ0KICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDQU1VIiwgb3JpZ0NBTVUpDQoNCiAgICAgIGlmICh1cGRUeXBlID09IDEpIHsNCiAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkTUlUTE9DID0gew0KICAgICAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgICAgIGNvbnRhaW5lck1JVExPQyA9IHJlc3VsdENvbnRhaW5lcg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVjb3JkIGZvdW5kIGluIE1JVExPQyAtIHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IFNUQVM6ICIgKyByZXN1bHRDb250YWluZXIuZ2V0KCJNTFNUQVMiKS50b1N0cmluZygpKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICAgIGlmICh1cGRUeXBlID09IDEpIHsNCiAgICAgICAgICAgIGlmIChyZXN1bHRDb250YWluZXIuZ2V0KCJNTFNUQVMiKS50b1N0cmluZygpICE9ICcxJykgew0KICAgICAgICAgICAgICBNYXAgPCBTdHJpbmcsIFN0cmluZyA+IGFkZFJjbExvdFN0c0lucHV0RGF0YSA9IFsNCiAgICAgICAgICAgICAgICAiUFJGTCI6ICIqRVhFIiwNCiAgICAgICAgICAgICAgICAiRTBQQSI6IGlFMFBBX1JjbEJhbCwNCiAgICAgICAgICAgICAgICAiRTA2NSI6IGlFMDY1X1JjbEJhbCwNCiAgICAgICAgICAgICAgICAiV0hMTyI6IGNvbnRhaW5lck1JVExPQy5nZXRTdHJpbmcoIk1MV0hMTyIpLA0KICAgICAgICAgICAgICAgICJXSFNMIjogY29udGFpbmVyTUlUTE9DLmdldFN0cmluZygiTUxXSFNMIiksDQogICAgICAgICAgICAgICAgIklUTk8iOiBpSVROT19SY2xCYWwsDQogICAgICAgICAgICAgICAgIkJBTk8iOiBpQkFOT19SY2xCYWwsDQogICAgICAgICAgICAgICAgIkNBTVUiOiBpQ0FNVV9SY2xCYWwsDQogICAgICAgICAgICAgICAgIlJTQ0QiOiBpUlNDRF9SY2xCYWwsDQogICAgICAgICAgICAgICAgIkFMT0MiOiAiMSIsDQogICAgICAgICAgICAgICAgIlNUQVMiOiAiMSIsDQogICAgICAgICAgICAgIF0NCg0KICAgICAgICAgICAgICBDbG9zdXJlIDwgPyA+IGNhbGxCYWNrQVBJQWRkUmNsTG90U3RzID0gew0KICAgICAgICAgICAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgICAgICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikgew0KICAgICAgICAgICAgICAgICAgYXBpU3VjY2Vzc2Z1bCA9IGZhbHNlDQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIk1JIEVycm9yIGNhbGxCYWNrQVBJQWRkUmNsTG90U3RzIikNCiAgICAgICAgICAgICAgICAgIG1pLmVycm9yKHJlc3BvbnNlLmVycm9yTWVzc2FnZS50b1N0cmluZygpKQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBhcGlTdWNjZXNzZnVsID0gdHJ1ZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQmVmb3JlIFJjbEJhbGFuY2UgQWRkUmNsTG90U3RzIikNCiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIkFkZFJjbExvdFN0cyBpbnB1dHM6ICIgKyBhZGRSY2xMb3RTdHNJbnB1dERhdGEudG9TdHJpbmcoKSkNCg0KICAgICAgICAgICAgICBtaUNhbGxlci5jYWxsKCJNTVM4NTBNSSIsICJBZGRSY2xMb3RTdHMiLCBhZGRSY2xMb3RTdHNJbnB1dERhdGEsIGNhbGxCYWNrQVBJQWRkUmNsTG90U3RzKQ0KDQogICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQWZ0ZXIgUmNsQmFsYW5jZSBBZGRSY2xMb3RTdHM6ICIgKyBhcGlTdWNjZXNzZnVsKQ0KICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gYWRkUmVDbGFzc0lucHV0RGF0YSA9IFsNCiAgICAgICAgICAgICAgIlBSRkwiOiAiKkVYRSIsDQogICAgICAgICAgICAgICJFMFBBIjogaUUwUEFfUmNsQmFsLA0KICAgICAgICAgICAgICAiRTA2NSI6IGlFMDY1X1JjbEJhbCwNCiAgICAgICAgICAgICAgIldITE8iOiBjb250YWluZXJNSVRMT0MuZ2V0U3RyaW5nKCJNTFdITE8iKSwNCiAgICAgICAgICAgICAgIldIU0wiOiBjb250YWluZXJNSVRMT0MuZ2V0U3RyaW5nKCJNTFdIU0wiKSwNCiAgICAgICAgICAgICAgIklUTk8iOiBpSVROT19SY2xCYWwsDQogICAgICAgICAgICAgICJCQU5PIjogaUJBTk9fUmNsQmFsLA0KICAgICAgICAgICAgICAiQ0FNVSI6IGlDQU1VX1JjbEJhbCwNCiAgICAgICAgICAgICAgIk5JVE4iOiBpSVROT19SY2xCYWwsDQogICAgICAgICAgICAgICJOQkFOIjogaU5CQU5fUmNsQmFsLA0KICAgICAgICAgICAgICAiUlNDRCI6IGlSU0NEX1JjbEJhbCwNCiAgICAgICAgICAgICAgIlNUQVMiOiAiMSIsDQogICAgICAgICAgICAgICJBTE9DIjogIjEiLA0KICAgICAgICAgICAgICAiUUxRVCI6IGNvbnRhaW5lck1JVExPQy5nZXQoIk1MU1RRVCIpLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIF0NCg0KICAgICAgICAgICAgQ2xvc3VyZSA8ID8gPiBjYWxsQmFja0FQSUFkZFJlY2xhc3MgPSB7DQogICAgICAgICAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgICAgICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7DQogICAgICAgICAgICAgICAgYXBpU3VjY2Vzc2Z1bCA9IGZhbHNlDQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJNSSBFcnJvciBjYWxsQmFja0FQSUFkZFJlY2xhc3MiKQ0KICAgICAgICAgICAgICAgIG1pLmVycm9yKHJlc3BvbnNlLmVycm9yTWVzc2FnZS50b1N0cmluZygpICsgIi0iICsgaUUwUEFfUmNsQmFsICsgIi0iICsgaUUwNjVfUmNsQmFsKQ0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGFwaVN1Y2Nlc3NmdWwgPSB0cnVlDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJCZWZvcmUgUmNsQmFsYW5jZSBBZGRSZWNsYXNzIikNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIkFkZFJlY2xhc3MgaW5wdXRzOiAiICsgYWRkUmVDbGFzc0lucHV0RGF0YS50b1N0cmluZygpKQ0KDQogICAgICAgICAgICBtaUNhbGxlci5jYWxsKCJNTVM4NTBNSSIsICJBZGRSZWNsYXNzIiwgYWRkUmVDbGFzc0lucHV0RGF0YSwgY2FsbEJhY2tBUElBZGRSZWNsYXNzKQ0KDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIkFmdGVyIFJjbEJhbGFuY2UgQWRkUmNsTG90U3RzOiAiICsgYXBpU3VjY2Vzc2Z1bCkNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICAgIGlmIChhcGlTdWNjZXNzZnVsKSB7DQogICAgICAgICAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBvcmlnV0hMTykNCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhJVE5PIiwgaUlUTk9fUmNsQmFsKQ0KICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ0NBTVUpDQogICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdXSFNMKQ0KDQogICAgICAgICAgICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXJFWFQ0MDEgLT4NCiAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEgPSByZXN1bHRDb250YWluZXJFWFQ0MDENCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGlmIChhY3Rpb25FWFQ0MDEucmVhZEFsbChjb250YWluZXJFWFQ0MDEsIDYsIDEsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpKSB7DQoNCiAgICAgICAgICAgICAgICBjdXJyTGV2ZWwgPSBjb250YWluZXJFWFQ0MDEuZ2V0SW50KCJFWENMVkwiKSArIDENCiAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0Q2hhcigiRVhTVEFTIiwgIjEiKQ0KDQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJJbnNpZGUgY3VyckxldmVsIGxvZ2ljOiAiICsgY29udGFpbmVyRVhUNDAxLmdldEludCgiRVhDTFZMIikudG9TdHJpbmcoKSkNCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGFjdGlvbk1JVExPQyA9IGRhdGFiYXNlLnRhYmxlKCJNSVRMT0MiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIk1MQ09OTyIsICJNTFdITE8iLCAiTUxXSFNMIiwgIk1MSVROTyIsICJNTEJBTk8iLCAiTUxDQU1VIiwgIk1MU1RBUyIsICJNTFNUUVQiLCAiTUxRSUFEIiwgIk1MTE1EVCIsICJNTENITk8iLCAiTUxDSElEIikuYnVpbGQoKQ0KDQogICAgICAgICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIGlOQkFOX1JjbEJhbCkNCg0KICAgICAgICAgICAgICBTdHJpbmcgdGVtcFdITE8sIHRlbXBXSFNMLCB0ZW1wQ0FNVSwgdGVtcFNUUVQgPSAiIg0KICAgICAgICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRNSVRMT0MgPSB7DQogICAgICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyTUlUTE9DXzEgLT4NCiAgICAgICAgICAgICAgICBjb250YWluZXJNSVRMT0MgPSByZXN1bHRDb250YWluZXJNSVRMT0NfMQ0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgaWYgKGFjdGlvbk1JVExPQy5yZWFkQWxsKGNvbnRhaW5lck1JVExPQywgNiwgcmVhZEFsbFJlY29yZE1JVExPQykpIHsNCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlJlY29yZCBmb3VuZCB3aXRoIE5CQU4iKQ0KICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB1cGRUeXBlOiAiICsgdXBkVHlwZSArICIgfCB6VmFsaWRSZWM6ICIgKyB6VmFsaWRSZWMgKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgICAgICAgdGVtcFdITE8gPSBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFdITE8iKS50b1N0cmluZygpDQogICAgICAgICAgICAgICAgdGVtcFNUUVQgPSBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFNUUVQiKS50b1N0cmluZygpDQogICAgICAgICAgICAgICAgdGVtcFdIU0wgPSBjb250YWluZXJNSVRMT0MuZ2V0KCJNTFdIU0wiKS50b1N0cmluZygpDQogICAgICAgICAgICAgICAgdGVtcENBTVUgPSBjb250YWluZXJNSVRMT0MuZ2V0KCJNTENBTVUiKS50b1N0cmluZygpDQoNCiAgICAgICAgICAgICAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgcHJvZ3JhbS5MREFaRC5nZXQoIkNPTk8iKS50b1N0cmluZygpLnRvSW50ZWdlcigpKQ0KICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdXSExPKQ0KICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PX1JjbEJhbCkNCiAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBpTkJBTl9SY2xCYWwpDQogICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ0NBTVUpDQogICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgb3JpZ1dIU0wpDQoNCiAgICAgICAgICAgICAgICBMaXN0IDwgTG9ja2VkUmVzdWx0ID4gYXJyYXlPZkxvY2tlZFJlc3VsdHMgPSBuZXcgQXJyYXlMaXN0IDwgTG9ja2VkUmVzdWx0ID4gKCkNCg0KICAgICAgICAgICAgICAgIENsb3N1cmUgPCA/ID4gdXBkYXRlRmlyc3RSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgICAgICAgICAgICBhcnJheU9mTG9ja2VkUmVzdWx0cy5hZGQobG9ja2VkUmVzdWx0KQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICghYWN0aW9uRVhUNDAxLnJlYWRBbGxMb2NrKGNvbnRhaW5lckVYVDQwMSwgNiwgdXBkYXRlRmlyc3RSZWNvcmRFWFQ0MDEpKSB7DQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlJlY29yZCBub3QgZm91bmQuIEluc2VydGluZyIpDQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFdITE8iLCBvcmlnV0hMTykNCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYUEJBTiIsIGlCQU5PX1JjbEJhbCkNCiAgICAgICAgICAgICAgICAgIGlmIChpQkFOT19SY2xCYWwuaW5kZXhPZignfCcpID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWEJBTk8iLCBpQkFOT19SY2xCYWwuc3Vic3RyaW5nKDAsIGlCQU5PX1JjbEJhbC5pbmRleE9mKCd8JykpKQ0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhCQU5PIiwgaUJBTk9fUmNsQmFsKQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhXSFNMIiwgaVdIU0xfUmNsQmFsKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDTFZMIiwgY3VyckxldmVsKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTVEFTIiwgJzEnDQogICAgICAgICAgICAgICAgICAgIGFzIGNoYXIpDQogICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFJTQ0QiLCBpUlNDRF9SY2xCYWwpDQogICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFJHRFQiLCBMb2NhbERhdGUubm93KCkuZm9ybWF0KERhdGVUaW1lRm9ybWF0dGVyLm9mUGF0dGVybigiWVlZWU1NZGQiKSkudG9JbnRlZ2VyKCkpDQogICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFJHVE0iLCBMb2NhbFRpbWUubm93KCkuZm9ybWF0KERhdGVUaW1lRm9ybWF0dGVyLm9mUGF0dGVybigiSEhtbXNzIikpLnRvSW50ZWdlcigpKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMTURUIiwgTG9jYWxEYXRlLm5vdygpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oIllZWVlNTWRkIikpLnRvSW50ZWdlcigpKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENITk8iLCAwKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgdGVtcFdITE8pDQogICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCB0ZW1wV0hTTCkNCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ1dITCIsIHRlbXBXSExPKQ0KICAgICAgICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDV0hTIiwgdGVtcFdIU0wpDQogICAgICAgICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExTVFEiLCB0ZW1wU1RRVC50b0RvdWJsZSgpKQ0KDQogICAgICAgICAgICAgICAgICBhY3Rpb25FWFQ0MDEuaW5zZXJ0KGNvbnRhaW5lckVYVDQwMSkNCg0KICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJFWFQ0MDE6ICIgKyBjb250YWluZXJFWFQ0MDEudG9TdHJpbmcoKSkNCg0KICAgICAgICAgICAgICAgICAgdXBkUXR5U3ViTGV2ZWxzKHRlbXBXSExPLCB0ZW1wV0hTTCwgdGVtcENBTVUsIHRlbXBTVFFULCBvcmlnQkFOTykNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCA9IGFycmF5T2ZMb2NrZWRSZXN1bHRzWzBdDQoNCiAgICAgICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYU1RBUyIsICIxIg0KICAgICAgICAgICAgICAgICAgICBhcyBjaGFyKQ0KICAgICAgICAgICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMU1RRIiwgdGVtcFNUUVQudG9Eb3VibGUoKSkNCiAgICAgICAgICAgICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KDQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlJlY29yZCBmb3VuZC4gVXBkYXRpbmciKQ0KICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJjb250YWluZXJNSVRMT0M6ICIgKyBjb250YWluZXJNSVRMT0MudG9TdHJpbmcoKSkNCiAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygibG9ja2VkUmVzdWx0OiAiICsgbG9ja2VkUmVzdWx0LnRvU3RyaW5nKCkpDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGZpcnN0UmVjbGFzc1N1YmxvdCkgew0KICAgICAgICAgICAgICAgICAgYm9vbGVhbiBpc0FQSVN1Y2Nlc3NmdWwgPSBmYWxzZQ0KICAgICAgICAgICAgICAgICAgU3RyaW5nIFFSSUQgPSAiIg0KICAgICAgICAgICAgICAgICAgTWFwIDwgU3RyaW5nLCBTdHJpbmcgPiBhZGRRSVJlcXVlc3RQYXJhbXMgPSBbDQogICAgICAgICAgICAgICAgICAgICJGQUNJIjogRkFDSSwNCiAgICAgICAgICAgICAgICAgICAgIklUTk8iOiBpSVROT19SY2xCYWwsDQogICAgICAgICAgICAgICAgICAgICJCQU5PIjogaU5CQU5fUmNsQmFsLA0KICAgICAgICAgICAgICAgICAgICAiUVJEVCI6IExvY2FsRGF0ZS5ub3coKS5mb3JtYXQoRGF0ZVRpbWVGb3JtYXR0ZXIub2ZQYXR0ZXJuKCJZWVlZTU1kZCIpKSwNCiAgICAgICAgICAgICAgICAgICAgIlNSVFQiOiAiMSIsDQogICAgICAgICAgICAgICAgICAgICJUUFMxIjogIjAiDQogICAgICAgICAgICAgICAgICBdDQoNCiAgICAgICAgICAgICAgICAgIENsb3N1cmUgPCA/ID4gYWRkUUlSZXF1ZXN0SGFuZGxlciA9IHsNCiAgICAgICAgICAgICAgICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgICAgICAgICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIk1JIEVycm9yIGFkZFFJUmVxdWVzdEhhbmRsZXIiKQ0KICAgICAgICAgICAgICAgICAgICAgIG1pLmVycm9yKHJlc3BvbnNlLmVycm9yTWVzc2FnZS50b1N0cmluZygpKQ0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIGlzQVBJU3VjY2Vzc2Z1bCA9IHRydWUNCiAgICAgICAgICAgICAgICAgICAgICBRUklEID0gcmVzcG9uc2UuUVJJRA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIkNhbGxpbmcgUU1TMzAwTUkgQWRkUUlSZXF1ZXN0IikNCg0KICAgICAgICAgICAgICAgICAgaWYgKGlzQVBJU3VjY2Vzc2Z1bCkgew0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlFNUzMwME1JIFN1Y2Nlc3NmdWwiKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICAgICAgICAgICAgcW1zMzAwTUlBZGRRSVJlcXVlc3RTdWNjZXNzZnVsKFFSSUQpDQoNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiTUkgRXJyb3IgVGVzdCBlcnJvciIpDQogICAgICAgICAgICAgIG1pLmVycm9yKCJUZXN0IGVycm9yIikNCiAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGFjdGlvbk1JVExPQy5yZWFkQWxsKGNvbnRhaW5lck1JVExPQywgNiwgMSwgcmVhZEFsbFJlY29yZE1JVExPQykpIHsNCiAgICAgICAgICAvL2dldCByZWNvcmRzIGZyb20gTUlUTE9DIGluIENsb3N1cmUNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgREJBY3Rpb24gYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBwcm9ncmFtLkxEQVpELkNPTk8udG9TdHJpbmcoKS50b0ludGVnZXIoKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ1dITE8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PX1JjbEJhbCkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgb3JpZ0JBTk8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIG9yaWdDQU1VKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgICAgICBMaXN0IDwgTG9ja2VkUmVzdWx0ID4gYXJyYXlPZkxvY2tlZFJlc3VsdHMgPSBuZXcgQXJyYXlMaXN0IDwgTG9ja2VkUmVzdWx0ID4gKCkNCg0KICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRFWFQ0MDEgPSB7DQogICAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KICAgICAgICAgIGFycmF5T2ZMb2NrZWRSZXN1bHRzLmFkZChsb2NrZWRSZXN1bHQpDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIWFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpKSB7DQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJNSSBFcnJvciBFWFQ0MDEgbm8gcmVjb3JkIG5vdCB1cGRUeXBlMSIpDQogICAgICAgICAgbWkuZXJyb3IoIlJlY29yZCBkb2VzIG5vdCBleGlzdCIpDQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCA9IGFycmF5T2ZMb2NrZWRSZXN1bHRzWzBdDQoNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWFNUQVMiLCB6TmV3U1RBUyBhcyBjaGFyKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTFNUUSIsIHRvdGFsUXR5SW5Mb2NhdGlvbikNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCBMb2NhbERhdGUubm93KCkuZm9ybWF0KERhdGVUaW1lRm9ybWF0dGVyLm9mUGF0dGVybigiWVlZWU1NZGQiKSkudG9JbnRlZ2VyKCkpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQoNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIkJlZm9yZSBjYWxsaW5nIHVwZFF0eVN1YkxldmVscyIpDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICB1cGRRdHlTdWJMZXZlbHMob3JpZ1dITE8sIG9yaWdXSFNMLCBvcmlnQ0FNVSwgdG90YWxRdHlJbkxvY2F0aW9uLnRvU3RyaW5nKCksIG9yaWdCQU5PKQ0KDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJBZnRlciBjYWxsaW5nIHVwZFF0eVN1YkxldmVscyIpDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHVwZFR5cGU6ICIgKyB1cGRUeXBlICsgIiB8IHpWYWxpZFJlYzogIiArIHpWYWxpZFJlYyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICBpZiAoaVNUQVNfUmNsQmFsICE9ICIxIikgew0KICAgICAgICAgICAgeHhDaGdTdHMgPSBmYWxzZQ0KICAgICAgICAgICAgY3J0UmVjbGFzc1RvUHJldkxvdChvcmlnQkFOTywgb3JpZ1dITE8sIGlDQU1VX1JjbEJhbCwgb3JpZ1dIU0wsIGlJVE5PX1JjbEJhbCwgaUUwUEFfUmNsQmFsLCBpRTA2NV9SY2xCYWwsICIiLCBpUlNDRF9SY2xCYWwpDQoNCiAgICAgICAgICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gYWRkUmNsTG90U3RzUGFyYW1zID0gWw0KICAgICAgICAgICAgICAiQkFOTyI6IGNvbnRhaW5lck1JVExPQy5nZXRTdHJpbmcoIk1MQkFOTyIpLA0KICAgICAgICAgICAgICAiUFJGTCI6ICIqRVhFIiwNCiAgICAgICAgICAgICAgIkUwUEEiOiBpRTBQQV9SY2xCYWwsDQogICAgICAgICAgICAgICJFMDY1IjogaUUwNjVfUmNsQmFsLA0KICAgICAgICAgICAgICAiV0hMTyI6IGNvbnRhaW5lck1JVExPQy5nZXRTdHJpbmcoIk1MV0hMTyIpLA0KICAgICAgICAgICAgICAiV0hTTCI6IGNvbnRhaW5lck1JVExPQy5nZXRTdHJpbmcoIk1MV0hTTCIpLA0KICAgICAgICAgICAgICAiSVROTyI6IGlJVE5PX1JjbEJhbCwNCiAgICAgICAgICAgICAgIkNBTVUiOiBpQ0FNVV9SY2xCYWwsDQogICAgICAgICAgICAgICJSU0NEIjogaVJTQ0RfUmNsQmFsLA0KICAgICAgICAgICAgICAiQUxPQyI6ICIxIiwNCiAgICAgICAgICAgICAgIlNUQVMiOiBjb250YWluZXJNSVRMT0MuZ2V0U3RyaW5nKCJNTEJBTk8iKS5pbmRleE9mKCJ8IikgPiAwID8gIjEiIDogek5ld1NUQVMNCiAgICAgICAgICAgIF0NCg0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJDYWxsaW5nIEFkZFJjbExvdFN0cyIpDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgdXBkVHlwZTogIiArIHVwZFR5cGUgKyAiIHwgelZhbGlkUmVjOiAiICsgelZhbGlkUmVjICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMpDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJhZGRSY2xMb3RTdHNQYXJhbXMiICsgYWRkUmNsTG90U3RzUGFyYW1zLnRvU3RyaW5nKCkpDQoNCiAgICAgICAgICAgIGFjdGlvbk1JVExPQyA9IGRhdGFiYXNlLnRhYmxlKCJNSVRMT0MiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIk1MQ09OTyIsICJNTFdITE8iLCAiTUxXSFNMIiwgIk1MSVROTyIsICJNTEJBTk8iLCAiTUxDQU1VIiwgIk1MU1RBUyIsICJNTFNUUVQiLCAiTUxRSUFEIiwgIk1MTE1EVCIsICJNTENITk8iLCAiTUxDSElEIikuYnVpbGQoKQ0KDQogICAgICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRNSVRMT0MgPSB7DQogICAgICAgICAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgICAgICAgICBjYWxsTU1TODUwTUlfQWRkUmNsTG90U3RzKGFkZFJjbExvdFN0c1BhcmFtcykNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCFhY3Rpb25NSVRMT0MucmVhZEFsbChjb250YWluZXJNSVRMT0MsIDYsIDEsIHJlYWRBbGxSZWNvcmRNSVRMT0MpKSB7DQogICAgICAgICAgICAgIC8vZ2V0IHJlY29yZHMgZnJvbSBNSVRMT0MgaW4gQ2xvc3VyZQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgfQ0KDQogIH0NCg0KICBwcml2YXRlIGRvdWJsZSBnZXRUb3RhbFF0eUxvY0NBTVUoREJBY3Rpb24gZGJBY3Rpb24sIERCQ29udGFpbmVyIGRiQ29udGFpbmVyLCBTdHJpbmcgYmFzZUJBTk8pIHsNCiAgICBkb3VibGUgdG90UXR5ID0gMA0KDQogICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkcyA9IHsNCiAgICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciAtPg0KICAgICAgaWYgKGNvbnRhaW5lci5nZXRTdHJpbmcoIk1MQkFOTyIpLnRyaW0oKSA9PSBiYXNlQkFOTy50cmltKCkgfHwgY29udGFpbmVyLmdldFN0cmluZygiTUxCQU5PIikudHJpbSgpLnN0YXJ0c1dpdGgoYmFzZUJBTk8udHJpbSgpICsgInwiKSkgew0KICAgICAgICB0b3RRdHkgKz0gY29udGFpbmVyLmdldERvdWJsZSgiTUxTVFFUIikNCiAgICAgIH0NCiAgICB9DQoNCiAgICBkYkFjdGlvbi5yZWFkQWxsKGRiQ29udGFpbmVyLCAyLCByZWFkQWxsUmVjb3JkcykNCg0KICAgIHJldHVybiB0b3RRdHkNCiAgfQ0KDQogIHByaXZhdGUgdm9pZCBxbXMzMDBNSUFkZFFJUmVxdWVzdFN1Y2Nlc3NmdWwoU3RyaW5nIFFSSUQpIHsNCg0KICAgIGJvb2xlYW4gaXNVcGRRSVJlcXVlc3RTdWNjZXNzZnVsID0gZmFsc2UNCiAgICBNYXAgPCBTdHJpbmcsIFN0cmluZyA+IHVwZFFJUmVxdWVzdFBhcmFtcyA9IFsNCiAgICAgICJGQUNJIjogRkFDSSwNCiAgICAgICJRUklEIjogUVJJRCwNCiAgICAgICJJVE5PIjogaUlUTk8sDQogICAgICAiUVNUQSI6ICIxIg0KICAgIF0NCg0KICAgIENsb3N1cmUgPCA/ID4gdXBkUUlSZXF1ZXN0SGFuZGxlciA9IHsNCiAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgIFN0cmluZyA+IHJlc3BvbnNlIC0+DQogICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsNCiAgICAgICAgbWkuZXJyb3IocmVzcG9uc2UuZXJyb3JNZXNzYWdlLnRvU3RyaW5nKCkpDQogICAgICAgIHJldHVybg0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaXNVcGRRSVJlcXVlc3RTdWNjZXNzZnVsID0gdHJ1ZQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIG1pQ2FsbGVyLmNhbGwoIlFNUzMwME1JIiwgIlVwZFFJUmVxdWVzdCIsIHVwZFFJUmVxdWVzdFBhcmFtcywgdXBkUUlSZXF1ZXN0SGFuZGxlcikNCg0KICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gdXBkVGVzdFJlc3VsdFBhcmFtcyA9IFsNCiAgICAgICJGQUNJIjogRkFDSSwNCiAgICAgICJRUklEIjogUVJJRCwNCiAgICAgICJJVE5PIjogaUlUTk8sDQogICAgICAiUVRTVCI6ICJEVU1NWSIsDQogICAgICAiVFNUWSI6ICIyIiwNCiAgICAgICJUU0VRIjogIjAwMDEiLA0KICAgICAgIlFMQ0QiOiAiQ09NUExFVEUiLA0KICAgICAgIlZMRU4iOiAiMSINCiAgICBdDQoNCiAgICBDbG9zdXJlIDwgPyA+IHVwZFRlc3RSZXN1bHRIYW5kbGVyID0gew0KICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgIGlmIChyZXNwb25zZS5lcnJvcikgew0KICAgICAgICBtaS5lcnJvcihyZXNwb25zZS5lcnJvck1lc3NhZ2UudG9TdHJpbmcoKSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKGlzVXBkUUlSZXF1ZXN0U3VjY2Vzc2Z1bCkgew0KICAgICAgbWlDYWxsZXIuY2FsbCgiUU1TNDAwTUkiLCAiVXBkVGVzdFJlc3VsdCIsIHVwZFRlc3RSZXN1bHRQYXJhbXMsIHVwZFRlc3RSZXN1bHRIYW5kbGVyKQ0KICAgIH0NCiAgfQ0KDQogIHByaXZhdGUgdm9pZCBjYWxsTU1TODUwTUlfQWRkUmNsTG90U3RzKE1hcCA8IFN0cmluZywgU3RyaW5nID4gYWRkUmNsTG90U3RzUGFyYW1zKSB7DQoNCiAgICBDbG9zdXJlIDwgPyA+IGFkZFJjbExvdFN0c0hhbmRsZXIgPSB7DQogICAgICBNYXAgPCBTdHJpbmcsDQogICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7DQogICAgICAgIG1pLmVycm9yKHJlc3BvbnNlLmVycm9yTWVzc2FnZS50b1N0cmluZygpKQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICB9DQoNCiAgICBtaUNhbGxlci5jYWxsKCJNTVM4NTBNSSIsICJBZGRSY2xMb3RTdHMiLCBhZGRSY2xMb3RTdHNQYXJhbXMsIGFkZFJjbExvdFN0c0hhbmRsZXIpDQogIH0NCg0KICBwcml2YXRlIHZvaWQgY3J0UmVjbGFzc1RvUHJldkxvdChTdHJpbmcgaUJBTk9fUmNsUHJldkxvdCwgU3RyaW5nIGlXSExPX1JjbFByZXZMb3QsIFN0cmluZyBpQ0FNVV9SY2xQcmV2TG90LCBTdHJpbmcgaVdIU0xfUmNsUHJldkxvdCwgU3RyaW5nIGlJVE5PX1JjbFByZXZMb3QsIFN0cmluZyBpRTBQQV9SY2xQcmV2TG90LCBTdHJpbmcgaUUwNjVfUmNsUHJldkxvdCwgU3RyaW5nIGlSTVZDX1JjbFByZXZMb3QsIFN0cmluZyBpUlNDRF9SY2xQcmV2TG90KSB7DQogICAgU3RyaW5nIEVYVDQwMV9TQkFOLCBFWFQ0MDFfTFdITCwgRVhUNDAxX0lUTk8sIEVYVDQwMV9QQkFOLCBFWFQ0MDFfQ0FNVSwgRVhUNDAxX0xXSFMsIEVYVDQwMV9CQU5PDQogICAgU3RyaW5nIE1JVExPQ19CQU5PLCBNSVRMT0NfV0hMTywgTUlUTE9DX0lUTk8sIE1JVExPQ19DQU1VLCBNSVRMT0NfV0hTTA0KICAgIGJvb2xlYW4gc2tpcFRvQmFzZQ0KDQogICAgU3RyaW5nIHpDdXJyU3RhcywgTUlUTE9DX1NUQVMsIEVYVDQwMV9TVEFTDQoNCiAgICBib29sZWFuIElOOTEgPSBmYWxzZQ0KICAgIGJvb2xlYW4gSU45MyA9IGZhbHNlDQogICAgYm9vbGVhbiBsb29wQ29uZGl0aW9uID0gZmFsc2UNCg0KICAgIGludCBDT05PID0gcHJvZ3JhbS5MREFaRC5DT05PLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkNCg0KICAgIERCQWN0aW9uIGFjdGlvbk1JVFdITCA9IGRhdGFiYXNlLnRhYmxlKCJNSVRXSEwiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIk1XQ09OTyIsICJNV1dITE8iLCAiTVdGQUNJIikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lck1JVFdITCA9IGFjdGlvbk1JVFdITC5nZXRDb250YWluZXIoKQ0KDQogICAgY29udGFpbmVyTUlUV0hMLnNldCgiTVdDT05PIiwgQ09OTykNCiAgICBjb250YWluZXJNSVRXSEwuc2V0KCJNV1dITE8iLCBpV0hMT19SY2xQcmV2TG90KQ0KDQogICAgYWN0aW9uTUlUV0hMLnJlYWQoY29udGFpbmVyTUlUV0hMKQ0KDQogICAgU3RyaW5nIGJhc2VCQU5PID0gaUJBTk9fUmNsUHJldkxvdA0KDQogICAgaWYgKG9yaWdXSExPLnRyaW0oKS5pc0VtcHR5KCkpIHsNCiAgICAgIG9yaWdXSExPID0gaVdITE9fUmNsUHJldkxvdA0KICAgICAgb3JpZ0JBTk8gPSBpQkFOT19SY2xQcmV2TG90DQogICAgICBvcmlnQ0FNVSA9IGlDQU1VX1JjbFByZXZMb3QNCiAgICAgIG9yaWdXSFNMID0gaVdIU0xfUmNsUHJldkxvdA0KICAgIH0NCg0KICAgIERCQWN0aW9uIGFjdGlvbk1JVExPQyA9IGRhdGFiYXNlLnRhYmxlKCJNSVRMT0MiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIk1MQ09OTyIsICJNTFdITE8iLCAiTUxXSFNMIiwgIk1MSVROTyIsICJNTEJBTk8iLCAiTUxDQU1VIiwgIk1MU1RBUyIsICJNTFNUUVQiLCAiTUxRSUFEIiwgIk1MTE1EVCIsICJNTENITk8iLCAiTUxDSElEIikuYnVpbGQoKQ0KICAgIGNvbnRhaW5lck1JVExPQyA9IGFjdGlvbk1JVExPQy5nZXRDb250YWluZXIoKQ0KDQogICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxDT05PIiwgQ09OTykNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTFdITE8iLCBvcmlnV0hMTykNCiAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTElUTk8iLCBpSVROT19SY2xQcmV2TG90KQ0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIG9yaWdXSFNMKQ0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQkFOTyIsIG9yaWdCQU5PKQ0KICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ0FNVSIsIG9yaWdDQU1VKQ0KDQogICAgekN1cnJTdGFzID0gJycNCg0KICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZE1JVExPQyA9IHsNCiAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgY29udGFpbmVyTUlUTE9DID0gcmVzdWx0Q29udGFpbmVyDQogICAgICB6Q3VyclN0YXMgPSByZXN1bHRDb250YWluZXIuZ2V0KCJNTFNUQVMiKS50b1N0cmluZygpDQogICAgICBNSVRMT0NfQkFOTyA9IHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIk1MQkFOTyIpDQogICAgICBNSVRMT0NfQ0FNVSA9IHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIk1MQ0FNVSIpDQogICAgICBNSVRMT0NfSVROTyA9IHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIk1MSVROTyIpDQogICAgICBNSVRMT0NfV0hMTyA9IHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIk1MV0hMTyIpDQogICAgICBNSVRMT0NfV0hTTCA9IHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIk1MV0hTTCIpDQogICAgICBNSVRMT0NfU1RBUyA9IHJlc3VsdENvbnRhaW5lci5nZXQoIk1MU1RBUyIpLnRvU3RyaW5nKCkNCiAgICB9DQoNCiAgICBsb2dnZXIuZGVidWcoIlJjbFByZXZMb3QgQmVmb3JlIHJlYWRpbmcgTUlUTE9DIikNCiAgICBsb2dnZXIuZGVidWcoIm9yaWdCQU5POiAiICsgb3JpZ0JBTk8gKyAiIHwgek5ld1N0YXM6ICIgKyB6TmV3U1RBUykNCiAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgaWYgKGFjdGlvbk1JVExPQy5yZWFkQWxsKGNvbnRhaW5lck1JVExPQywgNiwgcmVhZEFsbFJlY29yZE1JVExPQykpIHsNCiAgICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gYWRkUmVjbGFzc0lucHV0cyA9IFsNCiAgICAgICAgIlFMUVQiOiAiIiwNCiAgICAgICAgIlBSRkwiOiAiKkVYRSIsDQogICAgICAgICJFMFBBIjogaUUwUEFfUmNsUHJldkxvdCwNCiAgICAgICAgIkUwNjUiOiBpRTA2NV9SY2xQcmV2TG90LA0KICAgICAgICAiV0hMTyI6IG9yaWdXSExPLA0KICAgICAgICAiV0hTTCI6IG9yaWdXSFNMLA0KICAgICAgICAiSVROTyI6IGlJVE5PX1JjbFByZXZMb3QsDQogICAgICAgICJCQU5PIjogb3JpZ0JBTk8sDQogICAgICAgICJDQU1VIjogb3JpZ0NBTVUsDQogICAgICAgICJOSVROIjogaUlUTk9fUmNsUHJldkxvdCwNCiAgICAgICAgIk5CQU4iOiBNSVRMT0NfQkFOTw0KICAgICAgXQ0KDQogICAgICBsb2dnZXIuZGVidWcoIlJjbFByZXZMb3QgQmVmb3JlIHJlYWRpbmcgTUlUTE9DIikNCiAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTICsgIiB8IHpDdXJyU3RhczogIiArIHpDdXJyU3RhcykNCiAgICAgIGxvZ2dlci5kZWJ1ZygiY29udGFpbmVyTUlUTE9DOiAiICsgY29udGFpbmVyTUlUTE9DLnRvU3RyaW5nKCkpDQogICAgICBsb2dnZXIuZGVidWcoImFkZFJlY2xhc3NJbnB1dHM6ICIgKyBhZGRSZWNsYXNzSW5wdXRzLnRvU3RyaW5nKCkpDQoNCiAgICAgIGlmICh6Q3VyclN0YXMgPT0gIjMiIHx8IHpOZXdTVEFTID09ICczJykgew0KICAgICAgICB6TmV3U1RBUyA9ICIzIg0KDQogICAgICAgIERCQWN0aW9uIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgQ09OTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgTUlUTE9DX1dITE8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIE1JVExPQ19JVE5PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBNSVRMT0NfQkFOTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgTUlUTE9DX0NBTVUpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIE1JVExPQ19XSFNMKQ0KDQogICAgICAgIExpc3QgPCBEQkNvbnRhaW5lciA+IGFycmF5T2ZDb250YWluZXJzID0gbmV3IEFycmF5TGlzdCA8IERCQ29udGFpbmVyID4gKCkNCiAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkRVhUNDAxID0gew0KICAgICAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgICAgIGFycmF5T2ZDb250YWluZXJzLmFkZChyZXN1bHRDb250YWluZXIpDQoNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhY3Rpb25FWFQ0MDEucmVhZEFsbChjb250YWluZXJFWFQ0MDEsIDYsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpKSB7DQogICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyID0gYXJyYXlPZkNvbnRhaW5lcnNbMF0NCg0KICAgICAgICAgIGFkZFJlY2xhc3NJbnB1dHMuTkJBTiA9IHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYQkFOTyIpDQogICAgICAgICAgYWRkUmVjbGFzc0lucHV0cy5SU0NEID0gIiINCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmNsUHJldkxvdCBCZWZvcmUgY2FsbGluZyByZWplY3RBZmZlY3RBbGxMZXZlbHMiKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTICsgIiB8IHpDdXJyU3RhczogIiArIHpDdXJyU3RhcykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KDQogICAgICAgICAgcmVqZWN0QWZmZWN0QWxsTGV2ZWxzKENPTk8sIG9yaWdXSExPLCBvcmlnQkFOTywgb3JpZ0NBTVUsIG9yaWdXSFNMLCBFWFQ0MDFfU0JBTiwgRVhUNDAxX0JBTk8pDQoNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIlJjbFByZXZMb3QgQWZ0ZXIgY2FsbGluZyByZWplY3RBZmZlY3RBbGxMZXZlbHMiKQ0KICAgICAgICAgIGxvZ2dlci5kZWJ1Zygib3JpZ0JBTk86ICIgKyBvcmlnQkFOTyArICIgfCB6TmV3U3RhczogIiArIHpOZXdTVEFTICsgIiB8IHpDdXJyU3RhczogIiArIHpDdXJyU3RhcykNCiAgICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICB9DQoNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNraXBUb0Jhc2UgPSBmYWxzZQ0KDQogICAgICAgIERCQWN0aW9uIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgQ09OTykNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ1dITE8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PX1JjbFByZXZMb3QpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIG9yaWdCQU5PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgb3JpZ1dIU0wpDQoNCiAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3Jkc0VYVDQwMSA9IHsNCiAgICAgICAgICBEQkNvbnRhaW5lciByZXN1bHRDb250YWluZXIgLT4NCiAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLk5CQU4gPSByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWFBCQU4iKQ0KICAgICAgICAgIGJhc2VCQU5PID0gcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhCQU5PIikNCg0KICAgICAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBDT05PKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYSVROTyIpKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYUEJBTiIpKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KDQogICAgICAgICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3Jkc0VYVDQwMV8xID0gew0KICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyXzEgLT4NCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMSA9IHJlc3VsdENvbnRhaW5lcl8xDQogICAgICAgICAgICBFWFQ0MDFfU1RBUyA9IHJlc3VsdENvbnRhaW5lcl8xLmdldCgiRVhTVEFTIikudG9TdHJpbmcoKQ0KICAgICAgICAgICAgRVhUNDAxX1NCQU4gPSByZXN1bHRDb250YWluZXJfMS5nZXQoIkVYU0JBTiIpLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIEVYVDQwMV9MV0hMID0gcmVzdWx0Q29udGFpbmVyXzEuZ2V0KCJFWExXSEwiKS50b1N0cmluZygpDQogICAgICAgICAgICBFWFQ0MDFfSVROTyA9IHJlc3VsdENvbnRhaW5lcl8xLmdldCgiRVhJVE5PIikudG9TdHJpbmcoKQ0KICAgICAgICAgICAgRVhUNDAxX1BCQU4gPSByZXN1bHRDb250YWluZXJfMS5nZXQoIkVYUEJBTiIpLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIEVYVDQwMV9DQU1VID0gcmVzdWx0Q29udGFpbmVyXzEuZ2V0KCJFWENBTVUiKS50b1N0cmluZygpDQogICAgICAgICAgICBFWFQ0MDFfTFdIUyA9IHJlc3VsdENvbnRhaW5lcl8xLmdldCgiRVhMV0hTIikudG9TdHJpbmcoKQ0KICAgICAgICAgICAgRVhUNDAxX0JBTk8gPSByZXN1bHRDb250YWluZXJfMS5nZXQoIkVYQkFOTyIpLnRvU3RyaW5nKCkNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBJTjkzID0gIWFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZHNFWFQ0MDFfMSkNCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2hlY2sgSU45MzogIiArIElOOTMpDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJDaGVjayByZXN1bHRDb250YWluZXI6ICIgKyByZXN1bHRDb250YWluZXIudG9TdHJpbmcoKSkNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIkNoZWNrIEVYU1RBUzogIiArIHJlc3VsdENvbnRhaW5lci5nZXQoIkVYU1RBUyIpLnRvU3RyaW5nKCkpDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJFWFNUQVM6ICIgKyBFWFQ0MDFfU1RBUykNCiAgICAgICAgICBpZiAoSU45Mykgew0KICAgICAgICAgICAgYWRkUmVjbGFzc0lucHV0cy5OQkFOID0gYmFzZUJBTk8NCiAgICAgICAgICAgIGFkZFJlY2xhc3NJbnB1dHMuQUxPQyA9ICIxIg0KICAgICAgICAgICAgSU45MyA9IHRydWUNCiAgICAgICAgICAgIHpOZXdTVEFTID0gIjIiDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoIUlOOTMgJiYgRVhUNDAxX1NUQVMgPT0gIjEiKSB7DQogICAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLk5CQU4gPSBFWFQ0MDFfU0JBTg0KICAgICAgICAgICAgekN1cnJTdGFzID0gRVhUNDAxX1NUQVMNCiAgICAgICAgICAgIHpOZXdTVEFTID0gIjEiDQogICAgICAgICAgICBJTjkzID0gdHJ1ZQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKCFJTjkzICYmIEVYVDQwMV9TVEFTICE9ICIxIikgew0KICAgICAgICAgICAgek5ld1NUQVMgPSBFWFQ0MDFfU1RBUw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiUmNsUHJldkxvdCBOb3QgUmVqZWN0IExvZ2ljIHwgc2tpcHRvQmFzZSA9IGZhbHNlIikNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMgKyAiIHwgekN1cnJTdGFzOiAiICsgekN1cnJTdGFzKQ0KICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lckVYVDQwMTogIiArIGNvbnRhaW5lckVYVDQwMS50b1N0cmluZygpKQ0KDQogICAgICAgIGlmICghYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3Jkc0VYVDQwMSkpIHsNCg0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIElOOTEgPSBmYWxzZQ0KICAgICAgICB9DQoNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJFbnRlcmluZyB0aGUgSU45MSB3aGlsZSBsb29wIHwgSU45MTogIiArIElOOTEgKyAiIHwgSU45MzogIiArIElOOTMpDQoNCiAgICAgICAgd2hpbGUgKCFJTjkxICYmICFJTjkzKSB7DQoNCiAgICAgICAgICBib29sZWFuIHRlc3RzVmVyaWZpZWQgPSBmYWxzZTsNCg0KICAgICAgICAgIGlmICghdGVzdHNWZXJpZmllZCkgew0KICAgICAgICAgICAgREJBY3Rpb24gYWN0aW9uUU1TUlFIID0gZGF0YWJhc2UudGFibGUoIlFNU1JRSCIpLmluZGV4KCIzMCIpLnNlbGVjdGlvbigiUkhDT05PIiwgIlJISVROTyIsICJSSEJBTk8iLCAiUkhRU1RBIiwgIlJIUVJSUCIsICJSSFFBUFIiKS5yZXZlcnNlKCkuYnVpbGQoKQ0KICAgICAgICAgICAgY29udGFpbmVyUU1TUlFIID0gYWN0aW9uUU1TUlFILmdldENvbnRhaW5lcigpDQoNCiAgICAgICAgICAgIGNvbnRhaW5lclFNU1JRSC5zZXQoIlJIQ09OTyIsIENPTk8pDQogICAgICAgICAgICBjb250YWluZXJRTVNSUUguc2V0KCJSSElUTk8iLCBpSVROT19SY2xQcmV2TG90KQ0KICAgICAgICAgICAgY29udGFpbmVyUU1TUlFILnNldCgiUkhCQU5PIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhCQU5PIikpDQoNCiAgICAgICAgICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZFFNU1JRSCA9IHsNCiAgICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgICAgICAgIGNvbnRhaW5lclFNU1JRSCA9IHJlc3VsdENvbnRhaW5lcg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoYWN0aW9uUU1TUlFILnJlYWRBbGwoY29udGFpbmVyUU1TUlFILCAzLCAxLCByZWFkQWxsUmVjb3JkUU1TUlFIKSkgew0KICAgICAgICAgICAgICBpZiAoY29udGFpbmVyUU1TUlFILmdldEludCgiUkhRU1RBIikgPCA0ICYmIGNvbnRhaW5lclFNU1JRSC5nZXRTdHJpbmcoIlJIUVJSUCIpLnRyaW0oKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICB0ZXN0c1ZlcmlmaWVkID0gZmFsc2UNCiAgICAgICAgICAgICAgICBza2lwVG9CYXNlID0gZmFsc2UNCg0KICAgICAgICAgICAgICAgIGlmIChjb250YWluZXJRTVNSUUguZ2V0SW50KCJSSFFBUFIiKSA+IDApIHsNCiAgICAgICAgICAgICAgICAgIHRlc3RzVmVyaWZpZWQgPSB0cnVlDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lclFNU1JRSC5nZXRJbnQoIlJIUUFQUiIpID09IDIgJiYgY29udGFpbmVyTUlUTE9DLmdldCgiTUxTVEFTIikgPT0gIjEiDQogICAgICAgICAgICAgICAgICBhcyBjaGFyKSB7DQogICAgICAgICAgICAgICAgICB6Q3VyclN0YXMgPSAiMyINCiAgICAgICAgICAgICAgICAgIHpOZXdTVEFTID0gIjMiDQogICAgICAgICAgICAgICAgICBza2lwVG9CYXNlID0gdHJ1ZQ0KICAgICAgICAgICAgICAgICAgYWRkUmVjbGFzc0lucHV0cy5OQkFOID0gYmFzZUJBTk8NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoek5ld1NUQVMgPT0gJzEnIHx8IHpDdXJyU3RhcyA9PSAnMycgfHwgc2tpcFRvQmFzZSB8fCAoek5ld1NUQVMgPT0gJzEnICYmIHRlc3RzVmVyaWZpZWQpKSB7DQogICAgICAgICAgICBpZiAoY29udGFpbmVyUU1TUlFILmdldCgiUkhRU1RBIikgPT0gIjEiDQogICAgICAgICAgICAgIGFzIGNoYXIpIHsNCiAgICAgICAgICAgICAgYWRkUmVjbGFzc0lucHV0cy5OQkFOID0gY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIElOOTEgPSB0cnVlDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYSVROTyIpKQ0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhQQkFOIikpDQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWENBTVUiKSkNCiAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KDQogICAgICAgICAgICByZWFkQWxsUmVjb3Jkc0VYVDQwMSA9IHsNCiAgICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgICAgICAgIGNvbnRhaW5lckVYVDQwMSA9IHJlc3VsdENvbnRhaW5lcg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBJTjkzID0gIWFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZHNFWFQ0MDEpDQogICAgICAgICAgICBJTjkxID0gSU45Mw0KDQogICAgICAgICAgICBpZiAoSU45Mykgew0KICAgICAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLk5CQU4gPSBiYXNlQkFOTw0KICAgICAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLkFMT0MgPSAiMSINCiAgICAgICAgICAgICAgSU45MSA9IHRydWUNCiAgICAgICAgICAgICAgek5ld1NUQVMgPSAiMiINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghSU45MyAmJiBjb250YWluZXJFWFQ0MDEuZ2V0KCJFWFNUQVMiKSA9PSAiMSINCiAgICAgICAgICAgICAgYXMgY2hhcikgew0KICAgICAgICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLk5CQU4gPSBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFNCQU4iKQ0KICAgICAgICAgICAgICB6Q3VyclN0YXMgPSBjb250YWluZXJFWFQ0MDEuZ2V0KCJFWFNUQVMiKS50b1N0cmluZygpDQogICAgICAgICAgICAgIHpOZXdTVEFTID0gIjEiDQogICAgICAgICAgICAgIElOOTEgPSB0cnVlDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIUlOOTMgJiYgY29udGFpbmVyRVhUNDAxLmdldCgiRVhTVEFTIikgPT0gIjEiDQogICAgICAgICAgICAgIGFzIGNoYXIpIHsNCiAgICAgICAgICAgICAgek5ld1NUQVMgPSBjb250YWluZXJFWFQ0MDEuZ2V0KCJFWFNUQVMiKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBpZiAoek5ld1NUQVMgPT0gIjkiKSB7DQogICAgICAgIHpOZXdTVEFTID0gIjIiDQogICAgICB9DQoNCiAgICAgIGxvZ2dlci5kZWJ1ZygiSU45MzogIiArIElOOTMgKyAiIHwgYWRkUmVjbGFzc0lucHV0czogIiArIGFkZFJlY2xhc3NJbnB1dHMuTkJBTiArICIgfCBiYXNlQkFOTzogIiArIGJhc2VCQU5PICsgIiB8IHp6Q3VyclN0YXM6ICIgKyB6Q3VyclN0YXMgKyAiIHwgek5ld1NUQVM6ICIgKyB6TmV3U1RBUykNCg0KICAgICAgaWYgKChJTjkzIHx8IGFkZFJlY2xhc3NJbnB1dHMuZ2V0KCJOQkFOIikgPT0gYmFzZUJBTk8pICYmIHpDdXJyU3RhcyAhPSAiMyIgJiYgek5ld1NUQVMgIT0gIjMiKSB7DQogICAgICAgIGFkZFJlY2xhc3NJbnB1dHMuUlNDRCA9ICIiDQoNCiAgICAgICAgREJBY3Rpb24gYWN0aW9uUU1TUlFIID0gZGF0YWJhc2UudGFibGUoIlFNU1JRSCIpLmluZGV4KCIzMCIpLnNlbGVjdGlvbigiUkhDT05PIiwgIlJISVROTyIsICJSSEJBTk8iLCAiUkhRU1RBIiwgIlJIUVJSUCIsICJSSFFBUFIiKS5idWlsZCgpDQogICAgICAgIERCQ29udGFpbmVyIGNvbnRhaW5lclFNU1JRSCA9IGFjdGlvblFNU1JRSC5nZXRDb250YWluZXIoKQ0KDQogICAgICAgIGNvbnRhaW5lclFNU1JRSC5zZXQoIlJIQ09OTyIsIENPTk8pDQogICAgICAgIGNvbnRhaW5lclFNU1JRSC5zZXQoIlJISVROTyIsIGlJVE5PX1JjbFByZXZMb3QpDQogICAgICAgIGNvbnRhaW5lclFNU1JRSC5zZXQoIlJIQkFOTyIsIGFkZFJlY2xhc3NJbnB1dHMuZ2V0T3JEZWZhdWx0KCJOQkFOIiwgIiIpKQ0KDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVhZGluZyBRTVNSUUggSU45MzogIiArIGNvbnRhaW5lclFNU1JRSC50b1N0cmluZygpKQ0KDQogICAgICAgIExpc3QgPCBEQkNvbnRhaW5lciA+IGFycmF5T2ZDb250YWluZXJzID0gbmV3IEFycmF5TGlzdCA8ID4gKCkNCg0KICAgICAgICBDbG9zdXJlIDwgPyA+IHJlYWRBbGxSZWNvcmRRTVNSUUggPSB7DQogICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAgICAgYXJyYXlPZkNvbnRhaW5lcnMuYWRkKHJlc3VsdENvbnRhaW5lcikNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhY3Rpb25RTVNSUUgucmVhZEFsbChjb250YWluZXJRTVNSUUgsIDMsIHJlYWRBbGxSZWNvcmRRTVNSUUgpKSB7DQogICAgICAgICAgaW50IGFycmF5U2l6ZSA9IGFycmF5T2ZDb250YWluZXJzLnNpemUoKQ0KICAgICAgICAgIGlmIChhcnJheVNpemUgPj0gMSkgew0KICAgICAgICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyID0gYXJyYXlPZkNvbnRhaW5lcnNbYXJyYXlPZkNvbnRhaW5lcnMuc2l6ZSgpIC0gMV0NCg0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJNSVRMT0NfU1RBUzogIiArIE1JVExPQ19TVEFTICsgIiB8IFFNU1JRSCByZWNvcmQgZm91bmQ6ICIgKyByZXN1bHRDb250YWluZXIudG9TdHJpbmcoKSkNCg0KICAgICAgICAgICAgaWYgKHJlc3VsdENvbnRhaW5lci5nZXRJbnQoIlJIUVNUQSIpIDwgNCAmJiByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJSSFFSUlAiKS50cmltKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgIGlmIChyZXN1bHRDb250YWluZXIuZ2V0SW50KCJSSFFBUFIiKSA9PSAyICYmIE1JVExPQ19TVEFTID09ICIxIikgew0KICAgICAgICAgICAgICAgIHpDdXJyU3RhcyA9ICIzIg0KICAgICAgICAgICAgICAgIHpOZXdTVEFTID0gIjMiDQogICAgICAgICAgICAgICAgYWRkUmVjbGFzc0lucHV0cy5OQkFOID0gYmFzZUJBTk8NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHpOZXdTVEFTID09ICIyIiAmJiByZXN1bHRDb250YWluZXIuZ2V0SW50KCJSSFFBUFIiKSA9PSAwICYmIGFkZFJlY2xhc3NJbnB1dHMuTkJBTiA9PSBiYXNlQkFOTykgew0KICAgICAgICAgICAgICB6TmV3U1RBUyA9ICIxIg0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBEQkFjdGlvbiBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBDT05PKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ1dITE8pDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCBpSVROTykNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIG9yaWdCQU5PKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgb3JpZ0NBTVUpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgICAgTGlzdCA8IExvY2tlZFJlc3VsdCA+IGxvY2tlZFJlc3VsdHNMaXN0ID0gbmV3IEFycmF5TGlzdCA8IExvY2tlZFJlc3VsdCA+ICgpDQoNCiAgICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdCAtPg0KICAgICAgICBsb2NrZWRSZXN1bHRzTGlzdC5hZGQobG9ja2VkUmVzdWx0KQ0KICAgICAgfQ0KDQogICAgICBhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCByZWFkQWxsUmVjb3JkRVhUNDAxKQ0KDQogICAgICBpZiAobG9ja2VkUmVzdWx0c0xpc3Quc2l6ZSgpID4gMCkgew0KICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0ID0gbG9ja2VkUmVzdWx0c0xpc3RbMF0NCiAgICAgICAgaWYgKGlSTVZDX1JjbFByZXZMb3QudHJpbSgpID09ICIxIikgew0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYU1RBUyIsICI5Ig0KICAgICAgICAgICAgYXMgY2hhcikNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWlSU0NEX1JjbFByZXZMb3QudHJpbSgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYUlNDRCIsIGlSU0NEX1JjbFByZXZMb3QpDQogICAgICAgIH0NCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMU1RRIiwgY29udGFpbmVyTUlUTE9DLmdldCgiTUxTVFFUIikpDQogICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTE1EVCIsIHV0aWxpdHkuY2FsbCgiRGF0ZVV0aWwiLCAiY3VycmVudERhdGVZOEFzSW50IikpDQogICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hJRCIsIHByb2dyYW0uZ2V0VXNlcigpKQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWENITk8iLCBsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpDQogICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KICAgICAgfQ0KDQogICAgICBsb2dnZXIuZGVidWcoIklOOTM6ICIgKyBJTjkzICsgIiB8IGFkZFJlY2xhc3NJbnB1dHM6ICIgKyBhZGRSZWNsYXNzSW5wdXRzLk5CQU4gKyAiIHwgYmFzZUJBTk86ICIgKyBiYXNlQkFOTyArICIgfCB6ekN1cnJTdGFzOiAiICsgekN1cnJTdGFzICsgIiB8IHpOZXdTVEFTOiAiICsgek5ld1NUQVMpDQoNCiAgICAgIGlmICh4eENoZ1N0cykgew0KICAgICAgICBhZGRSZWNsYXNzSW5wdXRzLlNUQVMgPSB6TmV3U1RBUw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgYWRkUmVjbGFzc0lucHV0cy5TVEFTID0gIjEiDQogICAgICB9DQoNCiAgICAgIGFkZFJlY2xhc3NJbnB1dHMuQUxPQyA9ICIxIg0KDQogICAgICBDbG9zdXJlIDwgPyA+IGFkZFJlY2xhc3NDYWxsYmFjayA9IHsNCiAgICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsNCiAgICAgICAgICBsb2dnZXIuZGVidWcoIk1JIEVycm9yIGFkZFJlY2xhc3NDYWxsYmFjayIpDQogICAgICAgICAgbWkuZXJyb3IocmVzcG9uc2UuZXJyb3JNZXNzYWdlLnRvU3RyaW5nKCkpDQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxXSExPIiwgYWRkUmVjbGFzc0lucHV0cy5XSExPKQ0KICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTElUTk8iLCBhZGRSZWNsYXNzSW5wdXRzLklUTk8pDQogICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MV0hTTCIsIGFkZFJlY2xhc3NJbnB1dHMuV0hTTCkNCiAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxCQU5PIiwgYWRkUmVjbGFzc0lucHV0cy5OQkFOKQ0KICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTENBTVUiLCBhZGRSZWNsYXNzSW5wdXRzLkNBTVUpDQoNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJSY2xQcmV2TG90IEZpbmFsIikNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJvcmlnQkFOTzogIiArIG9yaWdCQU5PICsgIiB8IHpOZXdTdGFzOiAiICsgek5ld1NUQVMgKyAiIHwgekN1cnJTdGFzOiAiICsgekN1cnJTdGFzICsgIiB8IHNraXBUb0Jhc2U6ICIgKyBza2lwVG9CYXNlKQ0KICAgICAgICBsb2dnZXIuZGVidWcoImNvbnRhaW5lck1JVExPQzogIiArIGNvbnRhaW5lck1JVExPQy50b1N0cmluZygpKQ0KICAgICAgfQ0KDQogICAgICBtaUNhbGxlci5jYWxsKCJNTVM4NTBNSSIsICJBZGRSZWNsYXNzIiwgYWRkUmVjbGFzc0lucHV0cywgYWRkUmVjbGFzc0NhbGxiYWNrKQ0KDQogICAgfSBlbHNlIHsNCg0KICAgICAgaWYgKGlSTVZDX1JjbFByZXZMb3QgPT0gIjEiKSB7DQogICAgICAgIERCQWN0aW9uIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMDAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMSA9IGFjdGlvbkVYVDQwMS5nZXRDb250YWluZXIoKQ0KDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PX1JjbFByZXZMb3QpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIG9yaWdCQU5PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgb3JpZ1dITE8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdXSFNMKQ0KDQogICAgICAgIENsb3N1cmUgPCA/ID4gcmVhZEFsbFJlY29yZEVYVDQwMSA9IHsNCiAgICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgIjkiDQogICAgICAgICAgICBhcyBjaGFyKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTE1EVCIsIHV0aWxpdHkuY2FsbCgiRGF0ZVV0aWwiLCAiY3VycmVudERhdGVZOEFzSW50IikpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KDQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJFbHNlIGNvbmRpdGlvbi4gUmVjb3JkIHVwZGF0ZWQiICsgY29udGFpbmVyRVhUNDAxLnRvU3RyaW5nKCkpDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIWFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpKSB7DQogICAgICAgICAgbG9nZ2VyLmRlYnVnKCJFbHNlIGNvbmRpdGlvbi4gUmVjb3JkIGRvZXMgbm90IGV4aXN0IiArIGNvbnRhaW5lckVYVDQwMS50b1N0cmluZygpKQ0KICAgICAgICAgIG1pLmVycm9yKCJSZWNvcmQgZG9lcyBub3QgZXhpc3QiKQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICB9DQoNCiAgICB9DQoNCiAgfQ0KDQogIHByaXZhdGUgdm9pZCByZWplY3RBZmZlY3RBbGxMZXZlbHMoaW50IENPTk8sIFN0cmluZyBvcmlnV0hMTywgU3RyaW5nIG9yaWdCQU5PLCBTdHJpbmcgb3JpZ0NBTVUsIFN0cmluZyBvcmlnV0hTTCwgU3RyaW5nIEVYVDQwMV9TQkFOLCBTdHJpbmcgRVhUNDAxX0JBTk8pIHsNCiAgICBTdHJpbmcgeHhUWFZSID0gIiAiICogMTANCiAgICBTdHJpbmcgeHhUWDYwID0gIiAiICogNjANCg0KICAgIGxvZ2dlci5kZWJ1ZygiVXB3YXJkcyBpbiB0aGUgSGllcmFyY2h5IikNCiAgICAvLyBDaGFuZ2UgYWxsIFN1Yi1MZXZlbHMgKFVwd2FyZHMgaW4gdGhlIEhpZXJhcmNoeSEpICYgQWRkIFRleHQgdG8gU3ViLUxvdA0KICAgIERCQWN0aW9uIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQoNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBDT05PKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIG9yaWdXSExPKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIG9yaWdCQU5PKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIG9yaWdDQU1VKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIG9yaWdXSFNMKQ0KDQogICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3JkRVhUNDAxID0gew0KICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICBjb250YWluZXJFWFQ0MDEgPSByZXN1bHRDb250YWluZXINCiAgICB9DQoNCiAgICBpZiAoYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3JkRVhUNDAxKSkgew0KDQogICAgICB4eFRYVlIgPSAiRElTUCINCiAgICAgIHh4VFg2MCA9ICJSZWogU3ViLUxvdDogIiArIG9yaWdCQU5PLnJlcGxhY2VBbGwoLyAqJC8sICcnKSArICIgQzogIiArIG9yaWdDQU1VLnJlcGxhY2VBbGwoLyAqJC8sICcnKQ0KICAgICAgYWRkRnJlZVRleHQoeHhUWFZSLCB4eFRYNjAsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYU0JBTiIpKQ0KDQogICAgICB4eFRYVlIgPSAiRElTUCINCiAgICAgIHh4VFg2MCA9ICJSZWogRnJvbSBMOiAiICsgbXlMdmxfQkFOTy5yZXBsYWNlQWxsKC8gKiQvLCAnJykgKyAiIEM6ICIgKyBvcmlnQ0FNVS5yZXBsYWNlQWxsKC8gKiQvLCAnJykNCiAgICAgIGFkZEZyZWVUZXh0KHh4VFhWUiwgeHhUWDYwLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCg0KICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIxMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCg0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgQ09OTykNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYSVROTyIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hMIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hMIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFBCQU4iLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhMV0hTIikpDQoNCiAgICAgIENsb3N1cmUgPCA/ID4gdXBkYXRlRVhUNDAxID0gew0KICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQoNCiAgICAgICAgbG9ja2VkUmVzdWx0LmFsbENvbHVtbnMuZWFjaCB7DQogICAgICAgICAgU3RyaW5nIGNvbHVtbiAtPg0KICAgICAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldChjb2x1bW4sIGxvY2tlZFJlc3VsdC5nZXQoY29sdW1uKSkNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChsb2NrZWRSZXN1bHQuZ2V0KCJFWFNUQVMiKS50b1N0cmluZygpID09ICIxIikgew0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYU1RBUyIsICIzIg0KICAgICAgICAgICAgYXMgY2hhcikNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCB1dGlsaXR5LmNhbGwoIkRhdGVVdGlsIiwgImN1cnJlbnREYXRlWThBc0ludCIpKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hJRCIsIHByb2dyYW0uZ2V0VXNlcigpKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hOTyIsIGxvY2tlZFJlc3VsdC5nZXRJbnQoIkVYQ0hOTyIpICsgMSkNCiAgICAgICAgICBsb2NrZWRSZXN1bHQudXBkYXRlKCkNCiAgICAgICAgfQ0KDQogICAgICAgIHh4VFhWUiA9ICJESVNQIg0KICAgICAgICB4eFRYNjAgPSAiUmVqIFN1Yi1Mb3Q6ICIgKyBvcmlnQkFOTy5yZXBsYWNlQWxsKC8gKiQvLCAnJykgKyAiIEM6ICIgKyBvcmlnQ0FNVS5yZXBsYWNlQWxsKC8gKiQvLCAnJykNCiAgICAgICAgYWRkRnJlZVRleHQoeHhUWFZSLCB4eFRYNjAsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYU0JBTiIpKQ0KDQogICAgICAgIHh4VFhWUiA9ICJESVNQIg0KICAgICAgICB4eFRYNjAgPSAiUmVqIEZyb20gTDogIiArIG15THZsX0JBTk8ucmVwbGFjZUFsbCgvICokLywgJycpICsgIiBDOiAiICsgb3JpZ0NBTVUucmVwbGFjZUFsbCgvICokLywgJycpDQogICAgICAgIGFkZEZyZWVUZXh0KHh4VFhWUiwgeHhUWDYwLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFNCQU4iKSkNCg0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBDT05PKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhQQkFOIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCiAgICAgIH0NCg0KICAgICAgd2hpbGUgKGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZUVYVDQwMSkpIHsNCiAgICAgICAgLy9VcGRhdGUgRVhUNDAxIGluIENsb3N1cmUNCiAgICAgIH0NCg0KICAgIH0NCg0KICAgIGxvZ2dlci5kZWJ1ZygiRG93bndhcmRzIGluIHRoZSBIaWVyYXJjaHkiKQ0KICAgIC8vIENoYW5nZSBhbGwgUHJlLUxldmVscyAoRG93bndhcmRzIGluIHRoZSBIaWVyYXJjaHkhKSAmIEFkZCBUZXh0IHRvIFN1Yi1Mb3QNCiAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgQ09OTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBvcmlnV0hMTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgIGlmIChhY3Rpb25FWFQ0MDEucmVhZEFsbChjb250YWluZXJFWFQ0MDEsIDYsIDEsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpKSB7DQoNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYUEJBTiIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhDQU1VIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCg0KICAgICAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVFWFQ0MDEgPSB7DQogICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCg0KICAgICAgICBsb2NrZWRSZXN1bHQuYWxsQ29sdW1ucy5lYWNoIHsNCiAgICAgICAgICBTdHJpbmcgY29sdW1uIC0+DQogICAgICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KGNvbHVtbiwgbG9ja2VkUmVzdWx0LmdldChjb2x1bW4pKQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGxvY2tlZFJlc3VsdC5nZXQoIkVYU1RBUyIpLnRvU3RyaW5nKCkgPT0gIjEiKSB7DQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhTVEFTIiwgIjMiDQogICAgICAgICAgICBhcyBjaGFyKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYTE1EVCIsIHV0aWxpdHkuY2FsbCgiRGF0ZVV0aWwiLCAiY3VycmVudERhdGVZOEFzSW50IikpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgbG9ja2VkUmVzdWx0LmdldEludCgiRVhDSE5PIikgKyAxKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KICAgICAgICB9DQoNCiAgICAgICAgeHhUWFZSID0gIkRJU1AiDQogICAgICAgIHh4VFg2MCA9ICJSZWogU3ViLUxvdDogIiArIG9yaWdCQU5PLnJlcGxhY2VBbGwoLyAqJC8sICcnKSArICIgQzogIiArIG9yaWdDQU1VLnJlcGxhY2VBbGwoLyAqJC8sICcnKQ0KICAgICAgICBhZGRGcmVlVGV4dCh4eFRYVlIsIHh4VFg2MCwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhTQkFOIikpDQoNCiAgICAgICAgeHhUWFZSID0gIkRJU1AiDQogICAgICAgIHh4VFg2MCA9ICJSZWogRnJvbSBMOiAiICsgbXlMdmxfQkFOTy5yZXBsYWNlQWxsKC8gKiQvLCAnJykgKyAiIEM6ICIgKyBvcmlnQ0FNVS5yZXBsYWNlQWxsKC8gKiQvLCAnJykNCiAgICAgICAgYWRkRnJlZVRleHQoeHhUWFZSLCB4eFRYNjAsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYU0JBTiIpKQ0KDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIENPTk8pDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWFBCQU4iKSkNCiAgICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgY29udGFpbmVyRVhUNDAxLmdldFN0cmluZygiRVhDQU1VIikpDQogICAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYTFdIUyIpKQ0KICAgICAgfQ0KDQogICAgICB3aGlsZSAoYWN0aW9uRVhUNDAxLnJlYWRBbGxMb2NrKGNvbnRhaW5lckVYVDQwMSwgNiwgdXBkYXRlRVhUNDAxKSkgew0KICAgICAgICAvL1VwZGF0ZSBFWFQ0MDEgaW4gQ2xvc3VyZQ0KICAgICAgfQ0KDQogICAgfQ0KDQogICAgbG9nZ2VyLmRlYnVnKCJCQVNFIExvdCIpDQogICAgLy8gQWRkIFRleHQgdG8gQkFTRSBMb3QNCiAgICBhY3Rpb25FWFQ0MDEgPSBkYXRhYmFzZS50YWJsZSgiRVhUNDAxIikuaW5kZXgoIjIwIikuc2VsZWN0QWxsRmllbGRzKCkuYnVpbGQoKQ0KDQogICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDT05PIiwgQ09OTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBvcmlnV0hMTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBvcmlnQkFOTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBvcmlnQ0FNVSkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBvcmlnV0hTTCkNCg0KICAgIGlmIChhY3Rpb25FWFQ0MDEucmVhZEFsbChjb250YWluZXJFWFQ0MDEsIDYsIDEsIHJlYWRBbGxSZWNvcmRFWFQ0MDEpKSB7DQogICAgICB4eFRYVlIgPSAiRElTUCINCiAgICAgIHh4VFg2MCA9ICJSZWogU3ViLUxvdDogIiArIG9yaWdCQU5PLnJlcGxhY2VBbGwoLyAqJC8sICcnKSArICIgQzogIiArIG9yaWdDQU1VLnJlcGxhY2VBbGwoLyAqJC8sICcnKQ0KICAgICAgYWRkRnJlZVRleHQoeHhUWFZSLCB4eFRYNjAsIGNvbnRhaW5lckVYVDQwMS5nZXRTdHJpbmcoIkVYQkFOTyIpKQ0KDQogICAgICB4eFRYVlIgPSAiRElTUCINCiAgICAgIHh4VFg2MCA9ICJSZWogRnJvbSBMOiAiICsgbXlMdmxfQkFOTy5yZXBsYWNlQWxsKC8gKiQvLCAnJykgKyAiIEM6ICIgKyBvcmlnQ0FNVS5yZXBsYWNlQWxsKC8gKiQvLCAnJykNCiAgICAgIGFkZEZyZWVUZXh0KHh4VFhWUiwgeHhUWDYwLCBjb250YWluZXJFWFQ0MDEuZ2V0U3RyaW5nKCJFWEJBTk8iKSkNCiAgICB9DQoNCiAgfQ0KDQogIHByaXZhdGUgdm9pZCBhZGRGcmVlVGV4dChTdHJpbmcgVFhWUiwgU3RyaW5nIFRYNjAsIFN0cmluZyBMb3ROdW1iZXIpIHsNCiAgICBNYXAgPCBTdHJpbmcsIFN0cmluZyA+IGFkZEZyZWVUZXh0SW5wdXRzID0gWw0KICAgICAgIklUTk8iOiBpSVROTywNCiAgICAgICJCQU5PIjogTG90TnVtYmVyLA0KICAgICAgIlRYVlIiOiBUWFZSLA0KICAgICAgIlRYNjAiOiBUWDYwDQogICAgXQ0KDQogICAgQ2xvc3VyZSA8ID8gPiBhZGRGcmVlVGV4dENhbGxiYWNrID0gew0KICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgIGlmIChyZXNwb25zZS5lcnJvcikgew0KICAgICAgICBtaS5lcnJvcihyZXNwb25zZS5lcnJvck1lc3NhZ2UudG9TdHJpbmcoKSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgfQ0KDQogICAgbWlDYWxsZXIuY2FsbCgiTU1TMjM1TUkiLCAiQWRkRnJlZVRleHQiLCBhZGRGcmVlVGV4dElucHV0cywgYWRkRnJlZVRleHRDYWxsYmFjaykNCg0KICB9DQoNCiAgcHJpdmF0ZSBzZXRCYWxhbmNlUmNsRGF0ZShTdHJpbmcgaVdITE8sIFN0cmluZyBpSVROTywgU3RyaW5nIGlXSFNMLCBTdHJpbmcgaUJBTk8pIHsNCiAgICB1cGRhdGVNSUxPTUFSZWNvcmQoaVdITE8sIGlJVE5PLCBpV0hTTCwgaUJBTk8pDQogIH0NCg0KICBwcml2YXRlIHZvaWQgdXBkYXRlTUlMT01BUmVjb3JkKFN0cmluZyBpV0hMTywgU3RyaW5nIGlJVE5PLCBTdHJpbmcgaVdIU0wsIFN0cmluZyBpQkFOTykgew0KICAgIERCQWN0aW9uIGFjdGlvbk1JTE9NQSA9IGRhdGFiYXNlLnRhYmxlKCJNSUxPTUEiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIkxNQ09OTyIsICJMTUlUTk8iLCAiTE1CQU5PIiwgIkxNUUlBRCIsICJMTVJHRFQiLCAiTE1DSE5PIiwgIkxNTE1EVCIsICJMTUNISUQiKS5idWlsZCgpDQogICAgREJDb250YWluZXIgY29udGFpbmVyTUlMT01BID0gYWN0aW9uTUlMT01BLmdldENvbnRhaW5lcigpDQoNCiAgICBjb250YWluZXJNSUxPTUEuc2V0KCJMTUNPTk8iLCBwcm9ncmFtLkxEQVpELkNPTk8gYXMgaW50KQ0KICAgIGNvbnRhaW5lck1JTE9NQS5zZXQoIkxNSVROTyIsIGlJVE5PKQ0KICAgIGNvbnRhaW5lck1JTE9NQS5zZXQoIkxNQkFOTyIsIGlCQU5PKQ0KDQogICAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVNSUxPTUEgPSB7DQogICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQoNCiAgICAgIFFJQURGcm9tTUlMT01BID0gbG9ja2VkUmVzdWx0LmdldEludCgiTE1RSUFEIikNCg0KICAgICAgaWYgKFFJQURGcm9tTUlMT01BID09IDApIHsNCiAgICAgICAgLy8gQ29weSBSR0RUIHRvIFFJQUQNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiTE1RSUFEIiwgbG9ja2VkUmVzdWx0LmdldCgiTE1SR0RUIikpDQoNCiAgICAgICAgLy8gVXBkYXRlIGNoYW5nZWQgaW5mb3JtYXRpb24NCiAgICAgICAgaW50IGNoYW5nZU51bWJlciA9IGxvY2tlZFJlc3VsdC5nZXRJbnQoIkxNQ0hOTyIpDQogICAgICAgIGludCBuZXdDaGFuZ2VOdW1iZXIgPSBjaGFuZ2VOdW1iZXIgKyAxDQoNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiTE1MTURUIiwgdXRpbGl0eS5jYWxsKCJEYXRlVXRpbCIsICJjdXJyZW50RGF0ZVk4QXNJbnQiKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiTE1DSE5PIiwgbmV3Q2hhbmdlTnVtYmVyKQ0KICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJMTUNISUQiLCBwcm9ncmFtLmdldFVzZXIoKSkNCiAgICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQoNCiAgICAgIH0gZWxzZSBpZiAoUUlBREZyb21NSUxPTUEgPiAwKSB7DQogICAgICAgIERCQWN0aW9uIGFjdGlvbk1JVExPQyA9IGRhdGFiYXNlLnRhYmxlKCJNSVRMT0MiKS5pbmRleCgiMTUiKS5zZWxlY3Rpb24oIlFJQUQiKS5idWlsZCgpDQogICAgICAgIERCQ29udGFpbmVyIGNvbnRhaW5lck1JVExPQyA9IGFjdGlvbk1JVExPQy5nZXRDb250YWluZXIoKQ0KDQogICAgICAgIGNvbnRhaW5lck1JVExPQy5zZXQoIk1MQ09OTyIsIGlDT05PLnRvSW50ZWdlcigpKQ0KICAgICAgICBjb250YWluZXJNSVRMT0Muc2V0KCJNTElUTk8iLCBpSVROTykNCiAgICAgICAgY29udGFpbmVyTUlUTE9DLnNldCgiTUxCQU5PIiwgaUJBTk8pDQoNCiAgICAgICAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVNSVRMT0MgPSB7DQogICAgICAgICAgTG9ja2VkUmVzdWx0IGxvY2tlZFJlc3VsdF9NSVRMT0MgLT4NCg0KICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUUlBRDogIiArIGxvY2tlZFJlc3VsdF9NSVRMT0MuZ2V0KCJNTFFJQUQiKSkNCiAgICAgICAgICBpZiAobG9ja2VkUmVzdWx0X01JVExPQy5nZXQoIk1MUUlBRCIpID09IDApIHsNCiAgICAgICAgICAgIC8vIENvcHkgUUlBRCB0byBRSUFEIGZyb20gTUlMT01BDQogICAgICAgICAgICBsb2NrZWRSZXN1bHRfTUlUTE9DLnNldCgiTUxRSUFEIiwgUUlBREZyb21NSUxPTUEpDQoNCiAgICAgICAgICAgIC8vIFVwZGF0ZSBjaGFuZ2VkIGluZm9ybWF0aW9uDQogICAgICAgICAgICBpbnQgY2hhbmdlTnVtYmVyID0gbG9ja2VkUmVzdWx0X01JVExPQy5nZXRJbnQoIk1MQ0hOTyIpDQogICAgICAgICAgICBpbnQgbmV3Q2hhbmdlTnVtYmVyID0gY2hhbmdlTnVtYmVyICsgMQ0KDQogICAgICAgICAgICBsb2NrZWRSZXN1bHRfTUlUTE9DLnNldCgiTUxMTURUIiwgdXRpbGl0eS5jYWxsKCJEYXRlVXRpbCIsICJjdXJyZW50RGF0ZVk4QXNJbnQiKSkNCiAgICAgICAgICAgIGxvY2tlZFJlc3VsdF9NSVRMT0Muc2V0KCJNTENITk8iLCBuZXdDaGFuZ2VOdW1iZXIpDQogICAgICAgICAgICBsb2NrZWRSZXN1bHRfTUlUTE9DLnNldCgiTUxDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgICAgICBsb2NrZWRSZXN1bHRfTUlUTE9DLnVwZGF0ZSgpDQoNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIWFjdGlvbk1JVExPQy5yZWFkQWxsTG9jayhjb250YWluZXJNSVRMT0MsIDMsIHVwZGF0ZU1JVExPQykpIHsNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCg0KICAgICAgICBsb2dnZXIuZGVidWcoIk1JIEVycm9yIENQRjk4OTgiKQ0KICAgICAgICBtaS5lcnJvcigiIiwgIkNQRjk4OTgiLCAiTG90ICIgKyBpQkFOTyArICIgbm90IGluIExvdC1NYXN0ZXIgT1IgUUkgRGF0ZSBub3Qgc2V0ISIpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KDQogICAgfQ0KDQogICAgLy8gVXBkYXRlIGNoYW5nZWQgaW5mb3JtYXRpb24NCiAgICBhY3Rpb25NSUxPTUEucmVhZExvY2soY29udGFpbmVyTUlMT01BLCB1cGRhdGVNSUxPTUEpDQoNCiAgfQ0KDQogIHByaXZhdGUgdm9pZCB1cGRhdGVTdGF0dXMoKSB7DQogICAgbG9nZ2VyLmRlYnVnKCJTdGFydGluZyB1cGRhdGVTdGF0dXMiKQ0KDQogICAgREJBY3Rpb24gYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIyMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJFWFQ0MDEgPSBhY3Rpb25FWFQ0MDEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ09OTyIsIGlDT05PLnRvSW50ZWdlcigpKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIGZyb21XSExPKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYSVROTyIsIGlJVE5PKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIGlTQkFOKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIGZyb21DQU1VKQ0KICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIGZyb21XSFNMKQ0KDQogICAgU3RyaW5nIHRvU3RhdHVzID0gIiIsIGZyb21TdGF0dXMgPSAiIg0KDQogICAgQ2xvc3VyZSA8ID8gPiByZWFkQWxsUmVjb3Jkc0VYVDQwMSA9IHsNCiAgICAgIERCQ29udGFpbmVyIHJlc3VsdENvbnRhaW5lciAtPg0KICAgICAgZnJvbVN0YXR1cyA9IHJlc3VsdENvbnRhaW5lci5nZXQoIkVYU1RBUyIpLnRvU3RyaW5nKCkudHJpbSgpDQoNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIHRvV0hMTykNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIHRvQ0FNVSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdIUyIsIHRvV0hTTCkNCg0KICAgICAgQ2xvc3VyZSA8ID8gPiB1cGRhdGVBbGxSZWNvcmRzRVhUNDAxID0gew0KICAgICAgICBMb2NrZWRSZXN1bHQgbG9ja2VkUmVzdWx0IC0+DQogICAgICAgIHRvU3RhdHVzID0gbG9ja2VkUmVzdWx0LmdldCgiRVhTVEFTIikudG9TdHJpbmcoKS50cmltKCkNCg0KICAgICAgICBsb2dnZXIuZGVidWcoImZyb21TdGF0dXM6ICIgKyBmcm9tU3RhdHVzLnRyaW0oKSArICIgfCB0b1N0YXR1czogIiArIHRvU3RhdHVzLnRyaW0oKSkNCiAgICAgICAgaWYgKCFmcm9tU3RhdHVzLnRyaW0oKS5pc0VtcHR5KCkgJiYgIXRvU3RhdHVzLnRyaW0oKS5pc0VtcHR5KCkgJiYgZnJvbVN0YXR1cy50cmltKCkgIT0gdG9TdGF0dXMudHJpbSgpKSB7DQoNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWFNUQVMiLCBbZnJvbVN0YXR1cywgdG9TdGF0dXNdLm1pbiB7DQogICAgICAgICAgICAgIGEsDQogICAgICAgICAgICAgIGIgLT4gYS5jb21wYXJlVG8oYikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGFzIGNoYXIpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhMTURUIiwgTG9jYWxEYXRlLm5vdygpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oInl5eXlNTWRkIikpLnRvSW50ZWdlcigpKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hOTyIsIChsb2NrZWRSZXN1bHQuZ2V0SW50KCJFWENITk8iKSArIDEpKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYQ0hJRCIsIHByb2dyYW0uZ2V0VXNlcigpKQ0KICAgICAgICAgIGxvY2tlZFJlc3VsdC51cGRhdGUoKQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGxvZ2dlci5kZWJ1ZygiUmVhZGluZyBFWFQ0MDEgd2l0aCB0byBsb2NhdGlvbiIpDQogICAgICBhY3Rpb25FWFQ0MDEucmVhZEFsbExvY2soY29udGFpbmVyRVhUNDAxLCA2LCB1cGRhdGVBbGxSZWNvcmRzRVhUNDAxKQ0KDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWExXSEwiKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYU0JBTiIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYUEJBTiIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhMV0hTIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWENBTVUiKSkNCiAgICB9DQoNCiAgICBsb2dnZXIuZGVidWcoIlJlYWRpbmcgRVhUNDAxIHdpdGggZnJvbSBsb2NhdGlvbiIpDQogICAgd2hpbGUgKGFjdGlvbkVYVDQwMS5yZWFkQWxsKGNvbnRhaW5lckVYVDQwMSwgNiwgMSwgcmVhZEFsbFJlY29yZHNFWFQ0MDEpKSB7DQogICAgICAvLw0KICAgIH0NCg0KICAgIGFjdGlvbkVYVDQwMSA9IGRhdGFiYXNlLnRhYmxlKCJFWFQ0MDEiKS5pbmRleCgiMjAiKS5zZWxlY3RBbGxGaWVsZHMoKS5idWlsZCgpDQogICAgY29udGFpbmVyRVhUNDAxID0gYWN0aW9uRVhUNDAxLmdldENvbnRhaW5lcigpDQoNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBpQ09OTy50b0ludGVnZXIoKSkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSEwiLCBmcm9tV0hMTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWElUTk8iLCBpSVROTykNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWFNCQU4iLCBpU0JBTikNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENBTVUiLCBmcm9tQ0FNVSkNCiAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCBmcm9tV0hTTCkNCg0KICAgIHRvU3RhdHVzID0gIiINCiAgICBmcm9tU3RhdHVzID0gIiINCg0KICAgIHJlYWRBbGxSZWNvcmRzRVhUNDAxID0gew0KICAgICAgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICBmcm9tU3RhdHVzID0gcmVzdWx0Q29udGFpbmVyLmdldCgiRVhTVEFTIikudG9TdHJpbmcoKS50cmltKCkNCg0KICAgICAgYWN0aW9uRVhUNDAxID0gZGF0YWJhc2UudGFibGUoIkVYVDQwMSIpLmluZGV4KCIxMCIpLnNlbGVjdEFsbEZpZWxkcygpLmJ1aWxkKCkNCiAgICAgIGNvbnRhaW5lckVYVDQwMSA9IGFjdGlvbkVYVDQwMS5nZXRDb250YWluZXIoKQ0KDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWENPTk8iLCBpQ09OTy50b0ludGVnZXIoKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIHRvV0hMTykNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYUEJBTiIsIHJlc3VsdENvbnRhaW5lci5nZXQoIkVYU0JBTiIpLnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhDQU1VIiwgdG9DQU1VKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhMV0hTIiwgdG9XSFNMKQ0KDQogICAgICBDbG9zdXJlIDwgPyA+IHVwZGF0ZUFsbFJlY29yZHNFWFQ0MDEgPSB7DQogICAgICAgIExvY2tlZFJlc3VsdCBsb2NrZWRSZXN1bHQgLT4NCiAgICAgICAgdG9TdGF0dXMgPSBsb2NrZWRSZXN1bHQuZ2V0KCJFWFNUQVMiKS50b1N0cmluZygpLnRyaW0oKQ0KDQogICAgICAgIGxvZ2dlci5kZWJ1ZygiZnJvbVN0YXR1czogIiArIGZyb21TdGF0dXMudHJpbSgpICsgIiB8IHRvU3RhdHVzOiAiICsgdG9TdGF0dXMudHJpbSgpKQ0KICAgICAgICBpZiAoIWZyb21TdGF0dXMudHJpbSgpLmlzRW1wdHkoKSAmJiAhdG9TdGF0dXMudHJpbSgpLmlzRW1wdHkoKSAmJiBmcm9tU3RhdHVzLnRyaW0oKSAhPSB0b1N0YXR1cy50cmltKCkpIHsNCg0KICAgICAgICAgIGxvY2tlZFJlc3VsdC5zZXQoIkVYU1RBUyIsIFtmcm9tU3RhdHVzLCB0b1N0YXR1c10ubWluIHsNCiAgICAgICAgICAgICAgYSwNCiAgICAgICAgICAgICAgYiAtPiBhLmNvbXBhcmVUbyhiKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYXMgY2hhcikNCiAgICAgICAgICBsb2NrZWRSZXN1bHQuc2V0KCJFWExNRFQiLCBMb2NhbERhdGUubm93KCkuZm9ybWF0KERhdGVUaW1lRm9ybWF0dGVyLm9mUGF0dGVybigieXl5eU1NZGQiKSkudG9JbnRlZ2VyKCkpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSE5PIiwgKGxvY2tlZFJlc3VsdC5nZXRJbnQoIkVYQ0hOTyIpICsgMSkpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnNldCgiRVhDSElEIiwgcHJvZ3JhbS5nZXRVc2VyKCkpDQogICAgICAgICAgbG9ja2VkUmVzdWx0LnVwZGF0ZSgpDQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgbG9nZ2VyLmRlYnVnKCJSZWFkaW5nIEVYVDQwMSB3aXRoIHRvIGxvY2F0aW9uIGFnYWluIikNCiAgICAgIGFjdGlvbkVYVDQwMS5yZWFkQWxsTG9jayhjb250YWluZXJFWFQ0MDEsIDYsIHVwZGF0ZUFsbFJlY29yZHNFWFQ0MDEpDQoNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYTFdITCIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYTFdITCIpKQ0KICAgICAgY29udGFpbmVyRVhUNDAxLnNldCgiRVhTQkFOIiwgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiRVhQQkFOIikpDQogICAgICBjb250YWluZXJFWFQ0MDEuc2V0KCJFWExXSFMiLCByZXN1bHRDb250YWluZXIuZ2V0U3RyaW5nKCJFWExXSFMiKSkNCiAgICAgIGNvbnRhaW5lckVYVDQwMS5zZXQoIkVYQ0FNVSIsIHJlc3VsdENvbnRhaW5lci5nZXRTdHJpbmcoIkVYQ0FNVSIpKQ0KICAgIH0NCg0KICAgIGxvZ2dlci5kZWJ1ZygiUmVhZGluZyBFWFQ0MDEgd2l0aCBmcm9tIGxvY2F0aW9uIGFnYWluIikNCiAgICB3aGlsZSAoYWN0aW9uRVhUNDAxLnJlYWRBbGwoY29udGFpbmVyRVhUNDAxLCA2LCAxLCByZWFkQWxsUmVjb3Jkc0VYVDQwMSkpIHsNCiAgICAgIC8vDQogICAgfQ0KDQogIH0NCn0="}}}