{"utilities":{},"programModules":{"EXT130MI":{"program":"EXT130MI","triggers":{},"transactions":{"AddQMSText":{"sourceUuid":"8864c38a-0360-4735-bc78-8f002fc37738","name":"AddQMSText","program":"EXT130MI","description":"Add QMS Text","active":true,"multi":false,"modified":1672339893338,"modifiedBy":"900046","outputFields":[],"inputFields":[{"name":"ITNO","description":"Item number","length":15,"mandatory":true,"type":"A"},{"name":"BANO","description":"Lot number","length":20,"mandatory":true,"type":"A"},{"name":"TXVR","description":"Text block","length":10,"mandatory":true,"type":"A"},{"name":"LNTP","description":"Line value type","length":10,"mandatory":false,"type":"A"},{"name":"TVAL","description":"Text value","length":40,"mandatory":true,"type":"A"}],"utilities":[]}},"batches":{}}},"sources":{"8864c38a-0360-4735-bc78-8f002fc37738":{"uuid":"8864c38a-0360-4735-bc78-8f002fc37738","updated":1676151419090,"updatedBy":"900107","created":1672339890139,"createdBy":"900046","apiVersion":"0.9","beVersion":"16.0.0.20221110165806","codeHash":"7B045439A0CCDEEF3F62B812F08D7D7CB3776DC0255D54BDAAD9282696D530A1","code":"LyoqDQogKiBSRUFETUUNCiAqIEFkZC9VcGRhdGUgUU1TIFNwZWNpZmljIFRleHQgcmVsYXRlZCB0byBzcGVjaWZpYyBUZXh0IEJsb2NrDQogKg0KICogTmFtZTogRVhUMTMwTUkuQWRkUU1TVGV4dA0KICogRGVzY3JpcHRpb246IEFkZC9VcGRhdGUgUU1TIFNwZWNpZmljIFRleHQgcmVsYXRlZCB0byBzcGVjaWZpYyBUZXh0IEJsb2NrDQogKiBEYXRlCSAgICAgIENoYW5nZWQgQnkgICAgICAgICAgICBEZXNjcmlwdGlvbg0KICogMjAyMjExMTAJICBBamF5ICAgICAgICAJICAgICAgICBBZGQvVXBkYXRlIFFNUyBTcGVjaWZpYyBUZXh0IHJlbGF0ZWQgdG8gc3BlY2lmaWMgVGV4dCBCbG9jaw0KICoqLw0KDQpwdWJsaWMgY2xhc3MgQWRkUU1TVGV4dCBleHRlbmRzIEV4dGVuZE0zVHJhbnNhY3Rpb24gew0KICBwcml2YXRlIGZpbmFsIE1JQVBJIG1pDQogIHByaXZhdGUgZmluYWwgTUlDYWxsZXJBUEkgbWlDYWxsZXINCiAgcHJpdmF0ZSBmaW5hbCBEYXRhYmFzZUFQSSBkYXRhYmFzZQ0KICBwcml2YXRlIGZpbmFsIExvZ2dlckFQSSBsb2dnZXINCiAgcHJpdmF0ZSBmaW5hbCBQcm9ncmFtQVBJIHByb2dyYW0NCiAgcHJpdmF0ZSBmaW5hbCBVdGlsaXR5QVBJIHV0aWxpdHkNCg0KICAvL0lucHV0IGZpZWxkcw0KICBwcml2YXRlIFN0cmluZyBpSVROTw0KICBwcml2YXRlIFN0cmluZyBpQkFOTw0KICBwcml2YXRlIFN0cmluZyBpVFhWUg0KICBwcml2YXRlIFN0cmluZyBpTE5UUA0KICBwcml2YXRlIFN0cmluZyBpVFZBTA0KDQogIHByaXZhdGUgaW50IENPTk8NCiAgcHJpdmF0ZSBTdHJpbmcgUFJGWA0KICBwcml2YXRlIGxvbmcgVFhJRA0KDQoNCiAgcHVibGljIEFkZFFNU1RleHQoTUlBUEkgbWksIE1JQ2FsbGVyQVBJIG1pQ2FsbGVyLCBEYXRhYmFzZUFQSSBkYXRhYmFzZSwgTG9nZ2VyQVBJIGxvZ2dlciwgUHJvZ3JhbUFQSSBwcm9ncmFtLCBVdGlsaXR5QVBJIHV0aWxpdHkpIHsNCiAgICB0aGlzLm1pID0gbWkNCiAgICB0aGlzLm1pQ2FsbGVyID0gbWlDYWxsZXINCiAgICB0aGlzLmRhdGFiYXNlID0gZGF0YWJhc2UNCiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcg0KICAgIHRoaXMucHJvZ3JhbSA9IHByb2dyYW0NCiAgICB0aGlzLnV0aWxpdHkgPSB1dGlsaXR5DQogIH0NCg0KICAvKioNCiAgICogTWFpbiBtZXRob2QNCiAgICogQHBhcmFtDQogICAqIEByZXR1cm4NCiAgICovDQogIHB1YmxpYyB2b2lkIG1haW4oKSB7DQogICAgLy8gSW5pdGlhbGl6ZSBpbnB1dCBmaWVsZHMNCiAgICBpSVROTyA9IG1pLmluRGF0YS5nZXQoIklUTk8iKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIklUTk8iKS50cmltKCkgPT0gIj8iID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJJVE5PIikudHJpbSgpDQogICAgaUJBTk8gPSBtaS5pbkRhdGEuZ2V0KCJCQU5PIikgPT0gbnVsbCB8fCBtaS5pbkRhdGEuZ2V0KCJCQU5PIikudHJpbSgpID09ICI/IiA/ICIiIDogbWkuaW5EYXRhLmdldCgiQkFOTyIpLnRyaW0oKQ0KICAgIGlUWFZSID0gbWkuaW5EYXRhLmdldCgiVFhWUiIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiVFhWUiIpLnRyaW0oKSA9PSAiPyIgPyAiIiA6IG1pLmluRGF0YS5nZXQoIlRYVlIiKS50cmltKCkNCiAgICBpTE5UUCA9IG1pLmluRGF0YS5nZXQoIkxOVFAiKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIkxOVFAiKS50cmltKCkgPT0gIj8iID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJMTlRQIikudHJpbSgpDQogICAgaVRWQUwgPSBtaS5pbkRhdGEuZ2V0KCJUVkFMIikgPT0gbnVsbCB8fCBtaS5pbkRhdGEuZ2V0KCJUVkFMIikudHJpbSgpID09ICI/IiA/ICIiIDogbWkuaW5EYXRhLmdldCgiVFZBTCIpLnRyaW0oKQ0KDQogICAgQ09OTyA9IHByb2dyYW0uTERBWkQuZ2V0KCJDT05PIikgYXMgaW50DQoNCiAgICBsb2dnZXIuZGVidWcoIkNuZlRhZyBBUEkgY2FsbGVkIHdpdGggSW5wdXRzOiBpSVROTzogIiArIGlJVE5PLnRyaW0oKSArICIgLS0gaUJBTk86ICIgKyBpQkFOTy50cmltKCkgKyAiIC0tIGlUWFZSOiAiICsgaVRYVlIgKyAiIC0tIGlMTlRQOiAiICsgaUxOVFAgKyAiIC0tIGlUVkFMOiAiICsgaVRWQUwpDQoNCiAgICBpZiAoIXZhbGlkYXRlSXRlbShpSVROTykgfHwgIXZhbGlkYXRlSXRlbUxvdChpSVROTywgaUJBTk8pKSB7DQogICAgICBsb2dnZXIuZGVidWcoIkludmFsaWQgSVROTy9CQU5PIikNCiAgICB9IGVsc2Ugew0KICAgICAgZGVmIFBSRlhNYXAgPSBbIlFDTEFJTSI6IFsiU0NBUiI6ICJTQ0FSICM6ICIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDTE5PIjogIkNMQUlNICM6ICJdLA0KICAgICAgICAgICAgICAgICAgICAgIkZPIiAgICA6IFsiRk9JRCI6ICJGTyBJRCAjOiAiLCAiQ09OVEFNIjogIiMgQ29udGFtaW5hbnRzOiAiXSwNCiAgICAgICAgICAgICAgICAgICAgICJSRUNBTEwiOiBbIkRBVEVJRCI6ICJSRUNBTEwgREFURS9JRCA6ICJdLF0NCiAgICAgIGlmIChQUkZYTWFwLmNvbnRhaW5zS2V5KGlUWFZSKSAmJiBQUkZYTWFwLmdldChpVFhWUikuY29udGFpbnNLZXkoaUxOVFApKSB7DQogICAgICAgIFBSRlggPSBQUkZYTWFwLmdldChpVFhWUikuZ2V0KGlMTlRQKQ0KICAgICAgICBpVFZBTCA9IFBSRlggKyBpVFZBTA0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbWkuZXJyb3IoIkNvcnJlY3QgVGV4dC1CbG9jayBhbmQvb3IgVHlwZSBub3QgcHJvdmlkZWQiKQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIGlmIChUWElEID09IDApIHsNCiAgICAgICAgVFhJRCA9IHJ0dk5ld1RleHRJRCgpDQogICAgICAgIGlmIChUWElEID09IDApIHsNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXNldFRleHRJRChDT05PIGFzIFN0cmluZywgVFhJRCwgaUlUTk8sIGlCQU5PKSkgew0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICB9DQogICAgICBzbHRUeHRCbG9jayhDT05PIGFzIFN0cmluZywgVFhJRCkNCiAgICB9DQogIH0NCiAgLyoqDQogICAqIFZhbGlkYXRlcyBhbiBpdGVtIGJhc2VkIG9uIHRoZSBnaXZlbiBpdGVtIG51bWJlciAoSVROTykuDQogICAqIEBwYXJhbSBJVE5PIHRoZSBpdGVtIG51bWJlciB0byBiZSB2YWxpZGF0ZWQNCiAgICogQHJldHVybiBhIGJvb2xlYW4gdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBpdGVtIG51bWJlciBleGlzdHMgb3Igbm90DQogICAqLw0KICBwdWJsaWMgYm9vbGVhbiB2YWxpZGF0ZUl0ZW0oU3RyaW5nIElUTk8pIHsNCiAgICBEQkFjdGlvbiBhY3Rpb25NSVRNQVMgPSBkYXRhYmFzZS50YWJsZSgiTUlUTUFTIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJNTUNPTk8iKS5idWlsZCgpDQogICAgREJDb250YWluZXIgY29udGFpbmVyTUlUTUFTID0gYWN0aW9uTUlUTUFTLmdldENvbnRhaW5lcigpDQoNCiAgICBjb250YWluZXJNSVRNQVMuc2V0KCJNTUNPTk8iLCBDT05PKQ0KICAgIGNvbnRhaW5lck1JVE1BUy5zZXQoIk1NSVROTyIsIElUTk8pDQoNCiAgICBpZiAoIWFjdGlvbk1JVE1BUy5yZWFkKGNvbnRhaW5lck1JVE1BUykpIHsNCiAgICAgIGxvZ2dlci5kZWJ1ZygiSXRlbSBkb2VzIG5vdCBleGlzdCIpDQogICAgICBtaS5lcnJvcigiSXRlbSBkb2VzIG5vdCBleGlzdCIpDQogICAgICByZXR1cm4gZmFsc2UNCiAgICB9IGVsc2Ugew0KICAgICAgbG9nZ2VyLmRlYnVnKCJJdGVtIGV4aXN0cyIpDQogICAgICByZXR1cm4gdHJ1ZQ0KICAgIH0NCiAgfQ0KDQoNCiAgLyoqDQogICAqIENoZWNrIGlmIHRoZSBnaXZlbiBpdGVtIGFuZCBsb3QgY29tYmluYXRpb24gZXhpc3RzIGluIHRoZSBNSUxPTUEgdGFibGUuDQogICAqIEBwYXJhbSBJVE5PIFRoZSBpdGVtIG51bWJlci4NCiAgICogQHBhcmFtIEJBTk8gVGhlIGJhdGNoIG51bWJlci4NCiAgICogQHJldHVybiBBIGJvb2xlYW4gdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBpdGVtL2xvdCBjb21iaW5hdGlvbiBleGlzdHMgaW4gdGhlIGRhdGFiYXNlLg0KICAgKi8NCiAgcHVibGljIGJvb2xlYW4gdmFsaWRhdGVJdGVtTG90KFN0cmluZyBJVE5PLCBTdHJpbmcgQkFOTykgew0KICAgIERCQWN0aW9uIGFjdGlvbk1JTE9NQSA9IGRhdGFiYXNlLnRhYmxlKCJNSUxPTUEiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIkxNVFhJRCIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJNSUxPTUEgPSBhY3Rpb25NSUxPTUEuZ2V0Q29udGFpbmVyKCkNCg0KICAgIGNvbnRhaW5lck1JTE9NQS5zZXQoIkxNQ09OTyIsIENPTk8pDQogICAgY29udGFpbmVyTUlMT01BLnNldCgiTE1JVE5PIiwgSVROTykNCiAgICBjb250YWluZXJNSUxPTUEuc2V0KCJMTUJBTk8iLCBCQU5PKQ0KDQogICAgaWYgKCFhY3Rpb25NSUxPTUEucmVhZChjb250YWluZXJNSUxPTUEpKSB7DQogICAgICBsb2dnZXIuZGVidWcoIkl0ZW0vTG90IGRvZXMgbm90IGV4aXN0IikNCiAgICAgIG1pLmVycm9yKCJJdGVtL0xvdCBkb2VzIG5vdCBleGlzdCIpDQogICAgICByZXR1cm4gZmFsc2UNCiAgICB9IGVsc2Ugew0KICAgICAgVFhJRCA9IGNvbnRhaW5lck1JTE9NQS5nZXRMb25nKCJMTVRYSUQiKQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJJdGVtL0xvdCBleGlzdHMuIFRYSUQ6ICIgKyBUWElEKQ0KICAgICAgcmV0dXJuIHRydWUNCiAgICB9DQogIH0NCg0KDQogIC8qKg0KICAgKiBSZXRyaWV2ZXMgYSBuZXcgdGV4dCBJRC4NCiAgICogQHJldHVybiBhIGxvbmcgdmFsdWUgcmVwcmVzZW50aW5nIHRoZSBuZXcgdGV4dCBJRA0KICAgKi8NCiAgcHVibGljIGxvbmcgcnR2TmV3VGV4dElEKCkgew0KICAgIGRlZiBwYXJhbXMgPSBbIkNPTk8iOiBDT05PIGFzIFN0cmluZywgIkZJTEUiOiAiTVNZVFhIIl0NCiAgICBsb25nIFRYSUQgPSAwDQoNCiAgICBkZWYgY2FsbGJhY2sgPSB7IE1hcDxTdHJpbmcsIFN0cmluZz4gb3V0IC0+DQogICAgICAvLyBDaGVja2luZyBpZiB0aGVyZSBpcyBhbnkgZXJyb3IgaW4gdGhlIHJlc3BvbnNlDQogICAgICBpZiAob3V0LmVycm9yICE9IG51bGwpIHsNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJFcnJvciB3aGlsZSByZXRyaWV2aW5nIG5ldyB0ZXh0IElEOiAiICsgb3V0LmVycm9yTWVzc2FnZSkNCiAgICAgICAgbWkuZXJyb3Iob3V0LmVycm9yTWVzc2FnZSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICAvLyBJZiB0aGVyZSBpcyBubyBlcnJvciwgcmV0cmlldmUgdGhlIHRleHQgSUQgZnJvbSB0aGUgcmVzcG9uc2UgYW5kIHN0b3JlIGl0IGluIHRoZSBUWElEIHZhcmlhYmxlDQogICAgICBUWElEID0gb3V0LmdldCgiVFhJRCIpLnRvTG9uZygpDQogICAgICBsb2dnZXIuZGVidWcoIlN1Y2Nlc3NmdWxseSByZXRyaWV2ZWQgbmV3IHRleHQgSUQ6ICIgKyBUWElEKQ0KICAgIH0NCiAgICBsb2dnZXIuZGVidWcoIkNSUzk4ME1JLlJ0dk5ld1RleHRJRCBBUEkgY2FsbGVkIHdpdGggcGFyYW1zOiAke3BhcmFtc30iKQ0KICAgIG1pQ2FsbGVyLmNhbGwoIkNSUzk4ME1JIiwgIlJ0dk5ld1RleHRJRCIsIHBhcmFtcywgY2FsbGJhY2spDQogICAgcmV0dXJuIFRYSUQNCiAgfQ0KDQoNCiAgLyoqDQogICAqIFNldHMgdGhlIGdpdmVuIHRleHQgaWRlbnRpZmllciAoVFhJRCkgdG8gdGhlIHNwZWNpZmllZCBpdGVtIGFuZCBsb3QgY29tYmluYXRpb24uDQogICAqIEBwYXJhbSBDT05PIFRoZSBjb21wYW55IG51bWJlcg0KICAgKiBAcGFyYW0gVFhJRCBUaGUgdGV4dCBpZGVudGlmaWVyIHRvIGJlIHNldA0KICAgKiBAcGFyYW0gSVROTyBUaGUgaXRlbSBudW1iZXINCiAgICogQHBhcmFtIEJBTk8gVGhlIGxvdCBudW1iZXINCiAgICogQHJldHVybiBBIGJvb2xlYW4gdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBzZXR0aW5nIG9mIHRoZSB0ZXh0IGlkZW50aWZpZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAqLw0KICBwdWJsaWMgYm9vbGVhbiBzZXRUZXh0SUQoU3RyaW5nIENPTk8sIGxvbmcgVFhJRCwgU3RyaW5nIElUTk8sIFN0cmluZyBCQU5PKSB7DQogICAgZGVmIHBhcmFtcyA9IFsiRklMRSI6ICJNSUxPTUEwMCIsDQogICAgICAgICAgICAgICAgICAiVFhJRCI6IFRYSUQudG9TdHJpbmcoKSwNCiAgICAgICAgICAgICAgICAgICJLVjAxIjogQ09OTywNCiAgICAgICAgICAgICAgICAgICJLVjAyIjogSVROTywNCiAgICAgICAgICAgICAgICAgICJLVjAzIjogQkFOT10NCiAgICBib29sZWFuIGlzQVBJU3VjY2Vzc2Z1bCA9IGZhbHNlDQogICAgZGVmIGNhbGxiYWNrID0geyBNYXA8U3RyaW5nLCBTdHJpbmc+IG91dCAtPg0KICAgICAgLy8gQ2hlY2tpbmcgaWYgdGhlcmUgaXMgYW55IGVycm9yIGluIHRoZSByZXNwb25zZQ0KICAgICAgaWYgKG91dC5lcnJvciAhPSBudWxsKSB7DQogICAgICAgIGxvZ2dlci5kZWJ1ZygiRXJyb3Igd2hpbGUgc2V0dGluZyB0ZXh0IElEOiAiICsgb3V0LmVycm9yTWVzc2FnZSkNCiAgICAgICAgbWkuZXJyb3Iob3V0LmVycm9yTWVzc2FnZSkNCiAgICAgICAgaXNBUElTdWNjZXNzZnVsID0gZmFsc2UNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICAvLyBJZiB0aGVyZSBpcyBubyBlcnJvciwgcmV0dXJuIHRydWUNCiAgICAgIGlzQVBJU3VjY2Vzc2Z1bCA9IHRydWUNCiAgICB9DQogICAgbG9nZ2VyLmRlYnVnKCJDUlM5ODBNSS5TZXRUZXh0SUQgQVBJIGNhbGxlZCB3aXRoIHBhcmFtczogJHtwYXJhbXN9IikNCiAgICBtaUNhbGxlci5jYWxsKCJDUlM5ODBNSSIsICJTZXRUZXh0SUQiLCBwYXJhbXMsIGNhbGxiYWNrKQ0KICAgIHJldHVybiBpc0FQSVN1Y2Nlc3NmdWwNCiAgfQ0KDQoNCiAgLyoqDQogICAqIFJldHJpZXZlcyBhIHRleHQgYmxvY2sgZnJvbSB0aGUgZGF0YWJhc2UgdXNpbmcgdGhlIENSUzk4ME1JICJTbHRUeHRCbG9jayIgQVBJLg0KICAgKiBAcGFyYW0gQ09OTyBUaGUgY29tcGFueSBudW1iZXINCiAgICogQHBhcmFtIFRYSUQgVGhlIHRleHQgaWRlbnRpZmllcg0KICAgKi8NCiAgcHVibGljIHZvaWQgc2x0VHh0QmxvY2soU3RyaW5nIENPTk8sIGxvbmcgVFhJRCkgew0KICAgIGRlZiBwYXJhbXMgPSBbIkNPTk8iOiBDT05PLA0KICAgICAgICAgICAgICAgICAgIlRYSUQiOiBUWElELnRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAiVFhWUiI6IGlUWFZSLA0KICAgICAgICAgICAgICAgICAgIlRGSUwiOiAiTVNZVFhIIiwNCiAgICAgICAgICAgICAgICAgICJGSUxFIjogIk1JTE9NQTAwIl0NCiAgICBib29sZWFuIGlzQVBJU3VjY2Vzc2Z1bCA9IGZhbHNlDQoNCiAgICBkZWYgY2FsbGJhY2sgPSB7IE1hcDxTdHJpbmcsIFN0cmluZz4gb3V0IC0+DQogICAgICAvLyBDaGVja2luZyBpZiB0aGVyZSBpcyBhbnkgZXJyb3IgaW4gdGhlIHJlc3BvbnNlDQogICAgICBpZiAob3V0LmVycm9yICE9IG51bGwpIHsNCiAgICAgICAgaXNBUElTdWNjZXNzZnVsID0gZmFsc2UNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlzQVBJU3VjY2Vzc2Z1bCA9IHRydWUNCiAgICAgIH0NCiAgICB9DQogICAgbG9nZ2VyLmRlYnVnKCJDUlM5ODBNSS5TbHRUeHRCbG9jayBBUEkgd2FzIGNhbGxlZCB3aXRoIHBhcmFtczogJHtwYXJhbXN9IikNCiAgICBtaUNhbGxlci5jYWxsKCJDUlM5ODBNSSIsICJTbHRUeHRCbG9jayIsIHBhcmFtcywgY2FsbGJhY2spDQoNCiAgICAvLyBJZiB0aGUgQVBJIGNhbGwgaXMgdW5zdWNjZXNzZnVsLCBjcmVhdGUgYSBuZXcgdGV4dCBibG9jaw0KICAgIGlmICghaXNBUElTdWNjZXNzZnVsKSB7DQogICAgICBsb2dnZXIuZGVidWcoIkFQSSBjYWxsIHRvIENSUzk4ME1JIHdpdGggbWV0aG9kIFNsdFR4dEJsb2NrIHdhcyB1bnN1Y2Nlc3NmdWwsIGNyZWF0aW5nIGEgbmV3IHRleHQgYmxvY2siKQ0KICAgICAgYWRkVGV4dEJsb2NrSGVhZChDT05PLCBUWElELCBpSVROTykNCg0KICAgICAgLy8gSWYgdGhlIHZhbHVlIG9mIGlMTlRQIGlzIG9uZSBvZiB0aGUgc3BlY2lmaWVkIHZhbHVlcywgdXNlIFVwZGF0ZVFNU1RleHRMaW5lIHRvIHVwZGF0ZSB0aGUgdGV4dCBibG9jaw0KICAgICAgaWYgKFsiU0NBUiIsICJDTE5PIiwgIkZPSUQiLCAiQ09OVEFNIiwgIkRBVEVJRCJdLmNvbnRhaW5zKGlMTlRQKSkgew0KICAgICAgICBsb2dnZXIuZGVidWcoImlMTlRQIHZhbHVlIGlzIG9uZSBvZiB0aGUgc3BlY2lmaWVkIHZhbHVlcywgdXBkYXRpbmcgdGV4dCBibG9jayB3aXRoIFVwZGF0ZVFNU1RleHRMaW5lIikNCiAgICAgICAgVXBkYXRlUU1TVGV4dExpbmUoVFhJRCwgaUxOVFAsIGlUVkFMKQ0KICAgICAgICAvLyBPdGhlcndpc2UsIHVzZSBhZGRUeHRCbG9ja0xpbmUgdG8gdXBkYXRlIHRoZSB0ZXh0IGJsb2NrDQogICAgICB9IGVsc2Ugew0KICAgICAgICBsb2dnZXIuZGVidWcoImlMTlRQIHZhbHVlIGlzIG5vdCBvbmUgb2YgdGhlIHNwZWNpZmllZCB2YWx1ZXMsIHVwZGF0aW5nIHRleHQgYmxvY2sgd2l0aCBhZGRUeHRCbG9ja0xpbmUiKQ0KICAgICAgICBhZGRUeHRCbG9ja0xpbmUoVFhJRCwgaVRWQUwpDQogICAgICB9DQogICAgICAvLyBJZiB0aGUgQVBJIGNhbGwgaXMgc3VjY2Vzc2Z1bCwgdXBkYXRlIHRoZSBleGlzdGluZyB0ZXh0IGJsb2NrDQogICAgfSBlbHNlIHsNCiAgICAgIGxvZ2dlci5kZWJ1ZygiQVBJIGNhbGwgdG8gQ1JTOTgwTUkgd2l0aCBtZXRob2QgU2x0VHh0QmxvY2sgd2FzIHN1Y2Nlc3NmdWwsIHVwZGF0aW5nIHRoZSBleGlzdGluZyB0ZXh0IGJsb2NrIHdpdGggVXBkYXRlUU1TVGV4dExpbmUiKQ0KICAgICAgVXBkYXRlUU1TVGV4dExpbmUoVFhJRCwgaUxOVFAsIGlUVkFMKQ0KICAgIH0NCg0KICB9DQoNCg0KICAvKioNCiAgICogQWRkcyBhIHRleHQgYmxvY2sgaGVhZGVyIGluIHRoZSBkYXRhYmFzZSBmb3IgYSBnaXZlbiBpdGVtIGFuZCBsb3QgbnVtYmVyDQogICAqIEBwYXJhbSBDT05PIFRoZSBjb21wYW55IG51bWJlcg0KICAgKiBAcGFyYW0gVFhJRCBUaGUgdGV4dCBpZA0KICAgKiBAcGFyYW0gSVROTyBUaGUgaXRlbSBudW1iZXINCiAgICogQHJldHVybiBpc0FQSVN1Y2Nlc3NmdWwgYSBib29sZWFuIHZhbHVlIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgdGhlIEFQSSBjYWxsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdA0KICAgKi8NCiAgcHVibGljIGJvb2xlYW4gYWRkVGV4dEJsb2NrSGVhZChTdHJpbmcgQ09OTywgbG9uZyBUWElELCBTdHJpbmcgSVROTykgew0KICAgIGRlZiBwYXJhbXMgPSBbIkNPTk8iOiBDT05PLA0KICAgICAgICAgICAgICAgICAgIlRYSUQiOiBUWElELnRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAiVFhWUiI6IGlUWFZSLA0KICAgICAgICAgICAgICAgICAgIkZJTEUiOiAiTUlMT01BMDAiLA0KICAgICAgICAgICAgICAgICAgIktGTEQiOiBJVE5PLA0KICAgICAgICAgICAgICAgICAgIlVTSUQiOiBwcm9ncmFtLmdldFVzZXIoKSwNCiAgICAgICAgICAgICAgICAgICJURklMIjogIk1TWVRYSCJdDQogICAgYm9vbGVhbiBpc0FQSVN1Y2Nlc3NmdWwgPSBmYWxzZQ0KDQogICAgZGVmIGNhbGxiYWNrID0geyBNYXA8U3RyaW5nLCBTdHJpbmc+IG91dCAtPg0KDQogICAgICAvLyBDaGVja2luZyBpZiB0aGVyZSBpcyBhbnkgZXJyb3IgaW4gdGhlIHJlc3BvbnNlDQogICAgICBpZiAob3V0LmVycm9yICE9IG51bGwpIHsNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJFcnJvciBvY2N1cnJlZCB3aGlsZSBhZGRpbmcgdGV4dCBibG9jayBoZWFkOiAke291dC5lcnJvck1lc3NhZ2V9IikNCiAgICAgICAgbWkuZXJyb3Iob3V0LmVycm9yTWVzc2FnZSkNCiAgICAgICAgaXNBUElTdWNjZXNzZnVsID0gZmFsc2UNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQoNCiAgICAgIC8vIElmIHRoZXJlIGlzIG5vIGVycm9yLCByZXR1cm4gdHJ1ZQ0KICAgICAgaXNBUElTdWNjZXNzZnVsID0gdHJ1ZQ0KICAgIH0NCg0KICAgIGxvZ2dlci5kZWJ1ZygiQ2FsbGluZyBDUlM5ODBNSSBBZGRUeHRCbG9ja0hlYWQgd2l0aCBwYXJhbWV0ZXJzOiAiICsgcGFyYW1zLnRvU3RyaW5nKCkpDQogICAgbWlDYWxsZXIuY2FsbCgiQ1JTOTgwTUkiLCAiQWRkVHh0QmxvY2tIZWFkIiwgcGFyYW1zLCBjYWxsYmFjaykNCiAgICByZXR1cm4gaXNBUElTdWNjZXNzZnVsDQogIH0NCg0KICAvKioNCiAgICogVGhpcyBtZXRob2QgdXBkYXRlcyB0aGUgcXVhbGl0eSBtYW5hZ2VtZW50IHRleHQgbGluZSB3aXRoIHRoZSBnaXZlbiB0ZXh0IHZhbHVlLg0KICAgKiBAcGFyYW0gVFhJRCBUaGUgdGV4dCBpZGVudGlmaWVyDQogICAqIEBwYXJhbSBMTlRQIFRoZSBsaW5lIHR5cGUNCiAgICogQHBhcmFtIFRWQUwgVGhlIHRleHQgdmFsdWUNCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSB1cGRhdGUgd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQ0KICAgKi8NCiAgcHVibGljIGJvb2xlYW4gVXBkYXRlUU1TVGV4dExpbmUobG9uZyBUWElELCBTdHJpbmcgTE5UUCwgU3RyaW5nIFRWQUwpIHsNCg0KICAgIERCQWN0aW9uIGFjdGlvbk1TWVRYTCA9IGRhdGFiYXNlLnRhYmxlKCJNU1lUWEwiKS5pbmRleCgiMDAiKS5zZWxlY3Rpb24oIlRMVFg2MCIsICJUTExJTk8iKS5idWlsZCgpDQogICAgREJDb250YWluZXIgY29udGFpbmVyTVNZVFhMID0gYWN0aW9uTVNZVFhMLmdldENvbnRhaW5lcigpDQoNCiAgICAvLyBTZXQgdGhlIHZhbHVlcyBvZiB0aGUgY29udGFpbmVyIHRvIHRoZSBnaXZlbiBwYXJhbWV0ZXJzDQogICAgY29udGFpbmVyTVNZVFhMLnNldCgiVExDT05PIiwgQ09OTy50b0ludGVnZXIoKSkNCiAgICBjb250YWluZXJNU1lUWEwuc2V0KCJUTFRYSUQiLCBUWElEKQ0KICAgIGNvbnRhaW5lck1TWVRYTC5zZXQoIlRMVFhWUiIsIGlUWFZSKQ0KDQogICAgaW50IExJTk8gPSAtMQ0KDQogICAgLy8gQ3JlYXRlIGEgY2xvc3VyZSB0byByZWFkIGFsbCByZWNvcmRzIGluIE1TWVRYTA0KICAgIENsb3N1cmU8Pz4gcmVhZEFsbFJlY29yZE1TWVRYTCA9IHsgREJDb250YWluZXIgcmVzdWx0Q29udGFpbmVyIC0+DQogICAgICAvLyBDaGVjayBpZiB0aGUgbGluZSBzdGFydHMgd2l0aCB0aGUgZ2l2ZW4gcHJlZml4IGFuZCBpZiBzbywgc2V0IHRoZSBsaW5lIG51bWJlcg0KICAgICAgaWYgKCFQUkZYLnRyaW0oKS5pc0VtcHR5KCkgJiYgcmVzdWx0Q29udGFpbmVyLmdldFN0cmluZygiVExUWDYwIikudHJpbSgpLnN0YXJ0c1dpdGgoUFJGWCkpIHsNCiAgICAgICAgTElOTyA9IHJlc3VsdENvbnRhaW5lci5nZXRJbnQoIlRMTElOTyIpDQogICAgICB9DQogICAgfQ0KDQogICAgbG9nZ2VyLmRlYnVnKCJTdGFydGluZyB0byByZWFkIGFsbCByZWNvcmRzIGluIE1TWVRYTCB3aXRoIFRYSUQ6ICIgKyBUWElEKQ0KICAgIC8vIFJlYWQgYWxsIHRoZSByZWNvcmRzIGluIE1TWVRYTA0KICAgIGlmICghYWN0aW9uTVNZVFhMLnJlYWRBbGwoY29udGFpbmVyTVNZVFhMLCAzLCByZWFkQWxsUmVjb3JkTVNZVFhMKSkgew0KICAgICAgbWkuZXJyb3IoIlJlY29yZCBkb2VzIG5vdCBleGlzdCIpDQogICAgICBsb2dnZXIuZGVidWcoIlJlY29yZCBkb2VzIG5vdCBleGlzdCBpbiBNU1lUWEwgZm9yIFRYSUQ6ICIgKyBUWElEKQ0KICAgICAgcmV0dXJuIGZhbHNlDQogICAgfQ0KICAgIGxvZ2dlci5kZWJ1ZygiU3VjY2Vzc2Z1bGx5IHJlYWQgYWxsIHJlY29yZHMgaW4gTVNZVFhMIHdpdGggVFhJRDogIiArIFRYSUQpDQoNCiAgICAvLyBJZiB0aGUgbGluZSBudW1iZXIgaXMgZ3JlYXRlciB0aGFuIC0xLCB1cGRhdGUgdGhlIHRleHQgYmxvY2sgbGluZSB3aXRoIHRoZSBnaXZlbiB0ZXh0IHZhbHVlDQogICAgaWYgKExJTk8gPiAtMSkgew0KICAgICAgbG9nZ2VyLmRlYnVnKCJVcGRhdGluZyB0ZXh0IGJsb2NrIGxpbmUgaW4gTVNZVFhIIHdpdGggVFhJRDogIiArIFRYSUQgKyAiIGFuZCBMSU5POiAiICsgTElOTyArICIgd2l0aCB2YWx1ZTogIiArIFRWQUwpDQogICAgICBpZiAoIXVwZFR4dEJsb2NrTGluZShUWElELCBMSU5PLCBUVkFMKSkgew0KICAgICAgICBsb2dnZXIuZGVidWcoIkVycm9yIHVwZGF0aW5nIHRleHQgYmxvY2sgbGluZSBpbiBNU1lUWEggd2l0aCBUWElEOiAiICsgVFhJRCArICIgYW5kIExJTk86ICIgKyBMSU5PKQ0KICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgIH0NCiAgICAgIGxvZ2dlci5kZWJ1ZygiU3VjY2Vzc2Z1bGx5IHVwZGF0ZWQgdGV4dCBibG9jayBsaW5lIGluIE1TWVRYSCB3aXRoIFRYSUQ6ICIgKyBUWElEICsgIiBhbmQgTElOTzogIiArIExJTk8pDQogICAgfSBlbHNlIHsNCiAgICAgIC8vIElmIHRoZSBsaW5lIG51bWJlciBpcyBub3QgZm91bmQsIGFkZCBhIG5ldyB0ZXh0IGJsb2NrIGxpbmUgd2l0aCB0aGUgZ2l2ZW4gdGV4dCB2YWx1ZQ0KICAgICAgaWYgKCFhZGRUeHRCbG9ja0xpbmUoVFhJRCwgVFZBTCkpIHsNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJBZGRpbmcgbmV3IHRleHQgYmxvY2sgbGluZSBpbiBNU1lUWEggd2l0aCBUWElEOiAiICsgVFhJRCArICIgYW5kIHZhbHVlOiAiICsgVFZBTCkNCiAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICB9DQogICAgICBsb2dnZXIuZGVidWcoIlN1Y2Nlc3NmdWxseSBhZGRlZCBuZXcgdGV4dCBibG9jayBsaW5lIGluIE1TWVRYSCB3aXRoIFRYSUQ6ICIgKyBUWElEKQ0KICAgIH0NCg0KICAgIC8vIFJldHVybiB0cnVlIGlmIHRoZSB1cGRhdGUgd2FzIHN1Y2Nlc3NmdWwNCiAgICByZXR1cm4gdHJ1ZQ0KICB9DQoNCiAgLyoqDQogICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byB1cGRhdGUgYSB0ZXh0IGJsb2NrIGxpbmUgaW4gdGhlIGRhdGFiYXNlDQogICAqIEBwYXJhbSBUWElEIFRoZSB0ZXh0IGlkZW50aWZpZXINCiAgICogQHBhcmFtIExJTk8gVGhlIGxpbmUgbnVtYmVyDQogICAqIEBwYXJhbSBUWDYwIFRoZSB0ZXh0IHZhbHVlDQogICAqIEByZXR1cm4gYm9vbGVhbiB2YWx1ZSBpbmRpY2F0aW5nIGlmIHRoZSB1cGRhdGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsDQogICAqLw0KICBwdWJsaWMgYm9vbGVhbiB1cGRUeHRCbG9ja0xpbmUobG9uZyBUWElELCBpbnQgTElOTywgU3RyaW5nIFRYNjApIHsNCiAgICBkZWYgcGFyYW1zID0gWyJDT05PIjogQ09OTyBhcyBTdHJpbmcsDQogICAgICAgICAgICAgICAgICAiVFhJRCI6IFRYSUQgYXMgU3RyaW5nLA0KICAgICAgICAgICAgICAgICAgIlRYVlIiOiBpVFhWUiwNCiAgICAgICAgICAgICAgICAgICJMSU5PIjogTElOTyBhcyBTdHJpbmcsDQogICAgICAgICAgICAgICAgICAiVFg2MCI6IFRYNjAsDQogICAgICAgICAgICAgICAgICAiVEZJTCI6ICJNU1lUWEgiLA0KICAgICAgICAgICAgICAgICAgIkZJTEUiOiAiTUlMT01BMDAiDQoNCiAgICBdDQoNCiAgICBib29sZWFuIGlzQVBJU3VjY2Vzc2Z1bCA9IGZhbHNlDQoNCiAgICBkZWYgY2FsbGJhY2sgPSB7IE1hcDxTdHJpbmcsIFN0cmluZz4gb3V0IC0+DQoNCiAgICAgIC8vIENoZWNraW5nIGlmIHRoZXJlIGlzIGFueSBlcnJvciBpbiB0aGUgcmVzcG9uc2UNCiAgICAgIGlmIChvdXQuZXJyb3IgIT0gbnVsbCkgew0KICAgICAgICBtaS5lcnJvcihvdXQuZXJyb3JNZXNzYWdlKQ0KICAgICAgICBpc0FQSVN1Y2Nlc3NmdWwgPSBmYWxzZQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCg0KICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gZXJyb3IsIHJldHVybiB0cnVlDQogICAgICBpc0FQSVN1Y2Nlc3NmdWwgPSB0cnVlDQogICAgfQ0KICAgIGxvZ2dlci5kZWJ1ZygiVXBkYXRpbmcgdGV4dCBibG9jayBsaW5lIHdpdGggcGFyYW1ldGVyczogJHtwYXJhbXN9IikNCiAgICBtaUNhbGxlci5jYWxsKCJDUlM5ODBNSSIsICJVcGRUeHRCbG9ja0xpbmUiLCBwYXJhbXMsIGNhbGxiYWNrKQ0KICAgIGxvZ2dlci5kZWJ1ZygiVXBkYXRpbmcgdGV4dCBibG9jayBsaW5lIHJldHVybmVkOiAke2lzQVBJU3VjY2Vzc2Z1bH0iKQ0KICAgIHJldHVybiBpc0FQSVN1Y2Nlc3NmdWwNCiAgfQ0KDQoNCiAgLyoqDQogICAqIEFkZHMgYSB0ZXh0IGxpbmUgdG8gdGhlIE1TWVRYTCB0YWJsZS4NCiAgICogQHBhcmFtIFRYSUQgVGhlIHRleHQgaWRlbnRpZmllcg0KICAgKiBAcGFyYW0gVFg2MCBUaGUgdGV4dCB2YWx1ZQ0KICAgKiBAcmV0dXJuIGlzQVBJU3VjY2Vzc2Z1bCBBIGJvb2xlYW4gdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBBUEkgY2FsbCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QuDQogICAqLw0KICBwdWJsaWMgYm9vbGVhbiBhZGRUeHRCbG9ja0xpbmUobG9uZyBUWElELCBTdHJpbmcgVFg2MCkgew0KICAgIGRlZiBwYXJhbXMgPSBbIkNPTk8iOiBDT05PIGFzIFN0cmluZywNCiAgICAgICAgICAgICAgICAgICJUWElEIjogVFhJRC50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgIlRYVlIiOiBpVFhWUiwNCiAgICAgICAgICAgICAgICAgICJUWDYwIjogVFg2MCwNCiAgICAgICAgICAgICAgICAgICJURklMIjogIk1TWVRYSCIsDQogICAgICAgICAgICAgICAgICAiRklMRSI6ICJNSUxPTUEwMCJdDQogICAgYm9vbGVhbiBpc0FQSVN1Y2Nlc3NmdWwgPSBmYWxzZQ0KDQogICAgZGVmIGNhbGxiYWNrID0geyBNYXA8U3RyaW5nLCBTdHJpbmc+IG91dCAtPg0KDQogICAgICAvLyBDaGVja2luZyBpZiB0aGVyZSBpcyBhbnkgZXJyb3IgaW4gdGhlIHJlc3BvbnNlDQogICAgICBpZiAob3V0LmVycm9yICE9IG51bGwpIHsNCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBjYWxsaW5nIHRoZSBBZGRUeHRCbG9ja0xpbmUgQVBJOiAke291dC5lcnJvck1lc3NhZ2V9IikNCiAgICAgICAgbWkuZXJyb3Iob3V0LmVycm9yTWVzc2FnZSkNCiAgICAgICAgaXNBUElTdWNjZXNzZnVsID0gZmFsc2UNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQoNCiAgICAgIC8vIElmIHRoZXJlIGlzIG5vIGVycm9yLCByZXR1cm4gdHJ1ZQ0KICAgICAgaXNBUElTdWNjZXNzZnVsID0gdHJ1ZQ0KICAgICAgbG9nZ2VyLmRlYnVnKCJBZGRUeHRCbG9ja0xpbmUgQVBJIGNhbGwgd2FzIHN1Y2Nlc3NmdWwiKQ0KICAgIH0NCg0KICAgIGxvZ2dlci5kZWJ1ZygiQWRkVHh0QmxvY2tMaW5lIEFQSSB3YXMgY2FsbGVkIHdpdGggcGFyYW1zOiAke3BhcmFtc30iKQ0KICAgIG1pQ2FsbGVyLmNhbGwoIkNSUzk4ME1JIiwgIkFkZFR4dEJsb2NrTGluZSIsIHBhcmFtcywgY2FsbGJhY2spDQogICAgcmV0dXJuIGlzQVBJU3VjY2Vzc2Z1bA0KICB9DQp9DQo="}}}